/** @webqit/webflo */
var mt=Object.defineProperty;var dt=(t,e)=>()=>(t&&(e=t(t=0)),e);var xe=(t,e)=>{for(var r in e)mt(t,r,{get:e[r],enumerable:!0})};var it={};xe(it,{URLPattern:()=>nt});function _t(t,e){return(e?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(t)}function Be(t,e=!1){let r=[],n=0;for(;n<t.length;){let o=t[n],i=function(s){if(!e)throw new TypeError(s);r.push({type:"INVALID_CHAR",index:n,value:t[n++]})};if(o==="*"){r.push({type:"ASTERISK",index:n,value:t[n++]});continue}if(o==="+"||o==="?"){r.push({type:"MODIFIER",index:n,value:t[n++]});continue}if(o==="\\"){r.push({type:"ESCAPED_CHAR",index:n++,value:t[n++]});continue}if(o==="{"){r.push({type:"OPEN",index:n,value:t[n++]});continue}if(o==="}"){r.push({type:"CLOSE",index:n,value:t[n++]});continue}if(o===":"){let s="",a=n+1;for(;a<t.length;){let u=t.substr(a,1);if(a===n+1&&yt.test(u)||a!==n+1&&wt.test(u)){s+=t[a++];continue}break}if(!s){i(`Missing parameter name at ${n}`);continue}r.push({type:"NAME",index:n,value:s}),n=a;continue}if(o==="("){let s=1,a="",u=n+1,f=!1;if(t[u]==="?"){i(`Pattern cannot start with "?" at ${u}`);continue}for(;u<t.length;){if(!_t(t[u],!1)){i(`Invalid character '${t[u]}' at ${u}.`),f=!0;break}if(t[u]==="\\"){a+=t[u++]+t[u++];continue}if(t[u]===")"){if(s--,s===0){u++;break}}else if(t[u]==="("&&(s++,t[u+1]!=="?")){i(`Capturing groups are not allowed at ${u}`),f=!0;break}a+=t[u++]}if(f)continue;if(s){i(`Unbalanced pattern at ${n}`);continue}if(!a){i(`Missing pattern at ${n}`);continue}r.push({type:"PATTERN",index:n,value:a}),n=u;continue}r.push({type:"CHAR",index:n,value:t[n++]})}return r.push({type:"END",index:n,value:""}),r}function ze(t,e={}){let r=Be(t),{prefixes:n="./"}=e,o=`[^${X(e.delimiter||"/#?")}]+?`,i=[],s=0,a=0,u="",f=new Set,c=g=>{if(a<r.length&&r[a].type===g)return r[a++].value},l=()=>{let g=c("MODIFIER");return g||c("ASTERISK")},p=g=>{let b=c(g);if(b!==void 0)return b;let{type:A,index:E}=r[a];throw new TypeError(`Unexpected ${A} at ${E}, expected ${g}`)},y=()=>{let g="",b;for(;b=c("CHAR")||c("ESCAPED_CHAR");)g+=b;return g},T=g=>g,O=e.encodePart||T;for(;a<r.length;){let g=c("CHAR"),b=c("NAME"),A=c("PATTERN");if(!b&&!A&&c("ASTERISK")&&(A=".*"),b||A){let v=g||"";n.indexOf(v)===-1&&(u+=v,v=""),u&&(i.push(O(u)),u="");let C=b||s++;if(f.has(C))throw new TypeError(`Duplicate name '${C}'.`);f.add(C),i.push({name:C,prefix:O(v),suffix:"",pattern:A||o,modifier:l()||""});continue}let E=g||c("ESCAPED_CHAR");if(E){u+=E;continue}if(c("OPEN")){let v=y(),C=c("NAME")||"",$=c("PATTERN")||"";!C&&!$&&c("ASTERISK")&&($=".*");let pt=y();p("CLOSE");let Fe=l()||"";if(!C&&!$&&!Fe){u+=v;continue}if(!C&&!$&&!v)continue;u&&(i.push(O(u)),u=""),i.push({name:C||($?s++:""),pattern:C&&!$?o:$,prefix:O(v),suffix:O(pt),modifier:Fe});continue}u&&(i.push(O(u)),u=""),p("END")}return i}function X(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function Ge(t){return t&&t.sensitive?"u":"ui"}function xt(t,e){if(!e)return t;let r=/\((?:\?<(.*?)>)?(?!\?)/g,n=0,o=r.exec(t.source);for(;o;)e.push({name:o[1]||n++,prefix:"",suffix:"",modifier:"",pattern:""}),o=r.exec(t.source);return t}function bt(t,e,r){let n=t.map(o=>Je(o,e,r).source);return new RegExp(`(?:${n.join("|")})`,Ge(r))}function vt(t,e,r){return Ve(ze(t,r),e,r)}function Ve(t,e,r={}){let{strict:n=!1,start:o=!0,end:i=!0,encode:s=c=>c}=r,a=`[${X(r.endsWith||"")}]|$`,u=`[${X(r.delimiter||"/#?")}]`,f=o?"^":"";for(let c of t)if(typeof c=="string")f+=X(s(c));else{let l=X(s(c.prefix)),p=X(s(c.suffix));if(c.pattern)if(e&&e.push(c),l||p)if(c.modifier==="+"||c.modifier==="*"){let y=c.modifier==="*"?"?":"";f+=`(?:${l}((?:${c.pattern})(?:${p}${l}(?:${c.pattern}))*)${p})${y}`}else f+=`(?:${l}(${c.pattern})${p})${c.modifier}`;else c.modifier==="+"||c.modifier==="*"?f+=`((?:${c.pattern})${c.modifier})`:f+=`(${c.pattern})${c.modifier}`;else f+=`(?:${l}${p})${c.modifier}`}if(i)n||(f+=`${u}?`),f+=r.endsWith?`(?=${a})`:"$";else{let c=t[t.length-1],l=typeof c=="string"?u.indexOf(c[c.length-1])>-1:c===void 0;n||(f+=`(?:${u}(?=${a}))?`),l||(f+=`(?=${u}|${a})`)}return new RegExp(f,Ge(r))}function Je(t,e,r){return t instanceof RegExp?xt(t,e):Array.isArray(t)?bt(t,e,r):vt(t,e,r)}function Pt(t,e){return t.length?t[0]==="/"?!0:!e||t.length<2?!1:(t[0]=="\\"||t[0]=="{")&&t[1]=="/":!1}function Xe(t,e){return t.startsWith(e)?t.substring(e.length,t.length):t}function Ct(t,e){return t.endsWith(e)?t.substr(0,t.length-e.length):t}function Ke(t){return!t||t.length<2?!1:t[0]==="["||(t[0]==="\\"||t[0]==="{")&&t[1]==="["}function Qe(t){if(!t)return!0;for(let e of Ze)if(t.test(e))return!0;return!1}function Et(t,e){if(t=Xe(t,"#"),e||t==="")return t;let r=new URL("https://example.com");return r.hash=t,r.hash?r.hash.substring(1,r.hash.length):""}function At(t,e){if(t=Xe(t,"?"),e||t==="")return t;let r=new URL("https://example.com");return r.search=t,r.search?r.search.substring(1,r.search.length):""}function kt(t,e){return e||t===""?t:Ke(t)?tt(t):et(t)}function It(t,e){if(e||t==="")return t;let r=new URL("https://example.com");return r.password=t,r.password}function Rt(t,e){if(e||t==="")return t;let r=new URL("https://example.com");return r.username=t,r.username}function Lt(t,e,r){if(r||t==="")return t;if(e&&!Ze.includes(e))return new URL(`${e}:${t}`).pathname;let n=t[0]=="/";return t=new URL(n?t:"/-"+t,"https://example.com").pathname,n||(t=t.substring(2,t.length)),t}function Tt(t,e,r){return Ye(e)===t&&(t=""),r||t===""?t:rt(t)}function $t(t,e){return t=Ct(t,":"),e||t===""?t:Ee(t)}function Ye(t){switch(t){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function Ee(t){if(t==="")return t;if(/^[-+.A-Za-z0-9]*$/.test(t))return t.toLowerCase();throw new TypeError(`Invalid protocol '${t}'.`)}function Nt(t){if(t==="")return t;let e=new URL("https://example.com");return e.username=t,e.username}function jt(t){if(t==="")return t;let e=new URL("https://example.com");return e.password=t,e.password}function et(t){if(t==="")return t;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(t))throw new TypeError(`Invalid hostname '${t}'`);let e=new URL("https://example.com");return e.hostname=t,e.hostname}function tt(t){if(t==="")return t;if(/[^0-9a-fA-F[\]:]/g.test(t))throw new TypeError(`Invalid IPv6 hostname '${t}'`);return t.toLowerCase()}function rt(t){if(t===""||/^[0-9]*$/.test(t)&&parseInt(t)<=65535)return t;throw new TypeError(`Invalid port '${t}'.`)}function qt(t){if(t==="")return t;let e=new URL("https://example.com");return e.pathname=t[0]!=="/"?"/-"+t:t,t[0]!=="/"?e.pathname.substring(2,e.pathname.length):e.pathname}function Ut(t){return t===""?t:new URL(`data:${t}`).pathname}function Ft(t){if(t==="")return t;let e=new URL("https://example.com");return e.search=t,e.search.substring(1,e.search.length)}function Dt(t){if(t==="")return t;let e=new URL("https://example.com");return e.hash=t,e.hash.substring(1,e.hash.length)}function We(t,e){if(typeof t!="string")throw new TypeError("parameter 1 is not of type 'string'.");let r=new URL(t,e);return{protocol:r.protocol.substring(0,r.protocol.length-1),username:r.username,password:r.password,hostname:r.hostname,port:r.port,pathname:r.pathname,search:r.search!=""?r.search.substring(1,r.search.length):void 0,hash:r.hash!=""?r.hash.substring(1,r.hash.length):void 0}}function te(t,e,r){let n;if(typeof e.baseURL=="string")try{n=new URL(e.baseURL),t.protocol=n.protocol?n.protocol.substring(0,n.protocol.length-1):"",t.username=n.username,t.password=n.password,t.hostname=n.hostname,t.port=n.port,t.pathname=n.pathname,t.search=n.search?n.search.substring(1,n.search.length):"",t.hash=n.hash?n.hash.substring(1,n.hash.length):""}catch{throw new TypeError(`invalid baseURL '${e.baseURL}'.`)}if(typeof e.protocol=="string"&&(t.protocol=$t(e.protocol,r)),typeof e.username=="string"&&(t.username=Rt(e.username,r)),typeof e.password=="string"&&(t.password=It(e.password,r)),typeof e.hostname=="string"&&(t.hostname=kt(e.hostname,r)),typeof e.port=="string"&&(t.port=Tt(e.port,t.protocol,r)),typeof e.pathname=="string"){if(t.pathname=e.pathname,n&&!Pt(t.pathname,r)){let o=n.pathname.lastIndexOf("/");o>=0&&(t.pathname=n.pathname.substring(0,o+1)+t.pathname)}t.pathname=Lt(t.pathname,t.protocol,r)}return typeof e.search=="string"&&(t.search=At(e.search,r)),typeof e.hash=="string"&&(t.hash=Et(e.hash,r)),t}function re(t){return t.replace(/([+*?:{}()\\])/g,"\\$1")}function Wt(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function Bt(t,e){let r=".*",n=`[^${Wt(e.delimiter||"/#?")}]+?`,o=/[$_\u200C\u200D\p{ID_Continue}]/u,i="";for(let s=0;s<t.length;++s){let a=t[s],u=s>0?t[s-1]:null,f=s<t.length-1?t[s+1]:null;if(typeof a=="string"){i+=re(a);continue}if(a.pattern===""){if(a.modifier===""){i+=re(a.prefix);continue}i+=`{${re(a.prefix)}}${a.modifier}`;continue}let c=typeof a.name!="number",l=e.prefixes!==void 0?e.prefixes:"./",p=a.suffix!==""||a.prefix!==""&&(a.prefix.length!==1||!l.includes(a.prefix));if(!p&&c&&a.pattern===n&&a.modifier===""&&f&&!f.prefix&&!f.suffix)if(typeof f=="string"){let y=f.length>0?f[0]:"";p=o.test(y)}else p=typeof f.name=="number";if(!p&&a.prefix===""&&u&&typeof u=="string"&&u.length>0){let y=u[u.length-1];p=l.includes(y)}p&&(i+="{"),i+=re(a.prefix),c&&(i+=`:${a.name}`),a.pattern===r?!c&&(!u||typeof u=="string"||u.modifier||p||a.prefix!=="")?i+="*":i+=`(${r})`:a.pattern===n?c||(i+=`(${n})`):i+=`(${a.pattern})`,a.pattern===n&&c&&a.suffix!==""&&o.test(a.suffix[0])&&(i+="\\"),i+=re(a.suffix),p&&(i+="}"),i+=a.modifier}return i}var yt,wt,D,St,Ot,Ze,Ht,Mt,F,nt,ot=dt(()=>{yt=/[$_\p{ID_Start}]/u,wt=/[$_\u200C\u200D\p{ID_Continue}]/u;D={delimiter:"",prefixes:"",sensitive:!0,strict:!0},St={delimiter:".",prefixes:"",sensitive:!0,strict:!0},Ot={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};Ze=["ftp","file","http","https","ws","wss"];Ht=class{constructor(t){this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=0,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=t}get result(){return this.internalResult}parse(){for(this.tokenList=Be(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===0){this.rewind(),this.isHashPrefix()?this.changeState(9,1):this.isSearchPrefix()?(this.changeState(8,1),this.internalResult.hash=""):(this.changeState(7,0),this.internalResult.search="",this.internalResult.hash="");continue}else if(this.state===2){this.rewindAndSetState(5);continue}this.changeState(10,0);break}if(this.groupDepth>0)if(this.isGroupClose())this.groupDepth-=1;else continue;if(this.isGroupOpen()){this.groupDepth+=1;continue}switch(this.state){case 0:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(1));break;case 1:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();let t=7,e=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(t=2,e=3):this.shouldTreatAsStandardURL&&(t=2),this.changeState(t,e)}break;case 2:this.isIdentityTerminator()?this.rewindAndSetState(3):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(5);break;case 3:this.isPasswordPrefix()?this.changeState(4,1):this.isIdentityTerminator()&&this.changeState(5,1);break;case 4:this.isIdentityTerminator()&&this.changeState(5,1);break;case 5:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(6,1):this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 6:this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 7:this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 8:this.isHashPrefix()&&this.changeState(9,1);break;case 9:break;case 10:break}}}changeState(t,e){switch(this.state){case 0:break;case 1:this.internalResult.protocol=this.makeComponentString();break;case 2:break;case 3:this.internalResult.username=this.makeComponentString();break;case 4:this.internalResult.password=this.makeComponentString();break;case 5:this.internalResult.hostname=this.makeComponentString();break;case 6:this.internalResult.port=this.makeComponentString();break;case 7:this.internalResult.pathname=this.makeComponentString();break;case 8:this.internalResult.search=this.makeComponentString();break;case 9:this.internalResult.hash=this.makeComponentString();break;case 10:break}this.changeStateWithoutSettingComponent(t,e)}changeStateWithoutSettingComponent(t,e){this.state=t,this.componentStart=this.tokenIndex+e,this.tokenIndex+=e,this.tokenIncrement=0}rewind(){this.tokenIndex=this.componentStart,this.tokenIncrement=0}rewindAndSetState(t){this.rewind(),this.state=t}safeToken(t){return t<0&&(t=this.tokenList.length-t),t<this.tokenList.length?this.tokenList[t]:this.tokenList[this.tokenList.length-1]}isNonSpecialPatternChar(t,e){let r=this.safeToken(t);return r.value===e&&(r.type==="CHAR"||r.type==="ESCAPED_CHAR"||r.type==="INVALID_CHAR")}isProtocolSuffix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}nextIsAuthoritySlashes(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")}isIdentityTerminator(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")}isPasswordPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPortPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPathnameStart(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")}isSearchPrefix(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;let t=this.safeToken(this.tokenIndex-1);return t.type!=="NAME"&&t.type!=="PATTERN"&&t.type!=="CLOSE"&&t.type!=="ASTERISK"}isHashPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")}isGroupOpen(){return this.tokenList[this.tokenIndex].type=="OPEN"}isGroupClose(){return this.tokenList[this.tokenIndex].type=="CLOSE"}isIPv6Open(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")}isIPv6Close(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")}makeComponentString(){let t=this.tokenList[this.tokenIndex],e=this.safeToken(this.componentStart).index;return this.input.substring(e,t.index)}computeShouldTreatAsStandardURL(){let t={};Object.assign(t,D),t.encodePart=Ee;let e=Je(this.makeComponentString(),void 0,t);this.shouldTreatAsStandardURL=Qe(e)}},Mt=["protocol","username","password","hostname","port","pathname","search","hash"],F="*";nt=class{constructor(t={},e){this.regexp={},this.keys={},this.component_pattern={};try{if(typeof t=="string"){let o=new Ht(t);if(o.parse(),t=o.result,e)if(typeof e=="string")t.baseURL=e;else throw new TypeError("'baseURL' parameter is not of type 'string'.");else if(typeof t.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.")}else if(e)throw new TypeError("parameter 1 is not of type 'string'.");if(!t||typeof t!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");let r={pathname:F,protocol:F,username:F,password:F,hostname:F,port:F,search:F,hash:F};this.pattern=te(r,t,!0),Ye(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");let n;for(n of Mt){if(!(n in this.pattern))continue;let o={},i=this.pattern[n];switch(this.keys[n]=[],n){case"protocol":Object.assign(o,D),o.encodePart=Ee;break;case"username":Object.assign(o,D),o.encodePart=Nt;break;case"password":Object.assign(o,D),o.encodePart=jt;break;case"hostname":Object.assign(o,St),Ke(i)?o.encodePart=tt:o.encodePart=et;break;case"port":Object.assign(o,D),o.encodePart=rt;break;case"pathname":Qe(this.regexp.protocol)?(Object.assign(o,Ot),o.encodePart=qt):(Object.assign(o,D),o.encodePart=Ut);break;case"search":Object.assign(o,D),o.encodePart=Ft;break;case"hash":Object.assign(o,D),o.encodePart=Dt;break}try{let s=ze(i,o);this.regexp[n]=Ve(s,this.keys[n],o),this.component_pattern[n]=Bt(s,o)}catch{throw new TypeError(`invalid ${n} pattern '${this.pattern[n]}'.`)}}}catch(r){throw new TypeError(`Failed to construct 'URLPattern': ${r.message}`)}}test(t={},e){let r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof t>"u")return!1;try{typeof t=="object"?r=te(r,t,!1):r=te(r,We(t,e),!1)}catch{return!1}let n;for(n in this.pattern)if(!this.regexp[n].exec(r[n]))return!1;return!0}exec(t={},e){let r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof t>"u")return;try{typeof t=="object"?r=te(r,t,!1):r=te(r,We(t,e),!1)}catch{return null}let n={};e?n.inputs=[t,e]:n.inputs=[t];let o;for(o in this.pattern){let i=this.regexp[o].exec(r[o]);if(!i)return null;let s={};for(let[a,u]of this.keys[o].entries())if(typeof u.name=="string"||typeof u.name=="number"){let f=i[a+1];s[u.name]=f}n[o]={input:r[o]||"",groups:s}}return n}get protocol(){return this.component_pattern.protocol}get username(){return this.component_pattern.username}get password(){return this.component_pattern.password}get hostname(){return this.component_pattern.hostname}get port(){return this.component_pattern.port}get pathname(){return this.component_pattern.pathname}get search(){return this.component_pattern.search}get hash(){return this.component_pattern.hash}};globalThis.URLPattern||(globalThis.URLPattern=nt)});var Ue={};xe(Ue,{APIS:()=>qe,start:()=>fr});var Q=class{constructor(e,r=null){Object.defineProperty(this,"dict",{value:Object.create(e)});for(let n in this.dict)n in this||(this[n]=this.dict[n]);arguments.length>1&&Object.defineProperty(this.dict,"CWD",{get:()=>r})}get name(){return"webflo"}static create(...e){return new this(...e)}get CWD(){return this.dict.CWD||""}get meta(){return this.dict.meta||{}}get app(){return this.dict.app||{}}get config(){return this.dict.config||{}}get flags(){return this.dict.flags||{}}set flags(e){Object.defineProperty(this.dict,"flags",{value:e})}get layout(){return this.dict.layout||{}}set layout(e){Object.defineProperty(this.dict,"layout",{value:e})}get logger(){return this.dict.logger}set logger(e){Object.defineProperty(this.dict,"logger",{value:e})}};var Y=class extends Q{};function m(t){return!Array.isArray(t)&&typeof t=="object"&&t}function be(t){return typeof t}function h(t){return Array.isArray(t)}function ee(t){return t===!0||t===!1}function J(t){return typeof t=="function"}function he(t){return t===null||t===""}function k(t){return arguments.length&&(t===void 0||typeof t>"u")}function w(t){return Array.isArray(t)||typeof t=="object"&&t||J(t)}function M(t){return he(t)||k(t)||t===!1||t===0||w(t)&&!Object.keys(t).length}function _(t){return J(t)||t&&{}.toString.call(t)==="[object function]"}function W(t){return t instanceof Number||typeof t=="number"}function P(t){return W(t)||t!==!0&&t!==!1&&t!==null&&t!==""&&!isNaN(t*1)}function ve(t){return h(t)&&Object.getPrototypeOf(t)===Array.prototype}function pe(t){return m(t)&&Object.getPrototypeOf(t)===Object.prototype}function x(t){return t instanceof String||typeof t=="string"&&t!==null}function Se(t){return!x(t)&&!k(t.length)}function me(t,...e){return e.forEach(r=>{t.indexOf(r)<0&&t.push(r)}),t}function Oe(n,e){e=e||Object.prototype,e=e&&!h(e)?[e]:e;for(var r=[],n=n;n&&(!e||e.indexOf(n)<0)&&n.name!=="default";)r.push(n),n=n?Object.getPrototypeOf(n):null;return r}function Pe(t,e){var r=[];return Oe(t,e).forEach(n=>{me(r,...Object.getOwnPropertyNames(n))}),r}function N(t,e,r=!1,n=!1,o=!1){var i=0,s=t.shift();if((P(s)||s===!0||s===!1)&&(i=s,s=t.shift()),!t.length)throw new Error("_merge() requires two or more array/objects.");return t.forEach((a,u)=>{!w(a)&&!_(a)||(r?Pe(a):Object.keys(a)).forEach(f=>{if(!!e(f,s,a,u)){var c=s[f],l=a[f];if((h(c)&&h(l)||m(c)&&m(l))&&(i===!0||i>0))s[f]=h(c)&&h(l)?[]:{},N([P(i)?i-1:i,s[f],c,l],e,r,n,o);else if(h(s)&&h(a))n?s[f]=l:s.push(l);else try{o?Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(a,f)):s[f]=a[f]}catch{}}})}),s}function de(...t){return N(t,(e,r,n)=>!0,!1,!1,!1)}typeof URLPattern>"u"&&await Promise.resolve().then(()=>(ot(),it));var S={parse(t,e="&"){t=t||"";let r={};return(t.startsWith("?")?t.substr(1):t).split(e).filter(n=>n).map(n=>n.split("=").map(o=>o.trim())).forEach(n=>this.set(r,n[0],decodeURIComponent(n[1]))),r},stringify(t,e="&"){let r=[];return Object.keys(t).forEach(n=>{this.reduceValue(t[n],n,(o,i,s=void 0)=>{if(s)return s;r.push(`${i}=${encodeURIComponent(o)}`)})}),r.join(e)},get(t,e){return this.reducePath(e,t,(r,n)=>{if(!(!n&&n!==0))return n[r]})},set(t,e,r){this.reducePath(e,t,function(n,o,i=void 0){let s=r;return i&&(s=i),n===""&&h(o)?o.push(s):o[n]=s,s})},reduceValue(t,e,r){if(w(t)){let n=Object.keys(t),o=r(t,e,n);if(h(o))return o.forEach(i=>{this.reduceValue(t[i],e?`${e}[${i}]`:i,r)})}r(t,e)},reducePath(t,e,r){if(x(t)&&t.endsWith("]")&&w(e)){let[n,...o]=t.split("[");P(n)&&(n=parseInt(n)),o=o.join("[").replace("]","");let i;if(n in e)i=e[n];else{let s=o===""||P(o.split("[")[0])?[]:{};i=r(n,e,s)}return this.reducePath(o,i,r)}return P(t)&&(t=parseInt(t)),r(t,e)}},st={join(){let t=[],e=0;for(let n=0,o=arguments.length;n<o;n++)t=t.concat(arguments[n].split("/"));let r=[];for(let n=0,o=t.length;n<o;n++){let i=t[n];!i||i==="."||(i===".."?r.length?r.pop():e++:r.push(i))}return t[0]===""&&r.unshift(""),"../".repeat(e)+r.join("/")||(r.length?"/":".")},dirname(t){return this.join(t,"..")}};function H(t,e,r=!1){if(e=="")return t;var n=r?t.lastIndexOf(e):t.indexOf(e);return n===-1?"":t.substr(n+e.length)}function j(t,e,r=!1){if(e=="")return t;var n=r?t.lastIndexOf(e):t.indexOf(e);return n===-1?t:t.substr(0,n)}function I(t,e=!0){return h(t)?t:!e&&m(t)?[t]:t!==!1&&t!==0&&M(t)?[]:Se(t)?Array.prototype.slice.call(t):m(t)?Object.values(t):[t]}var ne=class{constructor(e,r=[]){this.cx=e,this.path=h(r)?r:(r+"").split("/").filter(n=>n)}async route(e,r,n,o,i=null){let s=this,a=this.cx.runtime,u=async function(f){let c={runtime:a};if(!f.trail||f.trail.length<f.destination.length){if(f=await s.readTick(f),c.pathname=`/${f.trail.join("/")}`,c.stepname=f.trail[f.trail.length-1],s.finalizeHandlerContext(c,f),f.exports){f.exports.hints&&await r.port.post({...f.exports.hints,$type:"handler:hints"});let l=I(f.method).map(y=>y==="default"?y:y.toUpperCase()),p=_(f.exports)&&l.includes("default")?f.exports:l.reduce((y,T)=>y||f.exports[T],null);if(p){let y=async(...O)=>{let g={...f,arg:O[0]};if(O.length>1){let b=O[1],A,E={...O[2]||{}};if(O[1]instanceof g.event.Request)A=O[1],b=A.url;else if(!x(b))throw new Error("Router redirect url must be a string!");let V=b.startsWith("/")?b:s.pathJoin(`/${f.trail.join("/")}`,b);if(V.startsWith("../"))throw new Error("Router redirect cannot traverse beyond the routing directory! ("+b+" >> "+V+")");E.method&&(g.method=E.method,h(E.method)&&(E.method=E.method[0])),A?g.event=await f.event.with(V,A,E):g.event=await f.event.with(V,E),g.source=f.destination.join("/"),g.destination=V.split("?").shift().split("/").map(v=>v.trim()).filter(v=>v),g.trail=O[1].startsWith("/")?[]:f.trail.reduce((v,C,$)=>v.length===$&&C===g.destination[$]?v.concat(C):v,[]),g.trailOnFile=f.trailOnFile.slice(0,g.trail.length)}return u(g)},T=f.destination.slice(f.trail.length);return y.pathname=T.join("/"),y.stepname=T[0],await p.call(c,f.event,f.arg,y,i)}return u(f)}else if((f.currentSegmentOnFile||{}).dirExists)return u(f)}if(o)return await o.call(c,f.event,f.arg,i)};return u({destination:this.path,event:r,method:e,arg:n})}};var ie=class extends ne{async readTick(e){e={...e};var r=this.cx.layout,n=Object.keys(this.cx.layout);return e.trail?(e.currentSegment=e.destination[e.trail.length],e.currentSegmentOnFile=[e.currentSegment,"-"].reduce((o,i)=>{if(o.index)return o;var s=`/${e.trailOnFile.concat(i).join("/")}`;return r[s]?{seg:i,index:s}:n.filter(a=>a.startsWith(`${s}/`)).length?{seg:i,dirExists:!0}:o},{seg:null}),e.trail=e.trail.concat(e.currentSegment),e.trailOnFile=e.trailOnFile.concat(e.currentSegmentOnFile.seg),e.exports=r[e.currentSegmentOnFile.index]):(e.trail=[],e.trailOnFile=[],e.currentSegmentOnFile={index:"/"},e.exports=r["/"]),e}finalizeHandlerContext(e,r){return e.dirname=r.currentSegmentOnFile.index}pathJoin(...e){return st.join(...e)}};var oe=class{constructor(e){this.cx=e}async init(e,r){return new this.Router(this.cx,"/").route(["init"],e,{},async o=>{},r)}};var se=class extends oe{get Router(){return ie}async handle(e,r){let n=new this.Router(this.cx,e.url.pathname),o=async()=>{let i;return window.webqit?.oohtml?.configs&&({BINDINGS_API:{api:i}={}}=window.webqit.oohtml.configs),n.route([e.request.method,"default"],e,{...i&&document[i.bindings]||{}},async s=>(s!==e&&(s.request.headers.has("Accept")||s.request.headers.set("Accept","application/json")),r(s.request)),r)};return await(this.cx.middlewares||[]).concat(o).reverse().reduce((i,s)=>()=>s.call(this.cx,e,n,i),null)()}async render(e,r){let n=await r.jsonfy();return await new this.Router(this.cx,e.url.pathname).route("render",e,n,async(i,s)=>{if(window.webqit?.dom&&await new Promise(a=>window.webqit.dom.ready(a)),window.webqit?.oohtml?.configs){let{CONTEXT_API:{attr:a}={},BINDINGS_API:{api:u}={},HTML_IMPORTS:{attr:f}={}}=window.webqit.oohtml.configs;u&&window.document[u.bind]({env:"client",state:this.cx.runtime,...s||{}},{diff:!0});let c;if(f){c=window.document.body.querySelector(`[${window.CSS.escape(a.contextname)}="app"]`)||window.document.body;let l=c.getAttribute(f.importscontext),p="/"+`routes/${i.url.pathname}`.split("/").map(T=>T.trim()).filter(T=>T).join("/"),y=l===p?"same":`${l}/`.startsWith(`${p}/`)?"parent":`${p}/`.startsWith(`${l}/`)?"child":"unrelated";c.setAttribute(f.importscontext,p),c.setAttribute(`prev-${f.importscontext}`,l),c.setAttribute("importscontext-transition-type",y)}}return window})}};var qe={};xe(qe,{HttpEvent:()=>U,Observer:()=>d,default:()=>Z});function ge(t,e){return j(t,e,!0)}function ye(t,e){return typeof t!="string"?t:t.replace(/\w\S*/g,function(r){return r.charAt(0).toUpperCase()+(typeof e!==void 0&&e?r.substr(1).toLowerCase():r.substr(1))})}function ut(t=null,e=!1){let r=e?"localStorage":"sessionStorage";if(!window[r])throw new Error(`The specified Web Storage API ${r} is invalid or not supported`);let n={},o=i=>t?`${t}.${i.key}`:i.key;return d.intercept(n,{get:(i,s,a)=>{if(!x(i.key))return;let u=window[r].getItem(o(i));return a(k(u)?u:JSON.parse(u))},set:(i,s,a)=>{if(!!x(i.key))return window[r].setItem(o(i),k(i.value)?i.value:JSON.stringify(i.value)),a(!0)},deleteProperty:(i,s,a)=>{if(!!x(i.key))return window[r].removeItem(o(i)),a(!0)},has:(i,s,a)=>{if(!x(i.key))return;let u=o(i);for(let f=0;f<window[r].length;f++)if(window[r].key(f)===u)return a(!0);return a(!1)},ownKeys:(i,s,a)=>{let u=[];for(let f=0;f<window[r].length;f++)u.push(window[r].key(f));return a(u)},getOwnPropertyDescriptor:(i,s,a)=>a({enumerable:!0,configurable:!0})}),d.proxy(n)}function ke(t,e=null){var r={};return arguments.length===2&&(h(t)&&h(e)?t.forEach((n,o)=>r[n]=e[o]):r[t]=e),r}function Re(t,e,r=null){return de(t,m(e)?e:ke(e,r))}var q=class{constructor(e){let r=this.constructor;var n=(o,i)=>m(o)&&m(i)?n(Object.keys(o),Object.keys(i))&&n(Object.values(o),Object.values(i)):h(o)&&h(i)?o.length===i.length&&o.reduce((s,a,u)=>s&&a===i[u],!0):o===i;d.intercept(this,"set",(o,i,s)=>(o.key==="hash"&&o.value&&!o.value.startsWith("#")?o.value="#"+o.value:o.key==="search"&&o.value&&!o.value.startsWith("?")&&(o.value="?"+o.value),s())),d.observe(this,o=>{var i={},s;for(var a of o){if(a.key==="href"&&a.related.length===1){var i=r.parseUrl(a.value);delete i.query,delete i.href,s=!0}if(a.key==="query"&&!a.related.includes("search")){var u=r.toSearch(this.query);u!==this.search&&(i.search=u)}if(a.key==="search"){var f=r.toQuery(i.search||this.search);n(f,this.query)||(i.query=f)}}if(!s){var c=this.origin,l=[this.username,this.password].filter(y=>y);l.length===2&&(c=`${this.protocol}//${l.join(":")}@${this.hostname}${this.port?`:${this.port}`:""}`);var p=[c,i.pathname||this.pathname,i.search||this.search||(this.href.includes("?")?"?":""),this.hash||(this.href.includes("#")?"#":"")].join("");p!==this.href&&(i.href=p)}if(!M(i))return d.set(this,i)},{diff:!0}),d.observe(this,o=>{o.forEach(i=>{if(i&&i.detail){if(!w(i.detail))throw new Error('"e.detail" can only be of type object.');if(i.detail.request&&!m(i.detail.request))throw new Error('"e.detail.request" can only be of type object.')}})},{diff:!0}),d.set(this,x(e)?r.parseUrl(e):q.copy(e))}toString(){return this.href}static from(e){return new this(m(e)?e:this.parseUrl(e))}static copy(e){var r=nr.reduce((n,o)=>Re(n,o,e[o]),{});return"query"in e||delete r.query,r}static parseUrl(e){var r=document.createElement("a");return r.href=e,this.copy(r)}static toQuery(e){return S.parse(e)}static toSearch(e){var r=S.stringify(e);return r?"?"+r:""}},nr=["protocol","username","password","host","hostname","port","origin","pathname","search","query","hash","href"];var ae=class{constructor(e,r={},n={}){this.ready=navigator.serviceWorker?navigator.serviceWorker.ready:new Promise(()=>{}),this.registration=new Promise((i,s)=>{if(!navigator.serviceWorker)return;let a=()=>{navigator.serviceWorker.register(e,{scope:r.scope||"/"}).then(async u=>{let f=l=>{let p=l.state==="installed"?"waiting":l.state==="activating"||l.state==="activated"?"active":l.state;d.set(this,p,l)},c=u.active||u.waiting||u.installing;f(c),c.addEventListener("statechange",l=>f(l.target)),u.addEventListener("updatefound",()=>{f(u.installing),u.installing.addEventListener("statechange",l=>f(l.target))}),i(u)}).catch(u=>s(u))};r.onWindowLoad?window.addEventListener("load",a):a(),r.startMessages&&navigator.serviceWorker.startMessages()});let o=(i,s,a=1)=>{if(this.active)_(i)&&(i=i()),s(this.active,i);else if(a){let u=d.observe(this,"active",f=>{_(i)&&(i=i()),s(f.value,i),a!==2&&u.abort()})}};this.messaging={post:(i,s=1)=>(o(i,(a,u)=>{a.postMessage(u)},s),this),listen:i=>(navigator.serviceWorker&&navigator.serviceWorker.addEventListener("message",s=>{let a=i(s),u=s.ports[0];u&&(a instanceof Promise?a.then(f=>{u.postMessage(f)}):u.postMessage(a))}),this),request:(i,s=1)=>new Promise(a=>{o(i,(u,f)=>{let c=new MessageChannel;u.postMessage(f,[c.port2]),c.port1.onmessage=l=>a(l.data)},s)}),channel(i){this.channels.has(i)||this.channels.set(i,new BroadcastChannel(s));let s=this.channels.get(i);return{broadcast:a=>s.postMessage(a),listen:a=>s.addEventListener("message",a)}},channels:new Map},this.notifications={requestPermission:()=>new Promise(async(i,s)=>{let a=Notification.requestPermission(i);a&&a.then(i,s)}),fire:async(i,s={})=>(await this.ready,(await this.registration).showNotification(i,s))},this.push={getSubscription:async(i=!0)=>{await this.ready;let s=await(await this.registration).pushManager.getSubscription(),a,u;return!s&&i&&(a=n[r.vapid_key_env])&&(s=await(await this.registration).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:ir(a)}),(u=n[r.push_registration_url_env])&&await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})),s},unsubscribe:async()=>{await this.ready;let i=await(await this.registration).pushManager.getSubscription();i?.unsubscribe();let s;i&&(s=n[r.push_registration_url_env])&&await fetch(s,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})}}}};function ir(t){for(var e="=".repeat((4-t.length%4)%4),r=(t+e).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(r),o=new Uint8Array(n.length),i=0;i<n.length;++i)o[i]=n.charCodeAt(i);return o}function K(t){let e=t.headers instanceof Headers?[...t.headers.keys()].reduce((o,i)=>({...o,[i]:t.headers.get(i)}),{}):Object.keys(t.headers||{}).reduce((o,i)=>({...o,[i.toLowerCase()]:t.headers[i]}),{}),r=t.body,n=Le(t.body);if(["Blob","File"].includes(n))!e["content-type"]&&(e["content-type"]=r.type),!e["content-length"]&&(e["content-length"]=r.size);else if(["Uint8Array","Uint16Array","Uint32Array","ArrayBuffer"].includes(n))!e["content-length"]&&(e["content-length"]=r.byteLength);else if(n==="json"&&w(r)){if(!e["content-type"]){let[o,i]=or(r);i?(r=JSON.stringify(r,(s,a)=>a instanceof Error?{...a,message:a.message}:a),e["content-type"]="application/json",e["content-length"]=new Blob([r]).size):(r=o,n="FormData")}}else n==="json"&&!e["content-length"]&&(e["content-length"]=(r+"").length);return[r,e,n]}function or(t={},e=!0){let r=new FormData,n=!0;return S.reduceValue(t,"",(o,i,s=void 0)=>{if(s){let a=Le(o)==="json";return n=n&&a,a&&s}e&&[!0,!1,null].includes(o)&&(o=new Blob([o],{type:"application/json"})),r.append(i,o)}),[r,n]}async function ct(t,e=!0){let r=!0,n;for(let[o,i]of t.entries()){n||(n=P(j(o,"["))?[]:{});let s=Le(i);if(e&&["Blob","File"].includes(s)&&i.type==="application/json"&&[4,5].includes(i.size)){let a=await i.text();["true","false","null"].includes(a)&&(s="json",i=JSON.parse(a))}r=r&&s==="json",S.set(n,o,i)}return[n,r]}function Le(t){if(x(t)||W(t)||ee(t))return"json";if(!w(t))return;let e=t[Symbol.toStringTag],r=["Uint8Array","Uint16Array","Uint32Array","ArrayBuffer","Blob","File","FormData","Stream","ReadableStream"].reduce((n,o)=>n||(e===o?o:null),null);if(r)return r;if(m(t)&&pe(t)||h(t)&&ve(t)||"toString"in t)return"json"}var fe=class extends FormData{async json(e={}){return(await ct(this,...arguments))[0]}static compat(e){if(e instanceof this)return e;if(e instanceof FormData)return Object.setPrototypeOf(e,new this)}};var sr=(t,e)=>{let r=class extends t{constructor(n,o,i){o.headers&&(o={...o,headers:new e(o.headers)}),super(n,o),i.headers&&this.headers.json(i.headers);let s={};Object.defineProperty(this,"_attrs",{get:()=>s}),Object.defineProperty(this,"meta",{get:()=>i})}get attrs(){return this._attrs||{}}clone(){return new this.constructor(super.clone())}get headers(){return e.compat(super.headers),super.headers}get url(){return"url"in this.attrs?this.attrs.url:super.url}async arrayBuffer(){return this.meta.type==="ArrayBuffer"?this.meta.body:super.arrayBuffer()}async blob(){return["Blob","File"].includes(this.meta.type)?this.meta.body:super.blob()}async formData(){let n;return this.meta.type==="FormData"&&this.meta.body instanceof FormData?n=this.meta.body:n=await super.formData(),n&&(n=fe.compat(n)),n}async json(){return this.meta.type==="json"&&w(this.meta.body)?this.meta.body:super.json()}async text(){return this.meta.type==="json"&&!w(this.meta.body)?this.meta.body:super.text()}jsonfy(n=!1){return(!this.meta.jsonfied||n)&&(this.meta.jsonfied=new Promise(async(o,i)=>{let s,a=this.headers.get("Content-Type")||"";try{a==="application/x-www-form-urlencoded"||a.startsWith("multipart/form-data")?s=await(await this.formData())?.json():a==="application/json"?s=await this.json():a==="text/plain"&&(s=await this.text()),o(s)}catch(u){i(u)}})),this.meta.jsonfied}};return r.Headers=e,r},_e=sr;var B=class extends Headers{constructor(e={}){let r=e.cookies;delete e.cookies,e instanceof Headers?super(e):(super(),this.json(e)),this.cookies=r}set(e,r){return this.catchCookies(e,r),super.set(e,r)}append(e,r){return this.catchCookies(e,r,!0),super.append(e,r)}delete(e){return this.catchCookies(e),super.delete(e)}set cookies(e){if(e instanceof Map){this.cookies.clear();for(let[r,n]of e)this.cookies.set(r,n)}else e&&this.set(this.cookieHeaderName,e);return!0}get cookies(){return this._cookies||(this._cookies=new this.Cookies,Object.defineProperty(this._cookies,"headers",{value:this})),this._cookies}catchCookies(e,r,n=!1){if(!(!this.cookies||e.toLowerCase()!==this.cookieHeaderName.toLowerCase())){if(this.cookies.outLock=!0,arguments.length>1){n||this.cookies.clear();let o=this.cookies.parse(r);for(let i in o)this.cookies.set(i,o[i])}else this.cookies.clear();this.cookies.outLock=!1}}json(e={},r=!0){if(arguments.length){let s=Te(this),a=Object.keys(s).reduce((u,f)=>u.concat(typeof f!="symbol"&&"set"in s[f]?f:[]),[]);Object.keys(e).forEach(u=>{var f=a.reduce((c,l)=>c||(l===u||l.toLocaleLowerCase()===u?l:null),null);f?(r||this[f]===void 0)&&(this[f]=e[u]):(r||!this.has(u))&&this.set(u,e[u])});return}let n={};for(var[o,i]of this)n[o]=i;return n}set cacheControl(e){return this.set("Cache-Control",e)}get cacheControl(){return this.get("Cache-Control")}set contentLength(e){return this.set("Content-Length",e)}get contentLength(){return this.get("Content-Length")}set contentType(e){return this.set("Content-Type",e)}get contentType(){return this.get("Content-Type")}static compat(e){if(!(e instanceof this)&&!e.json){let r=Te(new this);Object.keys(r).forEach(n=>{typeof n=="symbol"||n in e||Object.defineProperty(e,n,r[n])})}return e}};function Te(t){if(t){let e=Object.getPrototypeOf(t);return e===Object.prototype?{}:{...Te(e),...Object.getOwnPropertyDescriptors(t)}}else return Object.create(null)}var z=class extends Map{constructor(...e){super(...e),Object.defineProperty(this,"inLock",{value:!1,writable:!0}),Object.defineProperty(this,"outLock",{value:!1,writable:!0})}set(e,r){if(this.inLock)return;this.has(e)&&this.delete(e),this.inLock=!0;let n=r,o=r,i;return x(r)&&(n=this.parseEntry(`=${r}`)[1]),i=super.set(e,n),this.outLock||(m(r)&&(o=this.stringifyEntry(r)),lt(this.headers,`${e}=${o}`)),this.inLock=!1,i}delete(e){if(this.inLock)return;this.inLock=!0;let r=super.delete(e);this.headers.delete(this.headers.cookieHeaderName);for(let[n,o]of this)lt(this.headers,`${n}=${this.stringifyEntry(o)}`);return this.inLock=!1,r}clear(){if(this.inLock)return;this.inLock=!0;let e=super.clear();return this.headers.delete(this.headers.cookieHeaderName),this.inLock=!1,e}json(e={}){if(arguments.length){this.clear();for(let r in e)this.set(r,e[r]);return}for(let[r,n]of this)e[r]=n;return e}toString(){return this.headers.get(this.headers.cookieHeaderName)}};function lt(t,e){let r=[e],n=t.get(t.cookieHeaderName);n&&r.unshift(n),t.set(t.cookieHeaderName,r.join(t.cookieHeaderSeparator))}var ue=class extends B{get cookieHeaderName(){return"Cookie"}get cookieHeaderSeparator(){return";"}get Cookies(){return $e}set accept(e){return this.set("Accept",e)}get accept(){let e=this.get("Accept"),r=e&&e.split(",").map(n=>(n=n.trim().split(";").map(o=>o.trim()),[n.shift(),parseFloat((n.pop()||"1").replace("q=",""))])).sort((n,o)=>n[1]>o[1]?-1:1)||[];return{match(n){return n=(n+"").split("/"),r.reduce((o,i)=>o||(i=i[0].split("/"))&&[0,1].every(s=>n[s]===i[s]||n[s]==="*"||i[s]==="*"),!1)},toString(){return e}}}set range(e){let r=[];return I(e).forEach((n,o)=>{let i=Array.isArray(n)?n.join("-"):n+"";o===0&&!i.includes("bytes=")&&(i=`bytes=${i}`),r.push(i)}),this.set("Range",r.join(", "))}get range(){let e=this.get("Range");return e?H(e,"bytes=").split(",").map(n=>{let o=n.trim().split("-");return o[0]=o[0]?parseInt(o[0],10):void 0,o[1]&&(o[1]=parseInt(o[1],10)),o.clamp=i=>{(o[1]>i-1||o[1]===void 0)&&(o[1]=i-1),o[0]===void 0&&(o[0]=o[1]?i-o[1]-1:0)},o}):void 0}set cors(e){return this.set("Access-Control-Allow-Origin",e===!0?"*":e===!1?"":e)}get cors(){return this.get("Access-Control-Allow-Origin")}},$e=class extends z{parse(e){return S.parse(e,";")}parseEntry(e){return e.trim().split("=")}stringifyEntry(e){return e}};var R=class extends _e(Request,ue){constructor(e,r={},n={}){if(!(r instanceof Request)){if("body"in r){let[o,i,s]=K(r);n={...n,type:s,body:r.body},r={...r,body:o,headers:i}}}super(e,r,n)}static compat(e){return e instanceof this?e:e instanceof Request?Object.setPrototypeOf(e,new this):new this(e)}static async rip(e){let r=["method","headers","mode","credentials","cache","redirect","referrer","integrity"].reduce((n,o)=>({[o]:e[o],...n}),{});return["GET","HEAD"].includes(e.method)||(r.body=await e.clone().arrayBuffer()),r.mode==="navigate"&&(r.mode="cors"),[e.url,r]}};var ce=class extends B{get cookieHeaderName(){return"Set-Cookie"}get cookieHeaderSeparator(){return","}get Cookies(){return Ne}set contentRange(e){if(Array.isArray(e)){if(e.length===2&&!e[0].includes("-")||e.length<2)throw new Error("A Content-Range array must be in the format: [ 'start-end', 'total' ]");return this.set("Content-Range",`bytes ${e.join("/")}`)}return this.set("Content-Range",e)}get contentRange(){let e=this.get("Content-Range");return e&&H(e,"bytes ").split("/")}set cors(e){return this.set("Access-Control-Allow-Origin",e===!0?"*":e===!1?"":e)}get cors(){return this.get("Access-Control-Allow-Origin")}set attachment(e){if(e=e===!0?"attachment":e===!1?"inline":e,!x(e))throw new Error(`The "download" response directive does not support the type: ${be(e)}`);return["attachment","inline"].includes(e)||(e=`attachment; filename="${e}"`),this.set("Content-Disposition",e)}get attachment(){var e=(this.get("Content-Disposition")||"").trim();return e=e==="attachment"?!0:e==="inline"?!1:H(ge(e,'"'),'filename="'),e}get location(){return this.get("Location")}set location(e){return this.set("Location",e)}},Ne=class extends z{parse(e){let r={};return e&&e.split(",").forEach(n=>{let[o,i]=this.parseEntry(n);r[o]=i}),r}parseEntry(e){let[r,n]=e.split(";"),[o,i]=r.trim().split("="),s={value:i};return n&&(n||"").split(/\;/g).map(a=>a.trim().split("=")).forEach(a=>{s[a[0][0].toLowerCase()+a[0].substring(1).replace("-","")]=a.length===1?!0:a[1]}),[o,s]}stringifyEntry(e){if(m(e)){let r=[e.value];for(let n in e){if(n==="value")continue;let o=n[0].toUpperCase()+n.substring(1);o==="MaxAge"&&(o="Max-Age"),r.push(e[n]===!0?o:`${o}=${e[n]}`)}e=r.join(";")}return e}};var L=class extends _e(Response,ce){constructor(e=null,r={},n={}){if(e||e===0){let o,i,s=e;[e,o,i]=K({body:e,headers:r.headers}),n={...r,type:i,body:s},r={...r,headers:o}}super(e,r,n)}static compat(e){return e instanceof this?e:e instanceof Response?Object.setPrototypeOf(e,new this):new this(e)}};var ar=async(t,e={})=>{if(e.body){let[o,i]=K(e);e={...e,body:o,headers:i}}let r=await fetch(t,e),n;if(e.decompress===!1&&(n=r.headers.get("Content-Encoding"))){let o=r.body.pipeThrough(new CompressionStream(n));r=new Response(o,r)}return r},ht=ar;var G=class extends URL{constructor(...e){super(...e);var r=S.parse(this.search);let n=o=>{var i=S.stringify(o);i=i?"?"+i:"",i!==this.search&&(this.search=i)};this.__query={value:r,proxy:new Proxy(this,{set(o,i,s){return o.__query.value[i]=s,n(o.__query.value),!0},deleteProperty(o,i){return delete o.__query.value[i],n(o.__query.value),!0}})}}set search(e){super.search=e;var r=S.parse(e);je(r,this.query)||(this.__query.value=r)}get search(){return super.search}get query(){return this.__query.proxy}};G.Observable=class extends G{constructor(){super(...arguments);let{Observer:t}=webqit;t.accessorize(this,["protocol","username","password","host","hostname","port","origin","pathname","search","query","hash","href"])}};var je=(t,e)=>m(t)&&m(e)?je(Object.keys(t),Object.keys(e))&&je(Object.values(t),Object.values(e)):h(t)&&h(e)?t.length===e.length&&t.reduce((r,n,o)=>r&&n===e[o],!0):t===e;var U=class{constructor(e,r,n,o){this._request=e,this._detail=r||{},this._sessionFactory=n,this._storageFactory=o,this.Request=R,this.Response=L,this.URL=G,this.port={listeners:[],post(i){let s=this.listeners.map(a=>a(i)).filter(a=>a instanceof Promise);if(process.length)return Promise.all(s)},listen(i){this.listeners.push(i)}}}get url(){return this._url||(this._url=new this.URL(this._request.url)),this._url}get request(){return this._request}get detail(){return this._detail}get session(){return this._session||(this._session=this.sessionFactory()),this._session}get storage(){return this._storage||(this._storage=this.storageFactory()),this._storage}sessionFactory(...e){return this._sessionFactory(...e)}storageFactory(...e){return this._storageFactory(...e)}redirect(e,r=302){return new this.Response(null,{status:r,headers:{Location:e}})}async with(e,r={}){let n;return e instanceof Request?(r instanceof Request&&([,r]=await R.rip(r)),n=M(r)?e:new R(e,r)):(e=new this.URL(e,this.url.origin),[,r]=await R.rip(this._request),n=new R(e,{...r,referrer:this.request.url})),new U(n,this.detail,this._sessionFactory,this.storageFactory)}};var le=class{constructor(e,r){if(this.cx=e,this.cx.runtime=this,this.app=_(r)?r(this.cx):r,!this.app||!this.app.handle)throw new Error('Application instance must define a ".handle()" method.')}};var{Observer:d}=webqit;var Z=class extends le{constructor(e,r){if(super(e,r),d.set(this,"location",new q(window.document.location)),d.set(this,"network",{}),window.addEventListener("online",()=>d.set(this.network,"connectivity","online")),window.addEventListener("offline",()=>d.set(this.network,"connectivity","offline")),this.useNavigationAPI=window.navigation,this.useNavigationAPI?(this.home=window.navigation.currentEntry,this._initNavigationAPI()):this._initLegacyAPI(),this.cx.params.service_worker?.filename){let{public_base_url:n,service_worker:{filename:o,...i},env:s}=this.cx.params,a=new ae(n+o,{...i,startMessages:!0},s);d.set(this,"workport",a)}(async()=>{let n;if(this.app.init){let o=this.generateRequest(this.location),i=new U(o,{navigationType:"init"},(s=null,a=!1)=>this.getSession(i,s,a));n=await this.app.init(i,(...s)=>this.remoteFetch(...s))}n!==!1&&this.go(this.location,{},{navigationType:"startup",navigationOrigins:[]})})()}_initLegacyAPI(){let e=(r,n)=>{let o=this._getScrollContainer();try{window.history.replaceState({...this.currentEntry().getState()||{},navigationOrigins:this._serializeOrigins(r),scrollPosition:o===window?[]:[o.scrollLeft,o.scrollTop]},"",window.location.href)}catch{}try{window.history.pushState({},"",n)}catch{}};window.addEventListener("click",r=>{if(!this._canIntercept(r))return;var n=r.target.closest("a");if(!n||!n.href||n.target||n.download||!this.isSpaRoute(n))return;if(this.isHashChange(n)){d.set(this.location,"href",n.href);return}r.preventDefault(),this._abortController?.abort(),this._abortController=new AbortController;let o={navigationType:"push",navigationOrigins:[n],destination:this._asEntry(null),source:this.currentEntry(),userInitiated:!0};e([n],n.href),this.go(q.copy(n),{signal:this._abortController.signal},o)}),window.addEventListener("submit",r=>{if(!this._canIntercept(r))return;let n=r.target.closest("form"),o=r.submitter,i=["action","enctype","method","noValidate","target"].reduce((c,l)=>(c[l]=o&&o.hasAttribute(`form${l.toLowerCase()}`)?o[`form${ye(l)}`]:n[l],c),{});if(i.method=o&&o.dataset.formmethod||n.dataset.method||i.method,i.target||!this.isSpaRoute(i.action))return;var s=window.document.createElement("a");if(s.href=i.action,this.isHashChange(anchorEl)){d.set(this.location,"href",anchorEl.href);return}var a=new FormData(n);if((o||{}).name&&a.set(o.name,o.value),i.method.toUpperCase()==="GET"){var u={};Array.from(a.entries()).forEach(c=>{S.set(u,c[0],c[1])}),s.search=S.stringify(u),a=null}r.preventDefault(),this._abortController?.abort(),this._abortController=new AbortController;let f={navigationType:"push",navigationOrigins:[o,n],destination:this._asEntry(null),source:this.currentEntry(),userInitiated:!0};e([o,n],s.href),this.go(q.copy(s),{method:i.method,body:a,signal:this._abortController.signal},f)}),window.addEventListener("popstate",r=>{if(this.isHashChange(location)){d.set(this.location,"href",location.href);return}let n={navigationType:"traverse",navigationOrigins:[],destination:this._asEntry(r.state),source:this.currentEntry(),userInitiated:!0},o=location.href;this.go(o,{},n)})}_initNavigationAPI(){let e=[];window.addEventListener("click",r=>{if(!this._canIntercept(r))return;let n=r.target.closest("a");!n||!n.href||n.target||(e=[n])}),window.addEventListener("submit",r=>{!this._canIntercept(r)||(e=[r.submitter,r.target.closest("form")])}),window.navigation.addEventListener("navigate",r=>{if(!r.canIntercept||r.downloadRequest!==null)return;if(r.hashChange){d.set(this.location,"href",r.destination.url);return}let{navigationType:n,destination:o,signal:i,formData:s,info:a,userInitiated:u}=r,f={navigationType:n,navigationOrigins:e,destination:o,source:this.currentEntry(),userInitiated:u,info:a},c=this._getScrollContainer();this.updateCurrentEntry({state:{...this.currentEntry().getState()||{},navigationOrigins:this._serializeOrigins(e),scrollPosition:c===window?[]:[c.scrollLeft,c.scrollTop]}}),e=[];let l=o.url,p={method:s&&"POST"||"GET",body:s,signal:i},y=this;r.intercept({scroll:c!==window&&"manual"||"after-transition",focusReset:c!==window&&"manual"||"after-transition",async handler(){await y.go(l,p,f)}})})}_asEntry(e){return{getState(){return e}}}_canIntercept(e){return!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}_uniqueId(){return(0|Math.random()*9e6).toString(36)}_serializeOrigins(e){return e.map(r=>{let n=r.getAttribute(this._webfloOriginIdAttr);return n||(n=this._uniqueId()+":auto",r.setAttribute(this._webfloOriginIdAttr,n)),n})}_deserializeOrigins(e){return e.map(r=>{let n=document.querySelector(`[${this._webfloOriginIdAttr}="${r}"]`);return n&&r.endsWith(":auto")&&n.toggleAttribute(this._webfloOriginIdAttr,!1),n})}_transitOrigins(e,r,n=0){if(!window.webqit?.oohtml?.configs)return;let{BINDINGS_API:{api:o}={}}=window.webqit.oohtml.configs;e.forEach(i=>{i&&(i[o.bindings].active=r)}),n&&setTimeout(()=>{e.forEach(i=>{i&&(i[o.bindings].active=!r)})},n)}_getScrollContainer(){if(!window.webqit?.oohtml?.configs)return;let{CONTEXT_API:{attr:e}={}}=window.webqit.oohtml.configs;return window.document.body.querySelector(`[${window.CSS.escape(e.contextname)}="app"]`)||window}_webfloOriginIdAttr="webflo-navigation-origin-id";_xRedirectCode=200;isHashChange(e){return j(this.location.href,"#")===j(e.href,"#")&&(this.location.href.includes("#")||e.href.includes("#"))}isSpaRoute(e){if(e=typeof e=="string"?new URL(e,this.location.origin):e,e.origin&&e.origin!==this.location.origin)return!1;if(!this.cx.params.routing)return!0;if(this.cx.params.routing.targets===!1)return!1;let r=e.pathname.split("/").filter(o=>o),n=o=>(o=o.split("/").filter(i=>i),o.reduce((i,s,a)=>i&&(s===r[a]||[s,r[a]].includes("-")),!0));return n(this.cx.params.routing.root)&&this.cx.params.routing.subroots.reduce((o,i)=>o&&!n(i),!0)}async remoteFetch(e,...r){let n=e;return e instanceof Request?n=e.url:e instanceof URL&&(n=e.href),d.set(this.network,"remote",n,{diff:!0}),ht(e,...r).then(async i=>(d.set(this.network,"remote",null,{diff:!0}),L.compat(i)))}generateRequest(e,r={}){return new R(e,{...r,headers:{Accept:"application/json","X-Redirect-Policy":"manual-when-cross-spa","X-Redirect-Code":this._xRedirectCode,"X-Powered-By":"@webqit/webflo",...r.headers||{}}})}createStorage(e,r=null,n=!1){return ut(r,n)}reload(e){return this.useNavigationAPI?window.navigation.reload(e):window.history.reload()}back(){return this.useNavigationAPI?window.navigation.canGoBack&&window.navigation.back():window.history.back()}forward(){return this.useNavigationAPI?window.navigation.canGoForward&&window.navigation.forward():window.history.forward()}traverseTo(...e){return this.useNavigationAPI?window.navigation.traverseTo(...e):window.history.go(...e)}entries(){return this.useNavigationAPI?window.navigation.entries():history}currentEntry(){return window.navigation?window.navigation.currentEntry:this._asEntry(history.state)}async updateCurrentEntry(e,r=null){if(this.useNavigationAPI){!r||r===window.navigation.currentEntry.url?window.navigation.updateCurrentEntry(e):await window.navigation.navigate(r,{...e,history:"replace"}).committed;return}window.history.replaceState(e.state,"",r)}async push(e,r={}){typeof e=="string"&&e.startsWith("&")&&(e=this.location.href.split("#")[0]+(this.location.href.includes("?")?e:e.replace("&","?"))),e=new URL(e,this.location.href),this.useNavigationAPI?await window.navigation.navigate(e.href,r).committed:window.history.pushState(r,"",e.href),d.set(this.location,"href",e.href)}async go(e,r={},n={}){if(e=typeof e=="string"?new URL(e,this.location.origin):e,!(r instanceof Request)&&!r.referrer&&(r={referrer:this.location.href,...r}),!["startup","rdr"].includes(n.navigationType)&&j(e.href,"#")===j(r.referrer,"#")&&(r.method||"GET").toUpperCase()==="GET")return;d.set(this.network,"error",null,{diff:!0}),d.set(this.network,"requesting",{init:r,detail:n}),n.navigationType!=="traverse"&&this._transitOrigins(n.navigationOrigins,!0);let o=this.generateRequest(e.href,r),i=new U(o,n,(f=null,c=!1)=>this.createStorage(i,f,c)),s;try{s=await this.app.handle(i,(...f)=>this.remoteFetch(...f)),typeof s>"u"?s=new L(null,{status:404}):s instanceof L||(s=L.compat(s))}catch(f){console.error(f),d.set(this.network,"error",{...f,retry:()=>this.go(e,r,n)}),s=new L(f.message,{status:500})}let a=s.headers.get("Location");if(a){let f=parseInt(s.headers.get("X-Redirect-Code"));if(f&&s.status===this._xRedirectCode&&(s.attrs.status=f),[302,301].includes(s.status)){d.set(this.network,"redirecting",a,{diff:!0}),this.isSpaRoute(a)?this.go(a,{},{navigationType:"rdr",navigationOrigins:[]}):window.location=a;return}}let u=async()=>{d.set(this.network,"requesting",null,{diff:!0}),d.set(this.network,"redirecting",null,{diff:!0}),[404,500].includes(s.status)&&d.set(this.network,"error",new Error(s.statusText,{code:s.status}));let f=s.url||o.url;d.set(this.location,"href",f);let c=(await this.app.render?.(i,s),{}),l=this._getScrollContainer();if(n.navigationType==="traverse"){let p=n.destination?.getState()||{};this._transitOrigins(this._deserializeOrigins(p.navigationOrigins||[]),!0,110),l!==window&&p.scrollPosition?.length&&(l.scroll(...p.scrollPosition),(document.querySelector("[autofocus]")||document.body).focus())}else{this._transitOrigins(n.navigationOrigins,!1);let p={...this.currentEntry().getState()||{},...c,redirected:s.redirected};await this.updateCurrentEntry({state:p},f),l!==window&&i.url.hash&&(document.querySelector(i.url.hash)?.scrollIntoView({behavior:"smooth"}),(document.querySelector("[autofocus]")||document.body).focus())}await new Promise(p=>setTimeout(p,100))};return document.startViewTransition&&n.navigationType!=="startup"?(window.webqit?.realdom?.synthesizeWhile||(c=>c()))(async()=>{document.documentElement.classList.toggle("transiting",!0);try{await document.startViewTransition(u).ready}catch(c){console.log(c)}document.documentElement.classList.toggle("transiting",!1)}):await u()}};async function fr(t=null){let e=this||{},r=n=>new se(n);return new Z(Y.create(e),t||r)}self.webqit||(self.webqit={});webqit.Webflo=Ue;var{start:ur}=webqit.Webflo,cr={},lr={bundle_filename:"bundle.js",public_base_url:"/",spa_routing:!0,service_worker:{filename:"worker.js",scope:"/",support_push:!0,vapid_key_env:"VAPID_PUBLIC_KEY",push_registration_url_env:"PUSH_REGISTRATION_PUBLIC_URL"},bundle_public_env:!0,routing:{root:"/",subroots:[],targets:2}};webqit.app=await ur.call({layout:cr,params:lr});
