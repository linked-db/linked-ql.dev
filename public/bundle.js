/** @webqit/webflo */
var gt=Object.defineProperty;var yt=(t,e)=>()=>(t&&(e=t(t=0)),e);var Se=(t,e)=>{for(var r in e)gt(t,r,{get:e[r],enumerable:!0})};var st={};Se(st,{URLPattern:()=>ot});function bt(t,e){return(e?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(t)}function Ve(t,e=!1){let r=[],n=0;for(;n<t.length;){let o=t[n],s=function(f){if(!e)throw new TypeError(f);r.push({type:"INVALID_CHAR",index:n,value:t[n++]})};if(o==="*"){r.push({type:"ASTERISK",index:n,value:t[n++]});continue}if(o==="+"||o==="?"){r.push({type:"MODIFIER",index:n,value:t[n++]});continue}if(o==="\\"){r.push({type:"ESCAPED_CHAR",index:n++,value:t[n++]});continue}if(o==="{"){r.push({type:"OPEN",index:n,value:t[n++]});continue}if(o==="}"){r.push({type:"CLOSE",index:n,value:t[n++]});continue}if(o===":"){let f="",a=n+1;for(;a<t.length;){let u=t.substr(a,1);if(a===n+1&&wt.test(u)||a!==n+1&&_t.test(u)){f+=t[a++];continue}break}if(!f){s(`Missing parameter name at ${n}`);continue}r.push({type:"NAME",index:n,value:f}),n=a;continue}if(o==="("){let f=1,a="",u=n+1,c=!1;if(t[u]==="?"){s(`Pattern cannot start with "?" at ${u}`);continue}for(;u<t.length;){if(!bt(t[u],!1)){s(`Invalid character '${t[u]}' at ${u}.`),c=!0;break}if(t[u]==="\\"){a+=t[u++]+t[u++];continue}if(t[u]===")"){if(f--,f===0){u++;break}}else if(t[u]==="("&&(f++,t[u+1]!=="?")){s(`Capturing groups are not allowed at ${u}`),c=!0;break}a+=t[u++]}if(c)continue;if(f){s(`Unbalanced pattern at ${n}`);continue}if(!a){s(`Missing pattern at ${n}`);continue}r.push({type:"PATTERN",index:n,value:a}),n=u;continue}r.push({type:"CHAR",index:n,value:t[n++]})}return r.push({type:"END",index:n,value:""}),r}function Je(t,e={}){let r=Ve(t),{prefixes:n="./"}=e,o=`[^${Q(e.delimiter||"/#?")}]+?`,s=[],f=0,a=0,u="",c=new Set,p=y=>{if(a<r.length&&r[a].type===y)return r[a++].value},m=()=>{let y=p("MODIFIER");return y||p("ASTERISK")},x=y=>{let O=p(y);if(O!==void 0)return O;let{type:L,index:E}=r[a];throw new TypeError(`Unexpected ${L} at ${E}, expected ${y}`)},S=()=>{let y="",O;for(;O=p("CHAR")||p("ESCAPED_CHAR");)y+=O;return y},G=y=>y,k=e.encodePart||G;for(;a<r.length;){let y=p("CHAR"),O=p("NAME"),L=p("PATTERN");if(!O&&!L&&p("ASTERISK")&&(L=".*"),O||L){let v=y||"";n.indexOf(v)===-1&&(u+=v,v=""),u&&(s.push(k(u)),u="");let A=O||f++;if(c.has(A))throw new TypeError(`Duplicate name '${A}'.`);c.add(A),s.push({name:A,prefix:k(v),suffix:"",pattern:L||o,modifier:m()||""});continue}let E=y||p("ESCAPED_CHAR");if(E){u+=E;continue}if(p("OPEN")){let v=S(),A=p("NAME")||"",N=p("PATTERN")||"";!A&&!N&&p("ASTERISK")&&(N=".*");let dt=S();x("CLOSE");let He=m()||"";if(!A&&!N&&!He){u+=v;continue}if(!A&&!N&&!v)continue;u&&(s.push(k(u)),u=""),s.push({name:A||(N?f++:""),pattern:A&&!N?o:N,prefix:k(v),suffix:k(dt),modifier:He});continue}u&&(s.push(k(u)),u=""),x("END")}return s}function Q(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function Ge(t){return t&&t.sensitive?"u":"ui"}function St(t,e){if(!e)return t;let r=/\((?:\?<(.*?)>)?(?!\?)/g,n=0,o=r.exec(t.source);for(;o;)e.push({name:o[1]||n++,prefix:"",suffix:"",modifier:"",pattern:""}),o=r.exec(t.source);return t}function Ot(t,e,r){let n=t.map(o=>Ze(o,e,r).source);return new RegExp(`(?:${n.join("|")})`,Ge(r))}function vt(t,e,r){return Xe(Je(t,r),e,r)}function Xe(t,e,r={}){let{strict:n=!1,start:o=!0,end:s=!0,encode:f=p=>p}=r,a=`[${Q(r.endsWith||"")}]|$`,u=`[${Q(r.delimiter||"/#?")}]`,c=o?"^":"";for(let p of t)if(typeof p=="string")c+=Q(f(p));else{let m=Q(f(p.prefix)),x=Q(f(p.suffix));if(p.pattern)if(e&&e.push(p),m||x)if(p.modifier==="+"||p.modifier==="*"){let S=p.modifier==="*"?"?":"";c+=`(?:${m}((?:${p.pattern})(?:${x}${m}(?:${p.pattern}))*)${x})${S}`}else c+=`(?:${m}(${p.pattern})${x})${p.modifier}`;else p.modifier==="+"||p.modifier==="*"?c+=`((?:${p.pattern})${p.modifier})`:c+=`(${p.pattern})${p.modifier}`;else c+=`(?:${m}${x})${p.modifier}`}if(s)n||(c+=`${u}?`),c+=r.endsWith?`(?=${a})`:"$";else{let p=t[t.length-1],m=typeof p=="string"?u.indexOf(p[p.length-1])>-1:p===void 0;n||(c+=`(?:${u}(?=${a}))?`),m||(c+=`(?=${u}|${a})`)}return new RegExp(c,Ge(r))}function Ze(t,e,r){return t instanceof RegExp?St(t,e):Array.isArray(t)?Ot(t,e,r):vt(t,e,r)}function Ct(t,e){return t.length?t[0]==="/"?!0:!e||t.length<2?!1:(t[0]=="\\"||t[0]=="{")&&t[1]=="/":!1}function Qe(t,e){return t.startsWith(e)?t.substring(e.length,t.length):t}function At(t,e){return t.endsWith(e)?t.substr(0,t.length-e.length):t}function Ke(t){return!t||t.length<2?!1:t[0]==="["||(t[0]==="\\"||t[0]==="{")&&t[1]==="["}function et(t){if(!t)return!0;for(let e of Ye)if(t.test(e))return!0;return!1}function Et(t,e){if(t=Qe(t,"#"),e||t==="")return t;let r=new URL("https://example.com");return r.hash=t,r.hash?r.hash.substring(1,r.hash.length):""}function Rt(t,e){if(t=Qe(t,"?"),e||t==="")return t;let r=new URL("https://example.com");return r.search=t,r.search?r.search.substring(1,r.search.length):""}function Lt(t,e){return e||t===""?t:Ke(t)?nt(t):rt(t)}function $t(t,e){if(e||t==="")return t;let r=new URL("https://example.com");return r.password=t,r.password}function It(t,e){if(e||t==="")return t;let r=new URL("https://example.com");return r.username=t,r.username}function Tt(t,e,r){if(r||t==="")return t;if(e&&!Ye.includes(e))return new URL(`${e}:${t}`).pathname;let n=t[0]=="/";return t=new URL(n?t:"/-"+t,"https://example.com").pathname,n||(t=t.substring(2,t.length)),t}function jt(t,e,r){return tt(e)===t&&(t=""),r||t===""?t:it(t)}function Nt(t,e){return t=At(t,":"),e||t===""?t:Ee(t)}function tt(t){switch(t){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function Ee(t){if(t==="")return t;if(/^[-+.A-Za-z0-9]*$/.test(t))return t.toLowerCase();throw new TypeError(`Invalid protocol '${t}'.`)}function Ft(t){if(t==="")return t;let e=new URL("https://example.com");return e.username=t,e.username}function qt(t){if(t==="")return t;let e=new URL("https://example.com");return e.password=t,e.password}function rt(t){if(t==="")return t;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(t))throw new TypeError(`Invalid hostname '${t}'`);let e=new URL("https://example.com");return e.hostname=t,e.hostname}function nt(t){if(t==="")return t;if(/[^0-9a-fA-F[\]:]/g.test(t))throw new TypeError(`Invalid IPv6 hostname '${t}'`);return t.toLowerCase()}function it(t){if(t===""||/^[0-9]*$/.test(t)&&parseInt(t)<=65535)return t;throw new TypeError(`Invalid port '${t}'.`)}function Ut(t){if(t==="")return t;let e=new URL("https://example.com");return e.pathname=t[0]!=="/"?"/-"+t:t,t[0]!=="/"?e.pathname.substring(2,e.pathname.length):e.pathname}function Dt(t){return t===""?t:new URL(`data:${t}`).pathname}function Ht(t){if(t==="")return t;let e=new URL("https://example.com");return e.search=t,e.search.substring(1,e.search.length)}function Mt(t){if(t==="")return t;let e=new URL("https://example.com");return e.hash=t,e.hash.substring(1,e.hash.length)}function ze(t,e){if(typeof t!="string")throw new TypeError("parameter 1 is not of type 'string'.");let r=new URL(t,e);return{protocol:r.protocol.substring(0,r.protocol.length-1),username:r.username,password:r.password,hostname:r.hostname,port:r.port,pathname:r.pathname,search:r.search!=""?r.search.substring(1,r.search.length):void 0,hash:r.hash!=""?r.hash.substring(1,r.hash.length):void 0}}function ne(t,e,r){let n;if(typeof e.baseURL=="string")try{n=new URL(e.baseURL),t.protocol=n.protocol?n.protocol.substring(0,n.protocol.length-1):"",t.username=n.username,t.password=n.password,t.hostname=n.hostname,t.port=n.port,t.pathname=n.pathname,t.search=n.search?n.search.substring(1,n.search.length):"",t.hash=n.hash?n.hash.substring(1,n.hash.length):""}catch{throw new TypeError(`invalid baseURL '${e.baseURL}'.`)}if(typeof e.protocol=="string"&&(t.protocol=Nt(e.protocol,r)),typeof e.username=="string"&&(t.username=It(e.username,r)),typeof e.password=="string"&&(t.password=$t(e.password,r)),typeof e.hostname=="string"&&(t.hostname=Lt(e.hostname,r)),typeof e.port=="string"&&(t.port=jt(e.port,t.protocol,r)),typeof e.pathname=="string"){if(t.pathname=e.pathname,n&&!Ct(t.pathname,r)){let o=n.pathname.lastIndexOf("/");o>=0&&(t.pathname=n.pathname.substring(0,o+1)+t.pathname)}t.pathname=Tt(t.pathname,t.protocol,r)}return typeof e.search=="string"&&(t.search=Rt(e.search,r)),typeof e.hash=="string"&&(t.hash=Et(e.hash,r)),t}function ie(t){return t.replace(/([+*?:{}()\\])/g,"\\$1")}function zt(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function Vt(t,e){let r=".*",n=`[^${zt(e.delimiter||"/#?")}]+?`,o=/[$_\u200C\u200D\p{ID_Continue}]/u,s="";for(let f=0;f<t.length;++f){let a=t[f],u=f>0?t[f-1]:null,c=f<t.length-1?t[f+1]:null;if(typeof a=="string"){s+=ie(a);continue}if(a.pattern===""){if(a.modifier===""){s+=ie(a.prefix);continue}s+=`{${ie(a.prefix)}}${a.modifier}`;continue}let p=typeof a.name!="number",m=e.prefixes!==void 0?e.prefixes:"./",x=a.suffix!==""||a.prefix!==""&&(a.prefix.length!==1||!m.includes(a.prefix));if(!x&&p&&a.pattern===n&&a.modifier===""&&c&&!c.prefix&&!c.suffix)if(typeof c=="string"){let S=c.length>0?c[0]:"";x=o.test(S)}else x=typeof c.name=="number";if(!x&&a.prefix===""&&u&&typeof u=="string"&&u.length>0){let S=u[u.length-1];x=m.includes(S)}x&&(s+="{"),s+=ie(a.prefix),p&&(s+=`:${a.name}`),a.pattern===r?!p&&(!u||typeof u=="string"||u.modifier||x||a.prefix!=="")?s+="*":s+=`(${r})`:a.pattern===n?p||(s+=`(${n})`):s+=`(${a.pattern})`,a.pattern===n&&p&&a.suffix!==""&&o.test(a.suffix[0])&&(s+="\\"),s+=ie(a.suffix),x&&(s+="}"),s+=a.modifier}return s}var wt,_t,H,Pt,kt,Ye,Wt,Bt,D,ot,at=yt(()=>{wt=/[$_\p{ID_Start}]/u,_t=/[$_\u200C\u200D\p{ID_Continue}]/u;H={delimiter:"",prefixes:"",sensitive:!0,strict:!0},Pt={delimiter:".",prefixes:"",sensitive:!0,strict:!0},kt={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};Ye=["ftp","file","http","https","ws","wss"];Wt=class{constructor(t){this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=0,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=t}get result(){return this.internalResult}parse(){for(this.tokenList=Ve(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===0){this.rewind(),this.isHashPrefix()?this.changeState(9,1):this.isSearchPrefix()?(this.changeState(8,1),this.internalResult.hash=""):(this.changeState(7,0),this.internalResult.search="",this.internalResult.hash="");continue}else if(this.state===2){this.rewindAndSetState(5);continue}this.changeState(10,0);break}if(this.groupDepth>0)if(this.isGroupClose())this.groupDepth-=1;else continue;if(this.isGroupOpen()){this.groupDepth+=1;continue}switch(this.state){case 0:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(1));break;case 1:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();let t=7,e=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(t=2,e=3):this.shouldTreatAsStandardURL&&(t=2),this.changeState(t,e)}break;case 2:this.isIdentityTerminator()?this.rewindAndSetState(3):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(5);break;case 3:this.isPasswordPrefix()?this.changeState(4,1):this.isIdentityTerminator()&&this.changeState(5,1);break;case 4:this.isIdentityTerminator()&&this.changeState(5,1);break;case 5:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(6,1):this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 6:this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 7:this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 8:this.isHashPrefix()&&this.changeState(9,1);break;case 9:break;case 10:break}}}changeState(t,e){switch(this.state){case 0:break;case 1:this.internalResult.protocol=this.makeComponentString();break;case 2:break;case 3:this.internalResult.username=this.makeComponentString();break;case 4:this.internalResult.password=this.makeComponentString();break;case 5:this.internalResult.hostname=this.makeComponentString();break;case 6:this.internalResult.port=this.makeComponentString();break;case 7:this.internalResult.pathname=this.makeComponentString();break;case 8:this.internalResult.search=this.makeComponentString();break;case 9:this.internalResult.hash=this.makeComponentString();break;case 10:break}this.changeStateWithoutSettingComponent(t,e)}changeStateWithoutSettingComponent(t,e){this.state=t,this.componentStart=this.tokenIndex+e,this.tokenIndex+=e,this.tokenIncrement=0}rewind(){this.tokenIndex=this.componentStart,this.tokenIncrement=0}rewindAndSetState(t){this.rewind(),this.state=t}safeToken(t){return t<0&&(t=this.tokenList.length-t),t<this.tokenList.length?this.tokenList[t]:this.tokenList[this.tokenList.length-1]}isNonSpecialPatternChar(t,e){let r=this.safeToken(t);return r.value===e&&(r.type==="CHAR"||r.type==="ESCAPED_CHAR"||r.type==="INVALID_CHAR")}isProtocolSuffix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}nextIsAuthoritySlashes(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")}isIdentityTerminator(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")}isPasswordPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPortPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPathnameStart(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")}isSearchPrefix(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;let t=this.safeToken(this.tokenIndex-1);return t.type!=="NAME"&&t.type!=="PATTERN"&&t.type!=="CLOSE"&&t.type!=="ASTERISK"}isHashPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")}isGroupOpen(){return this.tokenList[this.tokenIndex].type=="OPEN"}isGroupClose(){return this.tokenList[this.tokenIndex].type=="CLOSE"}isIPv6Open(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")}isIPv6Close(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")}makeComponentString(){let t=this.tokenList[this.tokenIndex],e=this.safeToken(this.componentStart).index;return this.input.substring(e,t.index)}computeShouldTreatAsStandardURL(){let t={};Object.assign(t,H),t.encodePart=Ee;let e=Ze(this.makeComponentString(),void 0,t);this.shouldTreatAsStandardURL=et(e)}},Bt=["protocol","username","password","hostname","port","pathname","search","hash"],D="*";ot=class{constructor(t={},e){this.regexp={},this.keys={},this.component_pattern={};try{if(typeof t=="string"){let o=new Wt(t);if(o.parse(),t=o.result,e)if(typeof e=="string")t.baseURL=e;else throw new TypeError("'baseURL' parameter is not of type 'string'.");else if(typeof t.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.")}else if(e)throw new TypeError("parameter 1 is not of type 'string'.");if(!t||typeof t!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");let r={pathname:D,protocol:D,username:D,password:D,hostname:D,port:D,search:D,hash:D};this.pattern=ne(r,t,!0),tt(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");let n;for(n of Bt){if(!(n in this.pattern))continue;let o={},s=this.pattern[n];switch(this.keys[n]=[],n){case"protocol":Object.assign(o,H),o.encodePart=Ee;break;case"username":Object.assign(o,H),o.encodePart=Ft;break;case"password":Object.assign(o,H),o.encodePart=qt;break;case"hostname":Object.assign(o,Pt),Ke(s)?o.encodePart=nt:o.encodePart=rt;break;case"port":Object.assign(o,H),o.encodePart=it;break;case"pathname":et(this.regexp.protocol)?(Object.assign(o,kt),o.encodePart=Ut):(Object.assign(o,H),o.encodePart=Dt);break;case"search":Object.assign(o,H),o.encodePart=Ht;break;case"hash":Object.assign(o,H),o.encodePart=Mt;break}try{let f=Je(s,o);this.regexp[n]=Xe(f,this.keys[n],o),this.component_pattern[n]=Vt(f,o)}catch{throw new TypeError(`invalid ${n} pattern '${this.pattern[n]}'.`)}}}catch(r){throw new TypeError(`Failed to construct 'URLPattern': ${r.message}`)}}test(t={},e){let r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof t>"u")return!1;try{typeof t=="object"?r=ne(r,t,!1):r=ne(r,ze(t,e),!1)}catch{return!1}let n;for(n in this.pattern)if(!this.regexp[n].exec(r[n]))return!1;return!0}exec(t={},e){let r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof t>"u")return;try{typeof t=="object"?r=ne(r,t,!1):r=ne(r,ze(t,e),!1)}catch{return null}let n={};e?n.inputs=[t,e]:n.inputs=[t];let o;for(o in this.pattern){let s=this.regexp[o].exec(r[o]);if(!s)return null;let f={};for(let[a,u]of this.keys[o].entries())if(typeof u.name=="string"||typeof u.name=="number"){let c=s[a+1];f[u.name]=c}n[o]={input:r[o]||"",groups:f}}return n}get protocol(){return this.component_pattern.protocol}get username(){return this.component_pattern.username}get password(){return this.component_pattern.password}get hostname(){return this.component_pattern.hostname}get port(){return this.component_pattern.port}get pathname(){return this.component_pattern.pathname}get search(){return this.component_pattern.search}get hash(){return this.component_pattern.hash}};globalThis.URLPattern||(globalThis.URLPattern=ot)});var De={};Se(De,{APIS:()=>Ue,start:()=>cr});var ee=class{constructor(e,r=null){Object.defineProperty(this,"dict",{value:Object.create(e)});for(let n in this.dict)n in this||(this[n]=this.dict[n]);arguments.length>1&&Object.defineProperty(this.dict,"CWD",{get:()=>r})}get name(){return"webflo"}static create(...e){return new this(...e)}get CWD(){return this.dict.CWD||""}get meta(){return this.dict.meta||{}}get app(){return this.dict.app||{}}get config(){return this.dict.config||{}}get flags(){return this.dict.flags||{}}set flags(e){Object.defineProperty(this.dict,"flags",{value:e})}get layout(){return this.dict.layout||{}}set layout(e){Object.defineProperty(this.dict,"layout",{value:e})}get logger(){return this.dict.logger}set logger(e){Object.defineProperty(this.dict,"logger",{value:e})}};var te=class extends ee{};function d(t){return!Array.isArray(t)&&typeof t=="object"&&t}function Oe(t){return typeof t}function h(t){return Array.isArray(t)}function re(t){return t===!0||t===!1}function Z(t){return typeof t=="function"}function me(t){return t===null||t===""}function $(t){return arguments.length&&(t===void 0||typeof t>"u")}function w(t){return Array.isArray(t)||typeof t=="object"&&t||Z(t)}function W(t){return me(t)||$(t)||t===!1||t===0||w(t)&&!Object.keys(t).length}function _(t){return Z(t)||t&&{}.toString.call(t)==="[object function]"}function B(t){return t instanceof Number||typeof t=="number"}function C(t){return B(t)||t!==!0&&t!==!1&&t!==null&&t!==""&&!isNaN(t*1)}function ve(t){return h(t)&&Object.getPrototypeOf(t)===Array.prototype}function de(t){return d(t)&&Object.getPrototypeOf(t)===Object.prototype}function b(t){return t instanceof String||typeof t=="string"&&t!==null}function Pe(t){return!b(t)&&!$(t.length)}function ge(t,...e){return e.forEach(r=>{t.indexOf(r)<0&&t.push(r)}),t}function ke(n,e){e=e||Object.prototype,e=e&&!h(e)?[e]:e;for(var r=[],n=n;n&&(!e||e.indexOf(n)<0)&&n.name!=="default";)r.push(n),n=n?Object.getPrototypeOf(n):null;return r}function Ce(t,e){var r=[];return ke(t,e).forEach(n=>{ge(r,...Object.getOwnPropertyNames(n))}),r}function F(t,e,r=!1,n=!1,o=!1){var s=0,f=t.shift();if((C(f)||f===!0||f===!1)&&(s=f,f=t.shift()),!t.length)throw new Error("_merge() requires two or more array/objects.");return t.forEach((a,u)=>{!w(a)&&!_(a)||(r?Ce(a):Object.keys(a)).forEach(c=>{if(!!e(c,f,a,u)){var p=f[c],m=a[c];if((h(p)&&h(m)||d(p)&&d(m))&&(s===!0||s>0))f[c]=h(p)&&h(m)?[]:{},F([C(s)?s-1:s,f[c],p,m],e,r,n,o);else if(h(f)&&h(a))n?f[c]=m:f.push(m);else try{o?Object.defineProperty(f,c,Object.getOwnPropertyDescriptor(a,c)):f[c]=a[c]}catch{}}})}),f}function ye(...t){return F(t,(e,r,n)=>!0,!1,!1,!1)}typeof URLPattern>"u"&&await Promise.resolve().then(()=>(at(),st));var P={parse(t,e="&"){t=t||"";let r={};return(t.startsWith("?")?t.substr(1):t).split(e).filter(n=>n).map(n=>n.split("=").map(o=>o.trim())).forEach(n=>this.set(r,n[0],decodeURIComponent(n[1]))),r},stringify(t,e="&"){let r=[];return Object.keys(t).forEach(n=>{this.reduceValue(t[n],n,(o,s,f=void 0)=>{if(f)return f;r.push(`${s}=${encodeURIComponent(o)}`)})}),r.join(e)},get(t,e){return this.reducePath(e,t,(r,n)=>{if(!(!n&&n!==0))return n[r]})},set(t,e,r){this.reducePath(e,t,function(n,o,s=void 0){let f=r;return s&&(f=s),n===""&&h(o)?o.push(f):o[n]=f,f})},reduceValue(t,e,r){if(w(t)){let n=Object.keys(t),o=r(t,e,n);if(h(o))return o.forEach(s=>{this.reduceValue(t[s],e?`${e}[${s}]`:s,r)})}r(t,e)},reducePath(t,e,r){if(b(t)&&t.endsWith("]")&&w(e)){let[n,...o]=t.split("[");C(n)&&(n=parseInt(n)),o=o.join("[").replace("]","");let s;if(n in e)s=e[n];else{let f=o===""||C(o.split("[")[0])?[]:{};s=r(n,e,f)}return this.reducePath(o,s,r)}return C(t)&&(t=parseInt(t)),r(t,e)}},ft={join(){let t=[],e=0;for(let n=0,o=arguments.length;n<o;n++)t=t.concat(arguments[n].split("/"));let r=[];for(i=0,l=t.length;i<l;i++){let n=t[i];!n||n==="."||(n===".."?r.length?r.pop():e++:r.push(n))}return t[0]===""&&r.unshift(""),"../".repeat(e)+r.join("/")||(r.length?"/":".")},dirname(t){return this.join(t,"..")}};function M(t,e,r=!1){if(e=="")return t;var n=r?t.lastIndexOf(e):t.indexOf(e);return n===-1?"":t.substr(n+e.length)}function q(t,e,r=!1){if(e=="")return t;var n=r?t.lastIndexOf(e):t.indexOf(e);return n===-1?t:t.substr(0,n)}function I(t,e=!0){return h(t)?t:!e&&d(t)?[t]:t!==!1&&t!==0&&W(t)?[]:Pe(t)?Array.prototype.slice.call(t):d(t)?Object.values(t):[t]}var oe=class{constructor(e,r=[]){this.cx=e,this.path=h(r)?r:(r+"").split("/").filter(n=>n)}async route(e,r,n,o,s=null){let f=this,a=this.cx.runtime,u=async function(c){let p={runtime:a};if(!c.trail||c.trail.length<c.destination.length){if(c=await f.readTick(c),p.pathname=`/${c.trail.join("/")}`,p.stepname=c.trail[c.trail.length-1],f.finalizeHandlerContext(p,c),c.exports){c.exports.hints&&await r.port.post({...c.exports.hints,$type:"handler:hints"});let m=I(c.method).map(S=>S==="default"?S:S.toUpperCase()),x=_(c.exports)&&m.includes("default")?c.exports:m.reduce((S,G)=>S||c.exports[G],null);if(x){let S=async(...k)=>{let y={...c,arg:k[0]};if(k.length>1){let O=k[1],L,E={...k[2]||{}};if(k[1]instanceof y.event.Request)L=k[1],O=L.url;else if(!b(O))throw new Error("Router redirect url must be a string!");let X=O.startsWith("/")?O:f.pathJoin(`/${c.trail.join("/")}`,O);if(X.startsWith("../"))throw new Error("Router redirect cannot traverse beyond the routing directory! ("+O+" >> "+X+")");E.method&&(y.method=E.method,h(E.method)&&(E.method=E.method[0])),L?y.event=await c.event.with(X,L,E):y.event=await c.event.with(X,E),y.source=c.destination.join("/"),y.destination=X.split("?").shift().split("/").map(v=>v.trim()).filter(v=>v),y.trail=k[1].startsWith("/")?[]:c.trail.reduce((v,A,N)=>v.length===N&&A===y.destination[N]?v.concat(A):v,[]),y.trailOnFile=c.trailOnFile.slice(0,y.trail.length)}return u(y)},G=c.destination.slice(c.trail.length);return S.pathname=G.join("/"),S.stepname=G[0],await x.call(p,c.event,c.arg,S,s)}return u(c)}else if((c.currentSegmentOnFile||{}).dirExists)return u(c)}if(o)return await o.call(p,c.event,c.arg,s)};return u({destination:this.path,event:r,method:e,arg:n})}};var se=class extends oe{async readTick(e){e={...e};var r=this.cx.layout,n=Object.keys(this.cx.layout);return e.trail?(e.currentSegment=e.destination[e.trail.length],e.currentSegmentOnFile=[e.currentSegment,"-"].reduce((o,s)=>{if(o.index)return o;var f=`/${e.trailOnFile.concat(s).join("/")}`;return r[f]?{seg:s,index:f}:n.filter(a=>a.startsWith(`${f}/`)).length?{seg:s,dirExists:!0}:o},{seg:null}),e.trail=e.trail.concat(e.currentSegment),e.trailOnFile=e.trailOnFile.concat(e.currentSegmentOnFile.seg),e.exports=r[e.currentSegmentOnFile.index]):(e.trail=[],e.trailOnFile=[],e.currentSegmentOnFile={index:"/"},e.exports=r["/"]),e}finalizeHandlerContext(e,r){return e.dirname=r.currentSegmentOnFile.index}pathJoin(...e){return ft.join(...e)}};var ae=class{constructor(e){this.cx=e}async init(e,r){return new this.Router(this.cx,"/").route(["init"],e,{},async o=>{},r)}};var fe=class extends ae{get Router(){return se}async handle(e,r){let n=new this.Router(this.cx,e.url.pathname),o=async()=>n.route([e.request.method,"default"],e,{...document.state?.data||{}},async s=>(s!==e&&(s.request.headers.has("Accept")||s.request.headers.set("Accept","application/json")),r(s.request)),r);return await(this.cx.middlewares||[]).concat(o).reverse().reduce((s,f)=>()=>f.call(this.cx,e,n,s),null)()}async render(e,r){let n=await r.jsonfy();return new this.Router(this.cx,e.url.pathname).route("render",e,n,async(s,f)=>{if(window.webqit.dom&&await new Promise(a=>window.webqit.dom.ready(a)),window.webqit&&window.webqit.oohtml){let{BINDINGS_API:{api:a}={},HTML_MODULES:{context:{attr:u}={}}={}}=window.webqit.oohtml.configs;a&&window.document[a.bind]({env:"client",state:this.cx.runtime,...f},{diff:!0});let c;u&&(c=window.document.body.querySelector(`[${window.CSS.escape(u.contextname)}="routes"]`)||window.document.body,c.setAttribute(u.importscontext,"/"+`routes/${s.url.pathname}`.split("/").map(p=>p.trim()).filter(p=>p).join("/"))),await this.scrollIntoView(s,c)}else await this.scrollIntoView(s);return window})}async unrender(e){window.document.bind({state:this.cx.runtime},{diff:!0})}async scrollIntoView(e,r){if(e.detail.srcType!=="link")return;await new Promise(o=>setTimeout(o,10));let n;e.url.hash&&(n=document.querySelector(e.url.hash))?n.scrollIntoView():(r||(r=document.body))&&r.scrollIntoView()}};var Ue={};Se(Ue,{HttpEvent:()=>U,Observer:()=>g,default:()=>Y});function xe(t,e){return q(t,e,!0)}function we(t,e){return typeof t!="string"?t:t.replace(/\w\S*/g,function(r){return r.charAt(0).toUpperCase()+(typeof e!==void 0&&e?r.substr(1).toLowerCase():r.substr(1))})}function lt(t=null,e=!1){let r=e?"localStorage":"sessionStorage";if(!window[r])throw new Error(`The specified Web Storage API ${r} is invalid or not supported`);let n={},o=s=>t?`${t}.${s.key}`:s.key;return g.intercept(n,{get:(s,f,a)=>{if(!b(s.key))return;let u=window[r].getItem(o(s));return a($(u)?u:JSON.parse(u))},set:(s,f,a)=>{if(!!b(s.key))return window[r].setItem(o(s),$(s.value)?s.value:JSON.stringify(s.value)),a(!0)},deleteProperty:(s,f,a)=>{if(!!b(s.key))return window[r].removeItem(o(s)),a(!0)},has:(s,f,a)=>{if(!b(s.key))return;let u=o(s);for(let c=0;c<window[r].length;c++)if(window[r].key(c)===u)return a(!0);return a(!1)},ownKeys:(s,f,a)=>{let u=[];for(let c=0;c<window[r].length;c++)u.push(window[r].key(c));return a(u)},getOwnPropertyDescriptor:(s,f,a)=>a({enumerable:!0,configurable:!0})}),g.proxy(n)}function Le(t,e=null){var r={};return arguments.length===2&&(h(t)&&h(e)?t.forEach((n,o)=>r[n]=e[o]):r[t]=e),r}function Ie(t,e,r=null){return ye(t,d(e)?e:Le(e,r))}var T=class{constructor(e){let r=this.constructor;var n=(o,s)=>d(o)&&d(s)?n(Object.keys(o),Object.keys(s))&&n(Object.values(o),Object.values(s)):h(o)&&h(s)?o.length===s.length&&o.reduce((f,a,u)=>f&&a===s[u],!0):o===s;g.intercept(this,"set",(o,s,f)=>o.key==="hash"&&o.value&&!o.value.startsWith("#")?f("#"+o.value):o.key==="search"&&o.value&&!o.value.startsWith("?")?f("?"+o.value):f()),g.observe(this,o=>{var s={},f;for(var a of o){if(a.key==="href"&&a.related.length===1){var s=r.parseUrl(a.value);delete s.query,delete s.href,f=!0}if(a.key==="query"&&(a.path?.length>1||!a.related.includes("search"))){var u=r.toSearch(this.query);u!==this.search&&(s.search=u)}if(a.key==="search"){var c=r.toQuery(s.search||this.search);n(c,this.query)||(s.query=c)}}if(!f){var p=this.origin,m=[this.username,this.password].filter(S=>S);m.length===2&&(p=`${this.protocol}//${m.join(":")}@${this.hostname}${this.port?`:${this.port}`:""}`);var x=[p,s.pathname||this.pathname,s.search||this.search,this.hash].join("");x!==this.href&&(s.href=x)}if(!W(s))return g.set(this,s)},{subtree:!0,diff:!0}),g.observe(this,o=>{o.forEach(s=>{if(s&&s.detail){if(!w(s.detail))throw new Error('"e.detail" can only be of type object.');if(s.detail.request&&!d(s.detail.request))throw new Error('"e.detail.request" can only be of type object.')}})},{diff:!0}),g.set(this,b(e)?r.parseUrl(e):T.copy(e))}toString(){return this.href}static from(e){return new this(d(e)?e:this.parseUrl(e))}static copy(e){var r=or.reduce((n,o)=>Ie(n,o,e[o]),{});return"query"in e||delete r.query,r}static parseUrl(e){var r=document.createElement("a");return r.href=e,this.copy(r)}static toQuery(e){return P.parse(e)}static toSearch(e){var r=P.stringify(e);return r?"?"+r:""}},or=["protocol","username","password","host","hostname","port","origin","pathname","search","query","hash","href"];var ue=class{constructor(e,r={}){this.ready=navigator.serviceWorker?navigator.serviceWorker.ready:new Promise(()=>{}),this.registration=new Promise((o,s)=>{if(!navigator.serviceWorker)return;let f=()=>{navigator.serviceWorker.register(e,{scope:r.scope||"/"}).then(async a=>{let u=p=>{let m=p.state==="installed"?"waiting":p.state==="activating"||p.state==="activated"?"active":p.state;g.set(this,m,p)},c=a.active||a.waiting||a.installing;u(c),c.addEventListener("statechange",p=>u(p.target)),a.addEventListener("updatefound",()=>{u(a.installing),a.installing.addEventListener("statechange",p=>u(p.target))}),o(a)}).catch(a=>s(a))};r.onWindowLoad?window.addEventListener("load",f):f(),r.startMessages&&navigator.serviceWorker.startMessages()});let n=(o,s,f=1)=>{if(this.active)_(o)&&(o=o()),s(this.active,o);else if(f){let a=g.observe(this,"active",u=>{_(o)&&(o=o()),s(u.value,o),f!==2&&a.abort()})}};this.messaging={post:(o,s=1)=>(n(o,(f,a)=>{f.postMessage(a)},s),this.post),listen:o=>(navigator.serviceWorker&&navigator.serviceWorker.addEventListener("message",s=>{let f=o(s),a=s.ports[0];a&&(f instanceof Promise?f.then(u=>{a.postMessage(u)}):a.postMessage(f))}),this.post),request:(o,s=1)=>new Promise(f=>{n(o,(a,u)=>{let c=new MessageChannel;a.postMessage(u,[c.port2]),c.port1.onmessage=p=>f(p.data)},s)}),channel(o){this.channels.has(o)||this.channels.set(o,new BroadcastChannel(s));let s=this.channels.get(o);return{broadcast:f=>s.postMessage(f),listen:f=>s.addEventListener("message",f)}},channels:new Map},this.notifications={fire:(o,s={})=>new Promise((f,a)=>{if(typeof Notification>"u"||Notification.permission!=="granted")return a(typeof Notification<"u"&&Notification&&Notification.permission);u.addEventListener("error",a);let u=new Notification(o,s);u.addEventListener("click",f),u.addEventListener("close",f)})},this.push={getSubscription:async()=>(await this.registration).pushManager.getSubscription(),subscribe:async(o,s={})=>{var f=await this.push.getSubscription();return f||(await this.registration).pushManager.subscribe(d(o)?o:{applicationServerKey:sr(o),...s})},unsubscribe:async()=>{var o=await this.push.getSubscription();return o?o.unsubscribe():null}}}};function sr(t){for(var e="=".repeat((4-t.length%4)%4),r=(t+e).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(r),o=new Uint8Array(n.length),s=0;s<n.length;++s)o[s]=n.charCodeAt(s);return o}function K(t){let e=t.headers instanceof Headers?[...t.headers.keys()].reduce((o,s)=>({...o,[s]:t.headers.get(s)}),{}):Object.keys(t.headers||{}).reduce((o,s)=>({...o,[s.toLowerCase()]:t.headers[s]}),{}),r=t.body,n=Te(t.body);if(["Blob","File"].includes(n))!e["content-type"]&&(e["content-type"]=r.type),!e["content-length"]&&(e["content-length"]=r.size);else if(["Uint8Array","Uint16Array","Uint32Array","ArrayBuffer"].includes(n))!e["content-length"]&&(e["content-length"]=r.byteLength);else if(n==="json"&&w(r)){if(!e["content-type"]){let[o,s]=ar(r);s?(r=JSON.stringify(r,(f,a)=>a instanceof Error?{...a,message:a.message}:a),e["content-type"]="application/json",e["content-length"]=new Blob([r]).size):(r=o,n="FormData")}}else n==="json"&&!e["content-length"]&&(e["content-length"]=(r+"").length);return[r,e,n]}function ar(t={},e=!0){let r=new FormData,n=!0;return P.reduceValue(t,"",(o,s,f=void 0)=>{if(f){let a=Te(o)==="json";return n=n&&a,a&&f}e&&[!0,!1,null].includes(o)&&(o=new Blob([o],{type:"application/json"})),r.append(s,o)}),[r,n]}async function pt(t,e=!0){let r=!0,n;for(let[o,s]of t.entries()){n||(n=C(q(o,"["))?[]:{});let f=Te(s);if(e&&["Blob","File"].includes(f)&&s.type==="application/json"&&[4,5].includes(s.size)){let a=await s.text();["true","false","null"].includes(a)&&(f="json",s=JSON.parse(a))}r=r&&f==="json",P.set(n,o,s)}return[n,r]}function Te(t){if(b(t)||B(t)||re(t))return"json";if(!w(t))return;let e=t[Symbol.toStringTag],r=["Uint8Array","Uint16Array","Uint32Array","ArrayBuffer","Blob","File","FormData","Stream","ReadableStream"].reduce((n,o)=>n||(e===o?o:null),null);if(r)return r;if(d(t)&&de(t)||h(t)&&ve(t)||"toString"in t)return"json"}var ce=class extends FormData{async json(e={}){return(await pt(this,...arguments))[0]}static compat(e){if(e instanceof this)return e;if(e instanceof FormData)return Object.setPrototypeOf(e,new this)}};var fr=(t,e)=>{let r=class extends t{constructor(n,o,s){o.headers&&(o={...o,headers:new e(o.headers)}),super(n,o),s.headers&&this.headers.json(s.headers);let f={};Object.defineProperty(this,"_attrs",{get:()=>f}),Object.defineProperty(this,"meta",{get:()=>s})}get attrs(){return this._attrs||{}}clone(){return new this.constructor(super.clone())}get headers(){return e.compat(super.headers),super.headers}get url(){return"url"in this.attrs?this.attrs.url:super.url}async arrayBuffer(){return this.meta.type==="ArrayBuffer"?this.meta.body:super.arrayBuffer()}async blob(){return["Blob","File"].includes(this.meta.type)?this.meta.body:super.blob()}async formData(){let n;return this.meta.type==="FormData"&&this.meta.body instanceof FormData?n=this.meta.body:n=await super.formData(),n&&(n=ce.compat(n)),n}async json(){return this.meta.type==="json"&&w(this.meta.body)?this.meta.body:super.json()}async text(){return this.meta.type==="json"&&!w(this.meta.body)?this.meta.body:super.text()}jsonfy(n=!1){return(!this.meta.jsonfied||n)&&(this.meta.jsonfied=new Promise(async(o,s)=>{let f,a=this.headers.get("Content-Type")||"";try{a==="application/x-www-form-urlencoded"||a.startsWith("multipart/form-data")?f=await(await this.formData())?.json():a==="application/json"?f=await this.json():a==="text/plain"&&(f=await this.text()),o(f)}catch(u){s(u)}})),this.meta.jsonfied}};return r.Headers=e,r},be=fr;var z=class extends Headers{constructor(e={}){let r=e.cookies;delete e.cookies,e instanceof Headers?super(e):(super(),this.json(e)),this.cookies=r}set(e,r){return this.catchCookies(e,r),super.set(e,r)}append(e,r){return this.catchCookies(e,r,!0),super.append(e,r)}delete(e){return this.catchCookies(e),super.delete(e)}set cookies(e){if(e instanceof Map){this.cookies.clear();for(let[r,n]of e)this.cookies.set(r,n)}else e&&this.set(this.cookieHeaderName,e);return!0}get cookies(){return this._cookies||(this._cookies=new this.Cookies,Object.defineProperty(this._cookies,"headers",{value:this})),this._cookies}catchCookies(e,r,n=!1){if(!(!this.cookies||e.toLowerCase()!==this.cookieHeaderName.toLowerCase())){if(this.cookies.outLock=!0,arguments.length>1){n||this.cookies.clear();let o=this.cookies.parse(r);for(let s in o)this.cookies.set(s,o[s])}else this.cookies.clear();this.cookies.outLock=!1}}json(e={},r=!0){if(arguments.length){let f=je(this),a=Object.keys(f).reduce((u,c)=>u.concat(typeof c!="symbol"&&"set"in f[c]?c:[]),[]);Object.keys(e).forEach(u=>{var c=a.reduce((p,m)=>p||(m===u||m.toLocaleLowerCase()===u?m:null),null);c?(r||this[c]===void 0)&&(this[c]=e[u]):(r||!this.has(u))&&this.set(u,e[u])});return}let n={};for(var[o,s]of this)n[o]=s;return n}set cacheControl(e){return this.set("Cache-Control",e)}get cacheControl(){return this.get("Cache-Control")}set contentLength(e){return this.set("Content-Length",e)}get contentLength(){return this.get("Content-Length")}set contentType(e){return this.set("Content-Type",e)}get contentType(){return this.get("Content-Type")}static compat(e){if(!(e instanceof this)&&!e.json){let r=je(new this);Object.keys(r).forEach(n=>{typeof n=="symbol"||n in e||Object.defineProperty(e,n,r[n])})}return e}};function je(t){if(t){let e=Object.getPrototypeOf(t);return e===Object.prototype?{}:{...je(e),...Object.getOwnPropertyDescriptors(t)}}else return Object.create(null)}var V=class extends Map{constructor(...e){super(...e),Object.defineProperty(this,"inLock",{value:!1,writable:!0}),Object.defineProperty(this,"outLock",{value:!1,writable:!0})}set(e,r){if(this.inLock)return;this.has(e)&&this.delete(e),this.inLock=!0;let n=r,o=r,s;return b(r)&&(n=this.parseEntry(`=${r}`)[1]),s=super.set(e,n),this.outLock||(d(r)&&(o=this.stringifyEntry(r)),ht(this.headers,`${e}=${o}`)),this.inLock=!1,s}delete(e){if(this.inLock)return;this.inLock=!0;let r=super.delete(e);this.headers.delete(this.headers.cookieHeaderName);for(let[n,o]of this)ht(this.headers,`${n}=${this.stringifyEntry(o)}`);return this.inLock=!1,r}clear(){if(this.inLock)return;this.inLock=!0;let e=super.clear();return this.headers.delete(this.headers.cookieHeaderName),this.inLock=!1,e}json(e={}){if(arguments.length){this.clear();for(let r in e)this.set(r,e[r]);return}for(let[r,n]of this)e[r]=n;return e}toString(){return this.headers.get(this.headers.cookieHeaderName)}};function ht(t,e){let r=[e],n=t.get(t.cookieHeaderName);n&&r.unshift(n),t.set(t.cookieHeaderName,r.join(t.cookieHeaderSeparator))}var le=class extends z{get cookieHeaderName(){return"Cookie"}get cookieHeaderSeparator(){return";"}get Cookies(){return Ne}set accept(e){return this.set("Accept",e)}get accept(){let e=this.get("Accept"),r=e&&e.split(",").map(n=>(n=n.trim().split(";").map(o=>o.trim()),[n.shift(),parseFloat((n.pop()||"1").replace("q=",""))])).sort((n,o)=>n[1]>o[1]?-1:1)||[];return{match(n){return n=(n+"").split("/"),r.reduce((o,s)=>o||(s=s[0].split("/"))&&[0,1].every(f=>n[f]===s[f]||n[f]==="*"||s[f]==="*"),!1)},toString(){return e}}}set range(e){let r=[];return I(e).forEach((n,o)=>{let s=Array.isArray(n)?n.join("-"):n+"";o===0&&!s.includes("bytes=")&&(s=`bytes=${s}`),r.push(s)}),this.set("Range",r.join(", "))}get range(){let e=this.get("Range");return e?M(e,"bytes=").split(",").map(n=>{let o=n.trim().split("-");return o[0]=o[0]?parseInt(o[0],10):void 0,o[1]&&(o[1]=parseInt(o[1],10)),o.clamp=s=>{(o[1]>s-1||o[1]===void 0)&&(o[1]=s-1),o[0]===void 0&&(o[0]=o[1]?s-o[1]-1:0)},o}):void 0}set cors(e){return this.set("Access-Control-Allow-Origin",e===!0?"*":e===!1?"":e)}get cors(){return this.get("Access-Control-Allow-Origin")}},Ne=class extends V{parse(e){return P.parse(e,";")}parseEntry(e){return e.trim().split("=")}stringifyEntry(e){return e}};var j=class extends be(Request,le){constructor(e,r={},n={}){if(!(r instanceof Request)){if("body"in r){let[o,s,f]=K(r);n={...n,type:f,body:r.body},r={...r,body:o,headers:s}}}super(e,r,n)}static compat(e){return e instanceof this?e:e instanceof Request?Object.setPrototypeOf(e,new this):new this(e)}static async rip(e){let r=["method","headers","mode","credentials","cache","redirect","referrer","integrity"].reduce((n,o)=>({[o]:e[o],...n}),{});return["GET","HEAD"].includes(e.method)||(r.body=await e.clone().arrayBuffer()),r.mode==="navigate"&&(r.mode="cors"),[e.url,r]}};var pe=class extends z{get cookieHeaderName(){return"Set-Cookie"}get cookieHeaderSeparator(){return","}get Cookies(){return Fe}set contentRange(e){if(Array.isArray(e)){if(e.length===2&&!e[0].includes("-")||e.length<2)throw new Error("A Content-Range array must be in the format: [ 'start-end', 'total' ]");return this.set("Content-Range",`bytes ${e.join("/")}`)}return this.set("Content-Range",e)}get contentRange(){let e=this.get("Content-Range");return e&&M(e,"bytes ").split("/")}set cors(e){return this.set("Access-Control-Allow-Origin",e===!0?"*":e===!1?"":e)}get cors(){return this.get("Access-Control-Allow-Origin")}set attachment(e){if(e=e===!0?"attachment":e===!1?"inline":e,!b(e))throw new Error(`The "download" response directive does not support the type: ${Oe(e)}`);return["attachment","inline"].includes(e)||(e=`attachment; filename="${e}"`),this.set("Content-Disposition",e)}get attachment(){var e=(this.get("Content-Disposition")||"").trim();return e=e==="attachment"?!0:e==="inline"?!1:M(xe(e,'"'),'filename="'),e}get location(){return this.get("Location")}set location(e){return this.set("Location",e)}},Fe=class extends V{parse(e){let r={};return e&&e.split(",").forEach(n=>{let[o,s]=this.parseEntry(n);r[o]=s}),r}parseEntry(e){let[r,n]=e.split(";"),[o,s]=r.trim().split("="),f={value:s};return n&&(n||"").split(/\;/g).map(a=>a.trim().split("=")).forEach(a=>{f[a[0][0].toLowerCase()+a[0].substring(1).replace("-","")]=a.length===1?!0:a[1]}),[o,f]}stringifyEntry(e){if(d(e)){let r=[e.value];for(let n in e){if(n==="value")continue;let o=n[0].toUpperCase()+n.substring(1);o==="MaxAge"&&(o="Max-Age"),r.push(e[n]===!0?o:`${o}=${e[n]}`)}e=r.join(";")}return e}};var R=class extends be(Response,pe){constructor(e=null,r={},n={}){if(e||e===0){let o,s,f=e;[e,o,s]=K({body:e,headers:r.headers}),n={...r,type:s,body:f},r={...r,headers:o}}super(e,r,n)}static compat(e){return e instanceof this?e:e instanceof Response?Object.setPrototypeOf(e,new this):new this(e)}};var ur=async(t,e={})=>{if(e.body){let[o,s]=K(e);e={...e,body:o,headers:s}}let r=await fetch(t,e),n;if(e.decompress===!1&&(n=r.headers.get("Content-Encoding"))){let o=r.body.pipeThrough(new CompressionStream(n));r=new Response(o,r)}return r},mt=ur;var J=class extends URL{constructor(...e){super(...e);var r=P.parse(this.search);let n=o=>{var s=P.stringify(o);s=s?"?"+s:"",s!==this.search&&(this.search=s)};this.__query={value:r,proxy:new Proxy(r,{set(o,s,f){return o[s]=f,n(o),!0},deleteProperty(o,s){return delete o[s],n(o),!0}})}}set search(e){super.search=e;var r=P.parse(e);qe(r,this.query)||(this.query=r)}get search(){return super.search}get query(){return this.__query.proxy}};J.Observable=class extends J{constructor(){super(...arguments);let{Observer:t}=webqit;t.accessorize(this,["protocol","username","password","host","hostname","port","origin","pathname","search","query","hash","href"])}};var qe=(t,e)=>d(t)&&d(e)?qe(Object.keys(t),Object.keys(e))&&qe(Object.values(t),Object.values(e)):h(t)&&h(e)?t.length===e.length&&t.reduce((r,n,o)=>r&&n===e[o],!0):t===e;var U=class{constructor(e,r,n,o){this._request=e,this._detail=r||{},this._sessionFactory=n,this._storageFactory=o,this.Request=j,this.Response=R,this.URL=J,this.port={listeners:[],post(s){let f=this.listeners.map(a=>a(s)).filter(a=>a instanceof Promise);if(process.length)return Promise.all(f)},listen(s){this.listeners.push(s)}}}get url(){return this._url||(this._url=new this.URL(this._request.url)),this._url}get request(){return this._request}get detail(){return this._detail}get session(){return this._session||(this._session=this.sessionFactory()),this._session}get storage(){return this._storage||(this._storage=this.storageFactory()),this._storage}sessionFactory(...e){return this._sessionFactory(...e)}storageFactory(...e){return this._storageFactory(...e)}redirect(e,r=302){return new this.Response(null,{status:r,headers:{Location:e}})}async with(e,r={}){let n;return e instanceof Request?(r instanceof Request&&([,r]=await j.rip(r)),n=W(r)?e:new j(e,r)):(e=new this.URL(e,this.url.origin),[,r]=await j.rip(this._request),n=new j(e,{...r,referrer:this.request.url})),new U(n,this.detail,this._sessionFactory,this.storageFactory)}};var he=class{constructor(e,r){if(this.cx=e,this.cx.runtime=this,this.app=_(r)?r(this.cx):r,!this.app||!this.app.handle)throw new Error('Application instance must define a ".handle()" method.')}};var{Observer:g}=webqit;var Y=class extends he{constructor(e,r){if(super(e,r),g.set(this,"location",new T(window.document.location)),g.observe(this.location,"href",n=>{if(!(n.value==="http:"||(n.detail||{}).src===window.document.location))if(n.value===window.document.location.href||n.value+"/"===window.document.location.href)window.history.replaceState(window.history.state,"",this.location.href);else try{window.history.pushState(window.history.state,"",this.location.href)}catch{}},{diff:!0}),window.addEventListener("popstate",n=>{window.setTimeout(()=>{this.go(T.copy(window.document.location),{},{src:window.document.location,srcType:"history"})},0)}),window.addEventListener("click",n=>{var o=n.target.closest("a");!o||!o.href||!o.target&&!o.download&&this.isSpaRoute(o,n)&&(this.go(T.copy(o),{},{src:o,srcType:"link"}),this.isHashAction(o)||n.preventDefault())}),window.addEventListener("submit",n=>{let o=n.target.closest("form"),s=n.submitter,f=["action","enctype","method","noValidate","target"].reduce((p,m)=>(p[m]=s&&s.hasAttribute(`form${m.toLowerCase()}`)?s[`form${we(m)}`]:o[m],p),{});f.method=s&&s.dataset.formmethod||o.dataset.method||f.method,f.submitter=s;var a=window.document.createElement("a");if(a.href=f.action,!f.target&&this.isSpaRoute(a,n)){var u=new FormData(o);if((s||{}).name&&u.set(s.name,s.value),f.method.toUpperCase()==="GET"){var c=P.parse(a.search);Array.from(u.entries()).forEach(p=>{P.set(c,p[0],p[1])}),a.search=P.stringify(c),u=null}this.go(T.copy(a),{method:f.method,body:u},{...f,src:o,srcType:"form"}),this.isHashAction(a)||n.preventDefault()}}),g.set(this,"network",{}),window.addEventListener("online",()=>g.set(this.network,"connectivity","online")),window.addEventListener("offline",()=>g.set(this.network,"connectivity","offline")),this.cx.params.service_worker_support){let{public_base_url:n,worker_filename:o,worker_scope:s}=this.cx.params,f=new ue(n+o,{scope:s,startMessages:!0});g.set(this,"workport",f)}(async()=>{let n;if(this.app.init){let o=this.generateRequest(this.location),s=new U(o,{srcType:"initialization"},(f=null,a=!1)=>this.getSession(s,f,a));n=await this.app.init(s,(...f)=>this.remoteFetch(...f))}n!==!1&&this.go(this.location,{},{srcType:"hydration"})})()}get history(){return window.history}isHashAction(e){return q(window.document.location.href,"#")===q(e.href,"#")&&e.href.includes("#")}isSpaRoute(e,r=void 0){if(e=typeof e=="string"?new URL(e,this.location.origin):e,e.origin&&e.origin!==this.location.origin||r&&(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey))return!1;if(!this.cx.params.routing)return!0;if(this.cx.params.routing.targets===!1)return!1;let n=e.pathname.split("/").filter(s=>s),o=s=>(s=s.split("/").filter(f=>f),s.reduce((f,a,u)=>f&&(a===n[u]||[a,n[u]].includes("-")),!0));return o(this.cx.params.routing.root)&&this.cx.params.routing.subroots.reduce((s,f)=>s&&!o(f),!0)}generateRequest(e,r={}){return new j(e,{signal:this._abortController&&this._abortController.signal,...r,headers:{Accept:"application/json","X-Redirect-Policy":"manual-when-cross-spa","X-Redirect-Code":this._xRedirectCode,"X-Powered-By":"@webqit/webflo",...r.headers||{}}})}createStorage(e,r=null,n=!1){return lt(r,n)}async go(e,r={},n={}){if(e=typeof e=="string"?new URL(e,this.location.origin):e,!(r instanceof Request)&&!r.referrer&&(r={referrer:this.location.href,...r}),!["hydration","rdr"].includes(n.srcType)&&q(e.href,"#")===q(r.referrer,"#")&&(r.method||"GET").toUpperCase()==="GET")return new R(null,{status:304});this._abortController&&this._abortController.abort(),this._abortController=new AbortController,this._xRedirectCode=200,g.set(this.network,"error",null),g.set(this.network,"requesting",{init:r,...n}),["link","form"].includes(n.srcType)&&(n.src.state&&(n.src.state.active=!0),n.submitter&&n.submitter.state&&(n.submitter.state.active=!0));let o=this.generateRequest(e.href,r),s=new U(o,n,(u=null,c=!1)=>this.createStorage(s,u,c)),f,a;try{f=await this.app.handle(s,(...u)=>this.remoteFetch(...u)),a=this.handleResponse(s,f),f&&f.redirected?g.set(this.location,{href:f.url},{detail:{redirected:!0,...n}}):[302,301].includes(a.status)||g.set(this.location,T.copy(e),{detail:n}),["link","form"].includes(n.srcType)&&(n.src.state&&(n.src.state.active=!1),n.submitter&&n.submitter.state&&(n.submitter.state.active=!1)),a.ok&&(a.headers.contentType==="application/json"||a.headers.contentType.startsWith("multipart/form-data"))?this.app.render&&await this.app.render(s,a):a.ok||([404,500].includes(a.status)&&g.set(this.network,"error",new Error(a.statusText,{cause:a.status})),a.headers.get("Location")||this.app.unrender&&await this.app.unrender(s))}catch(u){console.error(u),g.set(this.network,"error",{...u,retry:()=>this.go(e,r={},n)}),a=new R(u.message,{status:500})}return a}async remoteFetch(e,...r){let n=e;e instanceof Request?n=e.url:e instanceof URL&&(n=e.href),g.set(this.network,"remote",n);let o=mt(e,...r);return o.catch(s=>g.set(this.network,"error",s)),o.then(async s=>(g.set(this.network,"remote",null),R.compat(s)))}handleResponse(e,r){if(!r&&r!==0?r=new R(null,{status:404}):r instanceof R||(r=R.compat(r)),g.set(this.network,"requesting",null),g.set(this.network,"redirecting",null),!r.redirected){let n=r.headers.get("Location");if(n){let o=parseInt(r.headers.get("X-Redirect-Code"));g.set(this.network,"redirecting",n),o&&r.status===this._xRedirectCode?(r.attrs.status=o,window.location=n):[302,301].includes(r.status)&&(this.isSpaRoute(n)?this.go(n,{},{srcType:"rdr"}):window.location=n)}}return r}};async function cr(t=null){let e=this||{},r=n=>new fe(n);return new Y(te.create(e),t||r)}self.webqit||(self.webqit={});webqit.Webflo=De;var{start:lr}=webqit.Webflo,pr={},hr={bundle_filename:"bundle.js",public_base_url:"/",spa_routing:!0,webqit_dependencies:"",service_worker_support:!0,worker_scope:"/",worker_filename:"worker.js",routing:{root:"/",subroots:[],targets:1}};webqit.app=await lr.call({layout:pr,params:hr});
