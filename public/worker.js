/** @webqit/webflo */(async () => {
var Dt=Object.defineProperty;var Ut=(t,e)=>()=>(t&&(e=t(t=0)),e);var Fe=(t,e)=>{for(var r in e)Dt(t,r,{get:e[r],enumerable:!0})};var Rt={};Fe(Rt,{URLPattern:()=>Et});function Vt(t,e){return(e?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(t)}function mt(t,e=!1){let r=[],n=0;for(;n<t.length;){let s=t[n],o=function(a){if(!e)throw new TypeError(a);r.push({type:"INVALID_CHAR",index:n,value:t[n++]})};if(s==="*"){r.push({type:"ASTERISK",index:n,value:t[n++]});continue}if(s==="+"||s==="?"){r.push({type:"MODIFIER",index:n,value:t[n++]});continue}if(s==="\\"){r.push({type:"ESCAPED_CHAR",index:n++,value:t[n++]});continue}if(s==="{"){r.push({type:"OPEN",index:n,value:t[n++]});continue}if(s==="}"){r.push({type:"CLOSE",index:n,value:t[n++]});continue}if(s===":"){let a="",u=n+1;for(;u<t.length;){let f=t.substr(u,1);if(u===n+1&&Wt.test(f)||u!==n+1&&Bt.test(f)){a+=t[u++];continue}break}if(!a){o(`Missing parameter name at ${n}`);continue}r.push({type:"NAME",index:n,value:a}),n=u;continue}if(s==="("){let a=1,u="",f=n+1,c=!1;if(t[f]==="?"){o(`Pattern cannot start with "?" at ${f}`);continue}for(;f<t.length;){if(!Vt(t[f],!1)){o(`Invalid character '${t[f]}' at ${f}.`),c=!0;break}if(t[f]==="\\"){u+=t[f++]+t[f++];continue}if(t[f]===")"){if(a--,a===0){f++;break}}else if(t[f]==="("&&(a++,t[f+1]!=="?")){o(`Capturing groups are not allowed at ${f}`),c=!0;break}u+=t[f++]}if(c)continue;if(a){o(`Unbalanced pattern at ${n}`);continue}if(!u){o(`Missing pattern at ${n}`);continue}r.push({type:"PATTERN",index:n,value:u}),n=f;continue}r.push({type:"CHAR",index:n,value:t[n++]})}return r.push({type:"END",index:n,value:""}),r}function dt(t,e={}){let r=mt(t),{prefixes:n="./"}=e,s=`[^${ne(e.delimiter||"/#?")}]+?`,o=[],a=0,u=0,f="",c=new Set,h=p=>{if(u<r.length&&r[u].type===p)return r[u++].value},y=()=>{let p=h("MODIFIER");return p||h("ASTERISK")},g=p=>{let x=h(p);if(x!==void 0)return x;let{type:w,index:P}=r[u];throw new TypeError(`Unexpected ${w} at ${P}, expected ${p}`)},m=()=>{let p="",x;for(;x=h("CHAR")||h("ESCAPED_CHAR");)p+=x;return p},S=p=>p,d=e.encodePart||S;for(;u<r.length;){let p=h("CHAR"),x=h("NAME"),w=h("PATTERN");if(!x&&!w&&h("ASTERISK")&&(w=".*"),x||w){let k=p||"";n.indexOf(k)===-1&&(f+=k,k=""),f&&(o.push(d(f)),f="");let j=x||a++;if(c.has(j))throw new TypeError(`Duplicate name '${j}'.`);c.add(j),o.push({name:j,prefix:d(k),suffix:"",pattern:w||s,modifier:y()||""});continue}let P=p||h("ESCAPED_CHAR");if(P){f+=P;continue}if(h("OPEN")){let k=m(),j=h("NAME")||"",T=h("PATTERN")||"";!j&&!T&&h("ASTERISK")&&(T=".*");let Nt=m();g("CLOSE");let ct=y()||"";if(!j&&!T&&!ct){f+=k;continue}if(!j&&!T&&!k)continue;f&&(o.push(d(f)),f=""),o.push({name:j||(T?a++:""),pattern:j&&!T?s:T,prefix:d(k),suffix:d(Nt),modifier:ct});continue}f&&(o.push(d(f)),f=""),g("END")}return o}function ne(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function gt(t){return t&&t.sensitive?"u":"ui"}function Jt(t,e){if(!e)return t;let r=/\((?:\?<(.*?)>)?(?!\?)/g,n=0,s=r.exec(t.source);for(;s;)e.push({name:s[1]||n++,prefix:"",suffix:"",modifier:"",pattern:""}),s=r.exec(t.source);return t}function Gt(t,e,r){let n=t.map(s=>xt(s,e,r).source);return new RegExp(`(?:${n.join("|")})`,gt(r))}function Kt(t,e,r){return yt(dt(t,r),e,r)}function yt(t,e,r={}){let{strict:n=!1,start:s=!0,end:o=!0,encode:a=h=>h}=r,u=`[${ne(r.endsWith||"")}]|$`,f=`[${ne(r.delimiter||"/#?")}]`,c=s?"^":"";for(let h of t)if(typeof h=="string")c+=ne(a(h));else{let y=ne(a(h.prefix)),g=ne(a(h.suffix));if(h.pattern)if(e&&e.push(h),y||g)if(h.modifier==="+"||h.modifier==="*"){let m=h.modifier==="*"?"?":"";c+=`(?:${y}((?:${h.pattern})(?:${g}${y}(?:${h.pattern}))*)${g})${m}`}else c+=`(?:${y}(${h.pattern})${g})${h.modifier}`;else h.modifier==="+"||h.modifier==="*"?c+=`((?:${h.pattern})${h.modifier})`:c+=`(${h.pattern})${h.modifier}`;else c+=`(?:${y}${g})${h.modifier}`}if(o)n||(c+=`${f}?`),c+=r.endsWith?`(?=${u})`:"$";else{let h=t[t.length-1],y=typeof h=="string"?f.indexOf(h[h.length-1])>-1:h===void 0;n||(c+=`(?:${f}(?=${u}))?`),y||(c+=`(?=${f}|${u})`)}return new RegExp(c,gt(r))}function xt(t,e,r){return t instanceof RegExp?Jt(t,e):Array.isArray(t)?Gt(t,e,r):Kt(t,e,r)}function Xt(t,e){return t.length?t[0]==="/"?!0:!e||t.length<2?!1:(t[0]=="\\"||t[0]=="{")&&t[1]=="/":!1}function _t(t,e){return t.startsWith(e)?t.substring(e.length,t.length):t}function Yt(t,e){return t.endsWith(e)?t.substr(0,t.length-e.length):t}function wt(t){return!t||t.length<2?!1:t[0]==="["||(t[0]==="\\"||t[0]==="{")&&t[1]==="["}function Pt(t){if(!t)return!0;for(let e of bt)if(t.test(e))return!0;return!1}function er(t,e){if(t=_t(t,"#"),e||t==="")return t;let r=new URL("https://example.com");return r.hash=t,r.hash?r.hash.substring(1,r.hash.length):""}function tr(t,e){if(t=_t(t,"?"),e||t==="")return t;let r=new URL("https://example.com");return r.search=t,r.search?r.search.substring(1,r.search.length):""}function rr(t,e){return e||t===""?t:wt(t)?kt(t):St(t)}function nr(t,e){if(e||t==="")return t;let r=new URL("https://example.com");return r.password=t,r.password}function sr(t,e){if(e||t==="")return t;let r=new URL("https://example.com");return r.username=t,r.username}function ir(t,e,r){if(r||t==="")return t;if(e&&!bt.includes(e))return new URL(`${e}:${t}`).pathname;let n=t[0]=="/";return t=new URL(n?t:"/-"+t,"https://example.com").pathname,n||(t=t.substring(2,t.length)),t}function or(t,e,r){return Ot(e)===t&&(t=""),r||t===""?t:Ct(t)}function ar(t,e){return t=Yt(t,":"),e||t===""?t:Me(t)}function Ot(t){switch(t){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function Me(t){if(t==="")return t;if(/^[-+.A-Za-z0-9]*$/.test(t))return t.toLowerCase();throw new TypeError(`Invalid protocol '${t}'.`)}function fr(t){if(t==="")return t;let e=new URL("https://example.com");return e.username=t,e.username}function ur(t){if(t==="")return t;let e=new URL("https://example.com");return e.password=t,e.password}function St(t){if(t==="")return t;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(t))throw new TypeError(`Invalid hostname '${t}'`);let e=new URL("https://example.com");return e.hostname=t,e.hostname}function kt(t){if(t==="")return t;if(/[^0-9a-fA-F[\]:]/g.test(t))throw new TypeError(`Invalid IPv6 hostname '${t}'`);return t.toLowerCase()}function Ct(t){if(t===""||/^[0-9]*$/.test(t)&&parseInt(t)<=65535)return t;throw new TypeError(`Invalid port '${t}'.`)}function cr(t){if(t==="")return t;let e=new URL("https://example.com");return e.pathname=t[0]!=="/"?"/-"+t:t,t[0]!=="/"?e.pathname.substring(2,e.pathname.length):e.pathname}function lr(t){return t===""?t:new URL(`data:${t}`).pathname}function hr(t){if(t==="")return t;let e=new URL("https://example.com");return e.search=t,e.search.substring(1,e.search.length)}function pr(t){if(t==="")return t;let e=new URL("https://example.com");return e.hash=t,e.hash.substring(1,e.hash.length)}function pt(t,e){if(typeof t!="string")throw new TypeError("parameter 1 is not of type 'string'.");let r=new URL(t,e);return{protocol:r.protocol.substring(0,r.protocol.length-1),username:r.username,password:r.password,hostname:r.hostname,port:r.port,pathname:r.pathname,search:r.search!=""?r.search.substring(1,r.search.length):void 0,hash:r.hash!=""?r.hash.substring(1,r.hash.length):void 0}}function le(t,e,r){let n;if(typeof e.baseURL=="string")try{n=new URL(e.baseURL),t.protocol=n.protocol?n.protocol.substring(0,n.protocol.length-1):"",t.username=n.username,t.password=n.password,t.hostname=n.hostname,t.port=n.port,t.pathname=n.pathname,t.search=n.search?n.search.substring(1,n.search.length):"",t.hash=n.hash?n.hash.substring(1,n.hash.length):""}catch{throw new TypeError(`invalid baseURL '${e.baseURL}'.`)}if(typeof e.protocol=="string"&&(t.protocol=ar(e.protocol,r)),typeof e.username=="string"&&(t.username=sr(e.username,r)),typeof e.password=="string"&&(t.password=nr(e.password,r)),typeof e.hostname=="string"&&(t.hostname=rr(e.hostname,r)),typeof e.port=="string"&&(t.port=or(e.port,t.protocol,r)),typeof e.pathname=="string"){if(t.pathname=e.pathname,n&&!Xt(t.pathname,r)){let s=n.pathname.lastIndexOf("/");s>=0&&(t.pathname=n.pathname.substring(0,s+1)+t.pathname)}t.pathname=ir(t.pathname,t.protocol,r)}return typeof e.search=="string"&&(t.search=tr(e.search,r)),typeof e.hash=="string"&&(t.hash=er(e.hash,r)),t}function he(t){return t.replace(/([+*?:{}()\\])/g,"\\$1")}function gr(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function yr(t,e){let r=".*",n=`[^${gr(e.delimiter||"/#?")}]+?`,s=/[$_\u200C\u200D\p{ID_Continue}]/u,o="";for(let a=0;a<t.length;++a){let u=t[a],f=a>0?t[a-1]:null,c=a<t.length-1?t[a+1]:null;if(typeof u=="string"){o+=he(u);continue}if(u.pattern===""){if(u.modifier===""){o+=he(u.prefix);continue}o+=`{${he(u.prefix)}}${u.modifier}`;continue}let h=typeof u.name!="number",y=e.prefixes!==void 0?e.prefixes:"./",g=u.suffix!==""||u.prefix!==""&&(u.prefix.length!==1||!y.includes(u.prefix));if(!g&&h&&u.pattern===n&&u.modifier===""&&c&&!c.prefix&&!c.suffix)if(typeof c=="string"){let m=c.length>0?c[0]:"";g=s.test(m)}else g=typeof c.name=="number";if(!g&&u.prefix===""&&f&&typeof f=="string"&&f.length>0){let m=f[f.length-1];g=y.includes(m)}g&&(o+="{"),o+=he(u.prefix),h&&(o+=`:${u.name}`),u.pattern===r?!h&&(!f||typeof f=="string"||f.modifier||g||u.prefix!=="")?o+="*":o+=`(${r})`:u.pattern===n?h||(o+=`(${n})`):o+=`(${u.pattern})`,u.pattern===n&&h&&u.suffix!==""&&s.test(u.suffix[0])&&(o+="\\"),o+=he(u.suffix),g&&(o+="}"),o+=u.modifier}return o}var Wt,Bt,z,Zt,Qt,bt,mr,dr,M,Et,vt=Ut(()=>{Wt=/[$_\p{ID_Start}]/u,Bt=/[$_\u200C\u200D\p{ID_Continue}]/u;z={delimiter:"",prefixes:"",sensitive:!0,strict:!0},Zt={delimiter:".",prefixes:"",sensitive:!0,strict:!0},Qt={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};bt=["ftp","file","http","https","ws","wss"];mr=class{constructor(t){this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=0,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=t}get result(){return this.internalResult}parse(){for(this.tokenList=mt(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===0){this.rewind(),this.isHashPrefix()?this.changeState(9,1):this.isSearchPrefix()?(this.changeState(8,1),this.internalResult.hash=""):(this.changeState(7,0),this.internalResult.search="",this.internalResult.hash="");continue}else if(this.state===2){this.rewindAndSetState(5);continue}this.changeState(10,0);break}if(this.groupDepth>0)if(this.isGroupClose())this.groupDepth-=1;else continue;if(this.isGroupOpen()){this.groupDepth+=1;continue}switch(this.state){case 0:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(1));break;case 1:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();let t=7,e=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(t=2,e=3):this.shouldTreatAsStandardURL&&(t=2),this.changeState(t,e)}break;case 2:this.isIdentityTerminator()?this.rewindAndSetState(3):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(5);break;case 3:this.isPasswordPrefix()?this.changeState(4,1):this.isIdentityTerminator()&&this.changeState(5,1);break;case 4:this.isIdentityTerminator()&&this.changeState(5,1);break;case 5:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(6,1):this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 6:this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 7:this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 8:this.isHashPrefix()&&this.changeState(9,1);break;case 9:break;case 10:break}}}changeState(t,e){switch(this.state){case 0:break;case 1:this.internalResult.protocol=this.makeComponentString();break;case 2:break;case 3:this.internalResult.username=this.makeComponentString();break;case 4:this.internalResult.password=this.makeComponentString();break;case 5:this.internalResult.hostname=this.makeComponentString();break;case 6:this.internalResult.port=this.makeComponentString();break;case 7:this.internalResult.pathname=this.makeComponentString();break;case 8:this.internalResult.search=this.makeComponentString();break;case 9:this.internalResult.hash=this.makeComponentString();break;case 10:break}this.changeStateWithoutSettingComponent(t,e)}changeStateWithoutSettingComponent(t,e){this.state=t,this.componentStart=this.tokenIndex+e,this.tokenIndex+=e,this.tokenIncrement=0}rewind(){this.tokenIndex=this.componentStart,this.tokenIncrement=0}rewindAndSetState(t){this.rewind(),this.state=t}safeToken(t){return t<0&&(t=this.tokenList.length-t),t<this.tokenList.length?this.tokenList[t]:this.tokenList[this.tokenList.length-1]}isNonSpecialPatternChar(t,e){let r=this.safeToken(t);return r.value===e&&(r.type==="CHAR"||r.type==="ESCAPED_CHAR"||r.type==="INVALID_CHAR")}isProtocolSuffix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}nextIsAuthoritySlashes(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")}isIdentityTerminator(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")}isPasswordPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPortPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPathnameStart(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")}isSearchPrefix(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;let t=this.safeToken(this.tokenIndex-1);return t.type!=="NAME"&&t.type!=="PATTERN"&&t.type!=="CLOSE"&&t.type!=="ASTERISK"}isHashPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")}isGroupOpen(){return this.tokenList[this.tokenIndex].type=="OPEN"}isGroupClose(){return this.tokenList[this.tokenIndex].type=="CLOSE"}isIPv6Open(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")}isIPv6Close(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")}makeComponentString(){let t=this.tokenList[this.tokenIndex],e=this.safeToken(this.componentStart).index;return this.input.substring(e,t.index)}computeShouldTreatAsStandardURL(){let t={};Object.assign(t,z),t.encodePart=Me;let e=xt(this.makeComponentString(),void 0,t);this.shouldTreatAsStandardURL=Pt(e)}},dr=["protocol","username","password","hostname","port","pathname","search","hash"],M="*";Et=class{constructor(t={},e){this.regexp={},this.keys={},this.component_pattern={};try{if(typeof t=="string"){let s=new mr(t);if(s.parse(),t=s.result,e)if(typeof e=="string")t.baseURL=e;else throw new TypeError("'baseURL' parameter is not of type 'string'.");else if(typeof t.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.")}else if(e)throw new TypeError("parameter 1 is not of type 'string'.");if(!t||typeof t!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");let r={pathname:M,protocol:M,username:M,password:M,hostname:M,port:M,search:M,hash:M};this.pattern=le(r,t,!0),Ot(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");let n;for(n of dr){if(!(n in this.pattern))continue;let s={},o=this.pattern[n];switch(this.keys[n]=[],n){case"protocol":Object.assign(s,z),s.encodePart=Me;break;case"username":Object.assign(s,z),s.encodePart=fr;break;case"password":Object.assign(s,z),s.encodePart=ur;break;case"hostname":Object.assign(s,Zt),wt(o)?s.encodePart=kt:s.encodePart=St;break;case"port":Object.assign(s,z),s.encodePart=Ct;break;case"pathname":Pt(this.regexp.protocol)?(Object.assign(s,Qt),s.encodePart=cr):(Object.assign(s,z),s.encodePart=lr);break;case"search":Object.assign(s,z),s.encodePart=hr;break;case"hash":Object.assign(s,z),s.encodePart=pr;break}try{let a=dt(o,s);this.regexp[n]=yt(a,this.keys[n],s),this.component_pattern[n]=yr(a,s)}catch{throw new TypeError(`invalid ${n} pattern '${this.pattern[n]}'.`)}}}catch(r){throw new TypeError(`Failed to construct 'URLPattern': ${r.message}`)}}test(t={},e){let r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof t>"u")return!1;try{typeof t=="object"?r=le(r,t,!1):r=le(r,pt(t,e),!1)}catch{return!1}let n;for(n in this.pattern)if(!this.regexp[n].exec(r[n]))return!1;return!0}exec(t={},e){let r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof t>"u")return;try{typeof t=="object"?r=le(r,t,!1):r=le(r,pt(t,e),!1)}catch{return null}let n={};e?n.inputs=[t,e]:n.inputs=[t];let s;for(s in this.pattern){let o=this.regexp[s].exec(r[s]);if(!o)return null;let a={};for(let[u,f]of this.keys[s].entries())if(typeof f.name=="string"||typeof f.name=="number"){let c=o[u+1];a[f.name]=c}n[s]={input:r[s]||"",groups:a}}return n}get protocol(){return this.component_pattern.protocol}get username(){return this.component_pattern.username}get password(){return this.component_pattern.password}get hostname(){return this.component_pattern.hostname}get port(){return this.component_pattern.port}get pathname(){return this.component_pattern.pathname}get search(){return this.component_pattern.search}get hash(){return this.component_pattern.hash}};globalThis.URLPattern||(globalThis.URLPattern=Et)});var oe=class{constructor(e,r=null){Object.defineProperty(this,"dict",{value:Object.create(e)});for(let n in this.dict)n in this||(this[n]=this.dict[n]);arguments.length>1&&Object.defineProperty(this.dict,"CWD",{get:()=>r})}get name(){return"webflo"}static create(...e){return new this(...e)}get CWD(){return this.dict.CWD||""}get meta(){return this.dict.meta||{}}get app(){return this.dict.app||{}}get config(){return this.dict.config||{}}get flags(){return this.dict.flags||{}}set flags(e){Object.defineProperty(this.dict,"flags",{value:e})}get layout(){return this.dict.layout||{}}set layout(e){Object.defineProperty(this.dict,"layout",{value:e})}get logger(){return this.dict.logger}set logger(e){Object.defineProperty(this.dict,"logger",{value:e})}};var ae=class extends oe{};var fe=class extends ae{};function _(t){return!Array.isArray(t)&&typeof t=="object"&&t}function H(t){return typeof t}function b(t){return Array.isArray(t)}function Te(t,e,r=null){return b(e)?t.filter(n=>r?e.filter(s=>r(n,s)).length:e.indexOf(n)!==-1):[]}function Ee(t,...e){if(globalThis.webqit||(globalThis.webqit={}),globalThis.webqit.refs||Object.defineProperty(globalThis.webqit,"refs",{value:new ue}),!arguments.length)return globalThis.webqit.refs;let r=globalThis.webqit.refs.get(t);r||(r=new ue,globalThis.webqit.refs.set(t,r));let n,s;for(;n=e.shift();)(s=r)&&!(r=r.get(n))&&(r=new ue,s.set(n,r));return r}var ue=class extends Map{constructor(...e){super(...e),this.observers=new Set}set(e,r){let n=super.set(e,r);return this.fire("set",e,r,e),n}delete(e){let r=super.delete(e);return this.fire("delete",e),r}has(e){return this.fire("has",e),super.has(e)}get(e){return this.fire("get",e),super.get(e)}keyNames(){return Array.from(super.keys())}observe(e,r,n){let s={type:e,key:r,callback:n};return this.observers.add(s),()=>this.observers.delete(s)}unobserve(e,r,n){if(Array.isArray(e)||Array.isArray(r))throw new Error('The "type" and "key" arguments can only be strings.');for(let s of this.observers)!(Ce([e,"*"],s.type)&&Ce([r,"*"],s.key)&&s.callback===n)||this.observers.delete(s)}fire(e,r,...n){for(let s of this.observers)!(Ce([e,"*"],s.type)&&Ce([r,"*"],s.key))||s.callback(...n)}},Ce=(t,e)=>Array.isArray(e)?Te(t,e).length:t.includes(e);function Re(t){return t===!0||t===!1}function J(t){return typeof t=="function"}function Ne(t){return J(t)&&/^class\s?/.test(Function.prototype.toString.call(t))}function De(t){return t===null||t===""}function G(t){return arguments.length&&(t===void 0||typeof t>"u")}function O(t){return Array.isArray(t)||typeof t=="object"&&t||J(t)}function ce(t){return De(t)||G(t)||t===!1||t===0||O(t)&&!Object.keys(t).length}function R(t){return J(t)||t&&{}.toString.call(t)==="[object function]"}function re(t){return t instanceof Number||typeof t=="number"}function $(t){return re(t)||t!==!0&&t!==!1&&t!==null&&t!==""&&!isNaN(t*1)}function Ue(t){return b(t)&&Object.getPrototypeOf(t)===Array.prototype}function qe(t){return _(t)&&Object.getPrototypeOf(t)===Object.prototype}function A(t){return t instanceof String||typeof t=="string"&&t!==null}function He(t){return!A(t)&&!G(t.length)}typeof URLPattern>"u"&&await Promise.resolve().then(()=>(vt(),Rt));var U={parse(t,e="&"){t=t||"";let r={};return(t.startsWith("?")?t.substr(1):t).split(e).filter(n=>n).map(n=>n.split("=").map(s=>s.trim())).forEach(n=>this.set(r,n[0],decodeURIComponent(n[1]))),r},stringify(t,e="&"){let r=[];return Object.keys(t).forEach(n=>{this.reduceValue(t[n],n,(s,o,a=void 0)=>{if(a)return a;r.push(`${o}=${encodeURIComponent(s)}`)})}),r.join(e)},get(t,e){return this.reducePath(e,t,(r,n)=>{if(!(!n&&n!==0))return n[r]})},set(t,e,r){this.reducePath(e,t,function(n,s,o=void 0){let a=r;return o&&(a=o),n===""&&b(s)?s.push(a):s[n]=a,a})},reduceValue(t,e,r){if(O(t)){let n=Object.keys(t),s=r(t,e,n);if(b(s))return s.forEach(o=>{this.reduceValue(t[o],e?`${e}[${o}]`:o,r)})}r(t,e)},reducePath(t,e,r){if(A(t)&&t.endsWith("]")&&O(e)){let[n,...s]=t.split("[");$(n)&&(n=parseInt(n)),s=s.join("[").replace("]","");let o;if(n in e)o=e[n];else{let a=s===""||$(s.split("[")[0])?[]:{};o=r(n,e,a)}return this.reducePath(s,o,r)}return $(t)&&(t=parseInt(t)),r(t,e)}},At={join(){let t=[],e=0;for(let n=0,s=arguments.length;n<s;n++)t=t.concat(arguments[n].split("/"));let r=[];for(i=0,l=t.length;i<l;i++){let n=t[i];!n||n==="."||(n===".."?r.length?r.pop():e++:r.push(n))}return t[0]===""&&r.unshift(""),"../".repeat(e)+r.join("/")||(r.length?"/":".")},dirname(t){return this.join(t,"..")}},ze=(t,e=null)=>({pattern:new URLPattern(t,e),isPattern(){return Object.keys(this.pattern.keys||{}).some(r=>this.pattern.keys[r].length)},test(...r){return this.pattern.test(...r)},exec(...r){let n=this.pattern.exec(...r);if(!!n)return n.vars=Object.keys(this.pattern.keys).reduce(({named:s,unnamed:o},a)=>(this.pattern.keys[a].forEach(u=>{let f=n[a].groups[u.name];typeof u.name=="number"?o.push(f):s[u.name]=f}),{named:s,unnamed:o}),{named:{},unnamed:[]}),n.render=s=>s.replace(/\$(\$|[0-9A-Z]+)/gi,(o,a)=>a==="$"?"$":($(a)?n.vars.unnamed[a-1]:n.vars.named[a])||""),n}});function W(t,e,r=!1){if(e=="")return t;var n=r?t.lastIndexOf(e):t.indexOf(e);return n===-1?"":t.substr(n+e.length)}function Be(t,e){return t.reduce((r,n,s)=>r||e(n,s),!1)}function pe(t,e,r=!1){if(e=="")return t;var n=r?t.lastIndexOf(e):t.indexOf(e);return n===-1?t:t.substr(0,n)}function I(t,e=!0){return b(t)?t:!e&&_(t)?[t]:t!==!1&&t!==0&&ce(t)?[]:He(t)?Array.prototype.slice.call(t):_(t)?Object.values(t):[t]}var me=class{constructor(e,r=[]){this.cx=e,this.path=b(r)?r:(r+"").split("/").filter(n=>n)}async route(e,r,n,s,o=null){let a=this,u=this.cx.runtime,f=async function(c){let h={runtime:u};if(!c.trail||c.trail.length<c.destination.length){if(c=await a.readTick(c),h.pathname=`/${c.trail.join("/")}`,h.stepname=c.trail[c.trail.length-1],a.finalizeHandlerContext(h,c),c.exports){c.exports.hints&&await r.port.post({...c.exports.hints,$type:"handler:hints"});let y=I(c.method).map(m=>m==="default"?m:m.toUpperCase()),g=R(c.exports)&&y.includes("default")?c.exports:y.reduce((m,S)=>m||c.exports[S],null);if(g){let m=async(...d)=>{let p={...c,arg:d[0]};if(d.length>1){let x=d[1],w,P={...d[2]||{}};if(d[1]instanceof p.event.Request)w=d[1],x=w.url;else if(!A(x))throw new Error("Router redirect url must be a string!");let E=x.startsWith("/")?x:a.pathJoin(`/${c.trail.join("/")}`,x);if(E.startsWith("../"))throw new Error("Router redirect cannot traverse beyond the routing directory! ("+x+" >> "+E+")");P.method&&(p.method=P.method,b(P.method)&&(P.method=P.method[0])),w?p.event=await c.event.with(E,w,P):p.event=await c.event.with(E,P),p.source=c.destination.join("/"),p.destination=E.split("?").shift().split("/").map(k=>k.trim()).filter(k=>k),p.trail=d[1].startsWith("/")?[]:c.trail.reduce((k,j,T)=>k.length===T&&j===p.destination[T]?k.concat(j):k,[]),p.trailOnFile=c.trailOnFile.slice(0,p.trail.length)}return f(p)},S=c.destination.slice(c.trail.length);return m.pathname=S.join("/"),m.stepname=S[0],await g.call(h,c.event,c.arg,m,o)}return f(c)}else if((c.currentSegmentOnFile||{}).dirExists)return f(c)}if(s)return await s.call(h,c.event,c.arg,o)};return f({destination:this.path,event:r,method:e,arg:n})}};var de=class extends me{async readTick(e){e={...e};var r=this.cx.layout,n=Object.keys(this.cx.layout);return e.trail?(e.currentSegment=e.destination[e.trail.length],e.currentSegmentOnFile=[e.currentSegment,"-"].reduce((s,o)=>{if(s.index)return s;var a=`/${e.trailOnFile.concat(o).join("/")}`;return r[a]?{seg:o,index:a}:n.filter(u=>u.startsWith(`${a}/`)).length?{seg:o,dirExists:!0}:s},{seg:null}),e.trail=e.trail.concat(e.currentSegment),e.trailOnFile=e.trailOnFile.concat(e.currentSegmentOnFile.seg),e.exports=r[e.currentSegmentOnFile.index]):(e.trail=[],e.trailOnFile=[],e.currentSegmentOnFile={index:"/"},e.exports=r["/"]),e}finalizeHandlerContext(e,r){return e.dirname=r.currentSegmentOnFile.index}pathJoin(...e){return At.join(...e)}};var ge=class{constructor(e){this.cx=e}async init(e,r){return new this.Router(this.cx,"/").route(["init"],e,{},async s=>{},r)}};var ye=class extends ge{get Router(){return de}async handle(e,r){let n=new this.Router(this.cx,e.url.pathname);return(async()=>n.route([e.request.method,"default"],e,{},async o=>(o!==e&&(o.request.headers.has("Accept")||o.request.headers.set("Accept","application/json")),r(o.request)),r))()}};var nt={};Fe(nt,{apply:()=>et,batch:()=>$r,construct:()=>Ye,deep:()=>Ar,defineProperties:()=>Fr,defineProperty:()=>Qe,deleteProperty:()=>Xe,get:()=>Q,getOwnPropertyDescriptor:()=>Ge,getOwnPropertyDescriptors:()=>Lr,getPrototypeOf:()=>Ke,has:()=>je,intercept:()=>Ir,isExtensible:()=>Ze,observe:()=>jr,ownKeys:()=>Ae,preventExtensions:()=>rt,set:()=>se,setPrototypeOf:()=>tt});var K=class{constructor(e,r){this.registry=e,Object.assign(this,{...r,target:e.target}),this.params.signal&&this.params.signal.addEventListener("abort",()=>this.remove())}remove(){return this.removed=!0,this.registry.removeRegistration(this)}};var xe=class extends K{constructor(){super(...arguments),Object.defineProperty(this,"abortController",{value:new AbortController}),Object.defineProperty(this,"signal",{value:this.abortController.signal})}remove(){this.abortController.abort(),super.remove()}fire(e){let r=e,n=this.filter;if(n!==1/0&&(n=I(n))&&(r=e.filter(s=>n.includes(s.key))),this.params.diff&&(r=r.filter(s=>s.type!=="set"||s.value!==s.oldValue)),r.length)return this.filter===1/0||Array.isArray(this.filter)?this.handler(r,this):this.handler(r[0],this)}};var C=(...t)=>Ee("observer-api",...t);var Z=class{constructor(e){this.target=e,this.entries=[]}addRegistration(e){return this.entries.push(e),e}removeRegistration(e){this.entries=this.entries.filter(r=>r!==e)}static _getInstance(e,r,n=!0,s=this.__namespace){if(!O(r))throw new Error(`Subject must be of type object; "${H(r)}" given!`);let o=this;return s&&C("namespaces").has(e+"-"+s)&&(o=C("namespaces").get(e+"-"+s),e+="-"+s),!C(r,"registry").has(e)&&n&&C(r,"registry").set(e,new o(r)),C(r,"registry").get(e)}static _namespace(e,r,n=null){if(e+="-"+r,arguments.length===2)return C("namespaces").get(e);if(!(n.prototype instanceof this))throw new Error(`The implementation of the namespace ${this.name}.${r} must be a subclass of ${this.name}.`);C("namespaces").set(e,n),n.__namespace=r}};var B=class extends Z{static getInstance(e,r=!0,n=null){return super._getInstance("listeners",...arguments)}static namespace(e,r=null){return super._namespace("listeners",...arguments)}constructor(e){super(e),this.batches=[]}addRegistration(e,r,n){return super.addRegistration(new xe(this,{filter:e,handler:r,params:n}))}emit(e){if(this.batches.length){this.batches[0].events.push(...e);return}this.entries.forEach(r=>r.fire(e))}batch(e){this.batches.unshift({entries:[...this.entries],events:[]});let r=e(),n=this.batches.shift();return n.events.length&&n.entries.forEach(s=>s.fire(n.events)),r}};var _e=class extends K{exec(e,r,n){return this.running||!this.traps[e.type]?r(...Array.prototype.slice.call(arguments,2)):(this.running=!0,this.traps[e.type](e,n,(...s)=>(this.running=!1,r(...s))))}};var q=class extends Z{static getInstance(e,r=!0,n=null){return super._getInstance("traps",...arguments)}static namespace(e,r=null){return super._namespace("traps",...arguments)}addRegistration(e){return super.addRegistration(new _e(this,e))}emit(e,r=null){let n=this;return function s(o,...a){let u=n.entries[o];return u?u.exec(e,(...f)=>s(o+1,...f),...a):r?r(e,...a):a[0]}(0)}};var F=class{constructor(e,r){if(this.target=e,!r.type)throw new Error("Descriptor type must be given in definition!");Object.assign(this,r)}};var Je={};Fe(Je,{accessorize:()=>Er,proxy:()=>vr,unaccessorize:()=>Rr,unproxy:()=>ve});function Er(t,e,r={}){t=Ve(t);let n=C(t,"accessorizedProps");function s(f){let c,h=t;for(;!c&&(h=Object.getPrototypeOf(h));)c=Object.getOwnPropertyDescriptor(h,f);return c?{proto:h,descriptor:c}:{descriptor:{value:void 0}}}function o(f){if(n.has(f))return!0;let c=s(f);c.getValue=function(){return"get"in this.descriptor?this.descriptor.get():this.descriptor.value},c.setValue=function(m){return"set"in this.descriptor?this.descriptor.set(m):this.descriptor.value=m},c.intact=function(){let m=Object.getOwnPropertyDescriptor(t,f);return m.get===g.get&&m.set===g.set&&n.get(f)===this},c.restore=function(){return this.intact()?(this.proto!==t?delete t[f]:Object.defineProperty(t,f,this.descriptor),n.delete(f),!0):!1},n.set(f,c);let{enumerable:h=!0,configurable:y=!0}=c.descriptor,g={enumerable:h,configurable:y};["value","set"].some(m=>m in c.descriptor)&&(g.set=function(m){return se(this,f,m,r)}),["value","get"].some(m=>m in c.descriptor)&&(g.get=function(){return Q(this,f,r)});try{return Object.defineProperty(t,f,g),!0}catch{return n.delete(f),!1}}let u=(Array.isArray(e)?e:e===void 0?Object.keys(t):[e]).map(o);return e===void 0||Array.isArray(e)?u:u[0]}function Rr(t,e,r={}){t=Ve(t);let n=C(t,"accessorizedProps");function s(u){return n.has(u)?n.get(u).restore():!0}let a=(Array.isArray(e)?e:e===void 0?Object.keys(t):[e]).map(s);return e===void 0||Array.isArray(e)?a:a[0]}function vr(t,e={}){t=Ve(t);let r=new Proxy(t,{apply:(n,s,o)=>et(n,s,o,e),construct:(n,s,o=null)=>Ye(n,s,o,e),defineProperty:(n,s,o)=>Qe(n,s,o,e),deleteProperty:(n,s)=>Xe(n,s,e),get:(n,s,o=null)=>{let a=Q(n,s,{...e,receiver:o});return e.proxyAutoBinding!==!1&&R(a)&&!Ne(a)?a.bind(r):a},getOwnPropertyDescriptor:(n,s)=>Ge(n,s,e),getPrototypeOf:n=>Ke(n,e),has:(n,s)=>je(n,s,e),isExtensible:n=>Ze(n,e),ownKeys:n=>Ae(n,e),preventExtensions:n=>rt(n,e),set:(n,s,o,a=null)=>se(n,s,o,{...e,receiver:a}),setPrototypeOf:(n,s)=>tt(n,s,e)});return C(r).set(r,t),r}function ve(t){return C(t).get(t)||t}function Ve(t){if(!t||!O(t))throw new Error("Target must be of type object!");return ve(t)}function Ar(t,e,r,n=o=>o,s={}){return function o(a,u,f){let c=u[f.level];return f.level<u.length-1?f={...f,preflight:!0}:f={...f,preflight:s.preflight},r(a,c,(h,...y)=>{let g=(d={})=>({...f,...d,level:f.level+1}),m=d=>{d instanceof F&&(d.path=[d.key],a instanceof F&&(d.path=a.path.concat(d.key),d.context=a))};if(Ie(c)&&Array.isArray(h))return h.forEach(m),f.level===u.length-1||!h.length&&f.midwayResults?n(h,...y):h.map(d=>o(d,u,g(...y)));m(h);let S=O(X(h,!1));return f.level===u.length-1||!S&&f.midwayResults?n(h,...y):S&&o(h,u,g(...y))},f)}(t,e.slice(0),{...s,level:0})}function jr(t,e,r,n={}){if(t=X(t),R(arguments[1])&&([,r,n={}]=arguments,e=1/0),!R(r))throw new Error(`Handler must be a function; "${H(r)}" given!`);let s=Lt(t,e,r,n);return n.preflight?(n={...n,descripted:!0},delete n.live,Q(t,e,s,n)):s()}function Ir(t,e,r={}){return t=X(t),_(e)||([,,,r={}]=arguments,e={[arguments[1]]:arguments[2]}),q.getInstance(t,!0,r.namespace).addRegistration({traps:e,params:r})}function Ge(t,e,r=s=>s,n={}){return N(t,"getOwnPropertyDescriptor",{key:e},r,n)}function Lr(t,e,r=s=>s,n={}){return N(t,"getOwnPropertyDescriptors",{key:e},r,n)}function Ke(t,e=n=>n,r={}){return N(t,"getPrototypeOf",{},e,r)}function Ze(t,e=n=>n,r={}){return N(t,"isExtensible",{},e,r)}function Ae(t,e=n=>n,r={}){return N(t,"ownKeys",{},e,r)}function je(t,e,r=s=>s,n={}){return N(t,"has",{key:e},r,n)}function Q(t,e,r=s=>s,n={}){let s;return t=X(t),_(r)?[n,r]=[r,o=>o]:n.live&&(s=!0),Tr(t,e,o=>{let a=[...o];return function u(f,c,h){if(!c.length)return h(f);let y=c.shift();function g(d,p=void 0){let x=E=>(d.value=E,u(f.concat(n.live||n.descripted?d:E),c,h));if(arguments.length>1)return x(p);let w=C(t,"accessorizedProps",!1),P=w&&w.get(d.key);return P&&P.intact()?x(P.getValue()):x(Reflect.get(t,d.key,...n.receiver?[n.receiver]:[]))}let m=new F(t,{type:"get",key:y,value:void 0,related:a}),S=q.getInstance(t,!1,n.namespace);return S?S.emit(m,g):g(m)}([],o.slice(0),u=>{let f=Ie(e)?u:u[0];return s?Lt(t,e,r,n)(f):r(f)})})}function $r(t,e,r={}){return B.getInstance(t,!0,r.namespace).batch(e)}function se(t,e,r,n=a=>a,s={},o=!1){t=X(t);let a=[[e,r]];_(e)&&([,,n=f=>f,s={},o=!1]=arguments,a=Object.entries(e)),_(n)&&([o,s,n]=[typeof s=="boolean"?s:!1,n,f=>f]);let u=a.map(([f])=>f);return function f(c,h,y){if(!h.length)return y(c);let[g,m]=h.shift();function S(p,x=void 0){let w=k=>(p.status=k,f(c.concat(p),h,y));if(arguments.length>1)return w(p,x);let P=C(t,"accessorizedProps",!1),E=P&&P.get(p.key);return p.type==="defineProperty"?(E&&!E.restore()&&w(!1),Object.defineProperty(t,p.key,p.value),w(!0)):E&&E.intact()?w(E.setValue(p.value)):w(Reflect.set(t,p.key,p.value))}function d(p,x){if(s.diff&&m===x)return f(c,h,y);let w=new F(t,{type:o?"defineProperty":"set",key:g,value:m,isUpdate:p,oldValue:x,related:[...u],detail:s.detail}),P=q.getInstance(t,!1,s.namespace);return P?P.emit(w,S):S(w)}return je(t,g,p=>p?Q(t,g,x=>d(p,x),s):d(p),s)}([],a.slice(0),f=>{let c=B.getInstance(t,!1,s.namespace);return c&&c.emit(f),n(Ie(e)?f.map(h=>h.status):f[0]?.status)})}function Qe(t,e,r,n=o=>o,s={}){return se(t,e,r,n,s,!0)}function Fr(t,e,r=s=>s,n={}){return se(t,e,r,n,!0)}function Xe(t,e,r=s=>s,n={}){t=X(t),_(r)&&([n,r]=[r,a=>a]);let s=I(e),o=[...s];return function a(u,f,c){if(!f.length)return c(u);let h=f.shift();function y(m,S=void 0){let d=w=>(m.status=w,a(u.concat(m),f,c));if(arguments.length>1)return d(m,S);let p=C(t,"accessorizedProps",!1),x=p&&p.get(m.key);return x&&!x.restore()&&d(!1),d(Reflect.deleteProperty(t,m.key))}function g(m){let S=new F(t,{type:"deleteProperty",key:h,oldValue:m,related:[...o],detail:n.detail}),d=q.getInstance(t,!1,n.namespace);return d?d.emit(S,y):y(S)}return Q(t,h,g,n)}([],s.slice(0),a=>{let u=B.getInstance(t,!1,n.namespace);return u&&u.emit(a),r(Ie(e)?a.map(f=>f.status):a[0].status)})}function Ye(t,e,r=null,n=o=>o,s={}){return N(t,"construct",arguments.length>2?{argumentsList:e,newTarget:r}:{argumentsList:e},n,s)}function et(t,e,r,n=o=>o,s={}){return N(t,"apply",{thisArgument:e,argumentsList:r},n,s)}function tt(t,e,r=s=>s,n={}){return N(t,"setPrototypeOf",{proto:e},r,n)}function rt(t,e=n=>n,r={}){return N(t,"preventExtensions",{},e,r)}function Lt(t,e,r,n={}){let s;n.signal||(s=new AbortController,n={...n,signal:s.signal});let o=B.getInstance(t,!0,n.namespace);return function a(u,f=null){f?.remove();let h={signal:o.addRegistration(e,a,n).signal};return arguments.length&&r(u,h),s}}function N(t,e,r={},n=o=>o,s={}){t=X(t),_(n)&&([s,n]=[n,f=>f]);function o(f,c){return arguments.length>1?n(c):n(Reflect[e](t,...Object.values(r)))}let a=new F(t,{type:e,...r}),u=q.getInstance(t,!1,s.namespace);return u?u.emit(a,o):o(a)}function Ie(t){return t===1/0||Array.isArray(t)}function X(t,e=!0){if((!t||!O(t))&&e)throw new Error(`Object must be of type object or array! "${H(t)}" given.`);return t instanceof F&&(t=t.value),t&&ve(t)}function Tr(t,e,r){return e===1/0?Ae(t,r):r(I(e))}var Nr={...nt,...Je},v=Nr;var we=class{constructor(){this.messaging={post:(e,r=this.client)=>{if(!r)throw new Error("No client for this operation.");return r.postMessage(e),this.post},listen:(e,r=this.client)=>((r||self).addEventListener("message",n=>{this.client=n.source;let s=e(n),o=n.ports[0];o&&(s instanceof Promise?s.then(a=>{o.postMessage(a)}):o.postMessage(s))}),this.post),request:(e,r=this.client)=>{if(!r)throw new Error("No client for this operation.");return new Promise(n=>{let s=new MessageChannel;r.postMessage(e,[s.port2]),s.port1.onmessage=o=>n(o.data)})},channel(e){this.channels.has(e)||this.channels.set(e,new BroadcastChannel(r));let r=this.channels.get(e);return{broadcast:n=>r.postMessage(n),listen:n=>r.addEventListener("message",n)}},channels:new Map},this.notifications={fire:(e,r={})=>new Promise((n,s)=>{if(!(self.Notification&&self.Notification.permission==="granted"))return s(self.Notification&&self.Notification.permission);o.addEventListener("error",s);let o=new self.Notification(e,r);o.addEventListener("click",n),o.addEventListener("close",n)}),handle:e=>(self.addEventListener("notificationclick",e),this.notifications)},this.push={listen:e=>(self.addEventListener("push",e),this.post)}}setCurrentClient(e){this.client=e}};var be=class{constructor(e,r){if(this.cx=e,this.cx.runtime=this,this.app=R(r)?r(this.cx):r,!this.app||!this.app.handle)throw new Error('Application instance must define a ".handle()" method.')}};function Le(t,e){return pe(t,e,!0)}function ie(t){let e=t.headers instanceof Headers?[...t.headers.keys()].reduce((s,o)=>({...s,[o]:t.headers.get(o)}),{}):Object.keys(t.headers||{}).reduce((s,o)=>({...s,[o.toLowerCase()]:t.headers[o]}),{}),r=t.body,n=st(t.body);if(["Blob","File"].includes(n))!e["content-type"]&&(e["content-type"]=r.type),!e["content-length"]&&(e["content-length"]=r.size);else if(["Uint8Array","Uint16Array","Uint32Array","ArrayBuffer"].includes(n))!e["content-length"]&&(e["content-length"]=r.byteLength);else if(n==="json"&&O(r)){if(!e["content-type"]){let[s,o]=Ur(r);o?(r=JSON.stringify(r,(a,u)=>u instanceof Error?{...u,message:u.message}:u),e["content-type"]="application/json",e["content-length"]=new Blob([r]).size):(r=s,n="FormData")}}else n==="json"&&!e["content-length"]&&(e["content-length"]=(r+"").length);return[r,e,n]}function Ur(t={},e=!0){let r=new FormData,n=!0;return U.reduceValue(t,"",(s,o,a=void 0)=>{if(a){let u=st(s)==="json";return n=n&&u,u&&a}e&&[!0,!1,null].includes(s)&&(s=new Blob([s],{type:"application/json"})),r.append(o,s)}),[r,n]}async function $t(t,e=!0){let r=!0,n;for(let[s,o]of t.entries()){n||(n=$(pe(s,"["))?[]:{});let a=st(o);if(e&&["Blob","File"].includes(a)&&o.type==="application/json"&&[4,5].includes(o.size)){let u=await o.text();["true","false","null"].includes(u)&&(a="json",o=JSON.parse(u))}r=r&&a==="json",U.set(n,s,o)}return[n,r]}function st(t){if(A(t)||re(t)||Re(t))return"json";if(!O(t))return;let e=t[Symbol.toStringTag],r=["Uint8Array","Uint16Array","Uint32Array","ArrayBuffer","Blob","File","FormData","Stream","ReadableStream"].reduce((n,s)=>n||(e===s?s:null),null);if(r)return r;if(_(t)&&qe(t)||b(t)&&Ue(t)||"toString"in t)return"json"}var Pe=class extends FormData{async json(e={}){return(await $t(this,...arguments))[0]}static compat(e){if(e instanceof this)return e;if(e instanceof FormData)return Object.setPrototypeOf(e,new this)}};var qr=(t,e)=>{let r=class extends t{constructor(n,s,o){s.headers&&(s={...s,headers:new e(s.headers)}),super(n,s),o.headers&&this.headers.json(o.headers);let a={};Object.defineProperty(this,"_attrs",{get:()=>a}),Object.defineProperty(this,"meta",{get:()=>o})}get attrs(){return this._attrs||{}}clone(){return new this.constructor(super.clone())}get headers(){return e.compat(super.headers),super.headers}get url(){return"url"in this.attrs?this.attrs.url:super.url}async arrayBuffer(){return this.meta.type==="ArrayBuffer"?this.meta.body:super.arrayBuffer()}async blob(){return["Blob","File"].includes(this.meta.type)?this.meta.body:super.blob()}async formData(){let n;return this.meta.type==="FormData"&&this.meta.body instanceof FormData?n=this.meta.body:n=await super.formData(),n&&(n=Pe.compat(n)),n}async json(){return this.meta.type==="json"&&O(this.meta.body)?this.meta.body:super.json()}async text(){return this.meta.type==="json"&&!O(this.meta.body)?this.meta.body:super.text()}jsonfy(n=!1){return(!this.meta.jsonfied||n)&&(this.meta.jsonfied=new Promise(async(s,o)=>{let a,u=this.headers.get("Content-Type")||"";try{u==="application/x-www-form-urlencoded"||u.startsWith("multipart/form-data")?a=await(await this.formData())?.json():u==="application/json"?a=await this.json():u==="text/plain"&&(a=await this.text()),s(a)}catch(f){o(f)}})),this.meta.jsonfied}};return r.Headers=e,r},$e=qr;var Y=class extends Headers{constructor(e={}){let r=e.cookies;delete e.cookies,e instanceof Headers?super(e):(super(),this.json(e)),this.cookies=r}set(e,r){return this.catchCookies(e,r),super.set(e,r)}append(e,r){return this.catchCookies(e,r,!0),super.append(e,r)}delete(e){return this.catchCookies(e),super.delete(e)}set cookies(e){if(e instanceof Map){this.cookies.clear();for(let[r,n]of e)this.cookies.set(r,n)}else e&&this.set(this.cookieHeaderName,e);return!0}get cookies(){return this._cookies||(this._cookies=new this.Cookies,Object.defineProperty(this._cookies,"headers",{value:this})),this._cookies}catchCookies(e,r,n=!1){if(!(!this.cookies||e.toLowerCase()!==this.cookieHeaderName.toLowerCase())){if(this.cookies.outLock=!0,arguments.length>1){n||this.cookies.clear();let s=this.cookies.parse(r);for(let o in s)this.cookies.set(o,s[o])}else this.cookies.clear();this.cookies.outLock=!1}}json(e={},r=!0){if(arguments.length){let a=it(this),u=Object.keys(a).reduce((f,c)=>f.concat(typeof c!="symbol"&&"set"in a[c]?c:[]),[]);Object.keys(e).forEach(f=>{var c=u.reduce((h,y)=>h||(y===f||y.toLocaleLowerCase()===f?y:null),null);c?(r||this[c]===void 0)&&(this[c]=e[f]):(r||!this.has(f))&&this.set(f,e[f])});return}let n={};for(var[s,o]of this)n[s]=o;return n}set cacheControl(e){return this.set("Cache-Control",e)}get cacheControl(){return this.get("Cache-Control")}set contentLength(e){return this.set("Content-Length",e)}get contentLength(){return this.get("Content-Length")}set contentType(e){return this.set("Content-Type",e)}get contentType(){return this.get("Content-Type")}static compat(e){if(!(e instanceof this)&&!e.json){let r=it(new this);Object.keys(r).forEach(n=>{typeof n=="symbol"||n in e||Object.defineProperty(e,n,r[n])})}return e}};function it(t){if(t){let e=Object.getPrototypeOf(t);return e===Object.prototype?{}:{...it(e),...Object.getOwnPropertyDescriptors(t)}}else return Object.create(null)}var ee=class extends Map{constructor(...e){super(...e),Object.defineProperty(this,"inLock",{value:!1,writable:!0}),Object.defineProperty(this,"outLock",{value:!1,writable:!0})}set(e,r){if(this.inLock)return;this.has(e)&&this.delete(e),this.inLock=!0;let n=r,s=r,o;return A(r)&&(n=this.parseEntry(`=${r}`)[1]),o=super.set(e,n),this.outLock||(_(r)&&(s=this.stringifyEntry(r)),Ft(this.headers,`${e}=${s}`)),this.inLock=!1,o}delete(e){if(this.inLock)return;this.inLock=!0;let r=super.delete(e);this.headers.delete(this.headers.cookieHeaderName);for(let[n,s]of this)Ft(this.headers,`${n}=${this.stringifyEntry(s)}`);return this.inLock=!1,r}clear(){if(this.inLock)return;this.inLock=!0;let e=super.clear();return this.headers.delete(this.headers.cookieHeaderName),this.inLock=!1,e}json(e={}){if(arguments.length){this.clear();for(let r in e)this.set(r,e[r]);return}for(let[r,n]of this)e[r]=n;return e}toString(){return this.headers.get(this.headers.cookieHeaderName)}};function Ft(t,e){let r=[e],n=t.get(t.cookieHeaderName);n&&r.unshift(n),t.set(t.cookieHeaderName,r.join(t.cookieHeaderSeparator))}var Oe=class extends Y{get cookieHeaderName(){return"Cookie"}get cookieHeaderSeparator(){return";"}get Cookies(){return ot}set accept(e){return this.set("Accept",e)}get accept(){let e=this.get("Accept"),r=e&&e.split(",").map(n=>(n=n.trim().split(";").map(s=>s.trim()),[n.shift(),parseFloat((n.pop()||"1").replace("q=",""))])).sort((n,s)=>n[1]>s[1]?-1:1)||[];return{match(n){return n=(n+"").split("/"),r.reduce((s,o)=>s||(o=o[0].split("/"))&&[0,1].every(a=>n[a]===o[a]||n[a]==="*"||o[a]==="*"),!1)},toString(){return e}}}set range(e){let r=[];return I(e).forEach((n,s)=>{let o=Array.isArray(n)?n.join("-"):n+"";s===0&&!o.includes("bytes=")&&(o=`bytes=${o}`),r.push(o)}),this.set("Range",r.join(", "))}get range(){let e=this.get("Range");return e?W(e,"bytes=").split(",").map(n=>{let s=n.trim().split("-");return s[0]=s[0]?parseInt(s[0],10):void 0,s[1]&&(s[1]=parseInt(s[1],10)),s.clamp=o=>{(s[1]>o-1||s[1]===void 0)&&(s[1]=o-1),s[0]===void 0&&(s[0]=s[1]?o-s[1]-1:0)},s}):void 0}set cors(e){return this.set("Access-Control-Allow-Origin",e===!0?"*":e===!1?"":e)}get cors(){return this.get("Access-Control-Allow-Origin")}},ot=class extends ee{parse(e){return U.parse(e,";")}parseEntry(e){return e.trim().split("=")}stringifyEntry(e){return e}};var L=class extends $e(Request,Oe){constructor(e,r={},n={}){if(!(r instanceof Request)){if("body"in r){let[s,o,a]=ie(r);n={...n,type:a,body:r.body},r={...r,body:s,headers:o}}}super(e,r,n)}static compat(e){return e instanceof this?e:e instanceof Request?Object.setPrototypeOf(e,new this):new this(e)}static async rip(e){let r=["method","headers","mode","credentials","cache","redirect","referrer","integrity"].reduce((n,s)=>({[s]:e[s],...n}),{});return["GET","HEAD"].includes(e.method)||(r.body=await e.clone().arrayBuffer()),r.mode==="navigate"&&(r.mode="cors"),[e.url,r]}};var Se=class extends Y{get cookieHeaderName(){return"Set-Cookie"}get cookieHeaderSeparator(){return","}get Cookies(){return at}set contentRange(e){if(Array.isArray(e)){if(e.length===2&&!e[0].includes("-")||e.length<2)throw new Error("A Content-Range array must be in the format: [ 'start-end', 'total' ]");return this.set("Content-Range",`bytes ${e.join("/")}`)}return this.set("Content-Range",e)}get contentRange(){let e=this.get("Content-Range");return e&&W(e,"bytes ").split("/")}set cors(e){return this.set("Access-Control-Allow-Origin",e===!0?"*":e===!1?"":e)}get cors(){return this.get("Access-Control-Allow-Origin")}set attachment(e){if(e=e===!0?"attachment":e===!1?"inline":e,!A(e))throw new Error(`The "download" response directive does not support the type: ${H(e)}`);return["attachment","inline"].includes(e)||(e=`attachment; filename="${e}"`),this.set("Content-Disposition",e)}get attachment(){var e=(this.get("Content-Disposition")||"").trim();return e=e==="attachment"?!0:e==="inline"?!1:W(Le(e,'"'),'filename="'),e}get location(){return this.get("Location")}set location(e){return this.set("Location",e)}},at=class extends ee{parse(e){let r={};return e&&e.split(",").forEach(n=>{let[s,o]=this.parseEntry(n);r[s]=o}),r}parseEntry(e){let[r,n]=e.split(";"),[s,o]=r.trim().split("="),a={value:o};return n&&(n||"").split(/\;/g).map(u=>u.trim().split("=")).forEach(u=>{a[u[0][0].toLowerCase()+u[0].substring(1).replace("-","")]=u.length===1?!0:u[1]}),[s,a]}stringifyEntry(e){if(_(e)){let r=[e.value];for(let n in e){if(n==="value")continue;let s=n[0].toUpperCase()+n.substring(1);s==="MaxAge"&&(s="Max-Age"),r.push(e[n]===!0?s:`${s}=${e[n]}`)}e=r.join(";")}return e}};var D=class extends $e(Response,Se){constructor(e=null,r={},n={}){if(e||e===0){let s,o,a=e;[e,s,o]=ie({body:e,headers:r.headers}),n={...r,type:o,body:a},r={...r,headers:s}}super(e,r,n)}static compat(e){return e instanceof this?e:e instanceof Response?Object.setPrototypeOf(e,new this):new this(e)}};var Hr=async(t,e={})=>{if(e.body){let[s,o]=ie(e);e={...e,body:s,headers:o}}let r=await fetch(t,e),n;if(e.decompress===!1&&(n=r.headers.get("Content-Encoding"))){let s=r.body.pipeThrough(new CompressionStream(n));r=new Response(s,r)}return r},ft=Hr;var te=class extends URL{constructor(...e){super(...e);var r=U.parse(this.search);let n=s=>{var o=U.stringify(s);o=o?"?"+o:"",o!==this.search&&(this.search=o)};this.__query={value:r,proxy:new Proxy(r,{set(s,o,a){return s[o]=a,n(s),!0},deleteProperty(s,o){return delete s[o],n(s),!0}})}}set search(e){super.search=e;var r=U.parse(e);ut(r,this.query)||(this.query=r)}get search(){return super.search}get query(){return this.__query.proxy}};te.Observable=class extends te{constructor(){super(...arguments);let{Observer:t}=webqit;t.accessorize(this,["protocol","username","password","host","hostname","port","origin","pathname","search","query","hash","href"])}};var ut=(t,e)=>_(t)&&_(e)?ut(Object.keys(t),Object.keys(e))&&ut(Object.values(t),Object.values(e)):b(t)&&b(e)?t.length===e.length&&t.reduce((r,n,s)=>r&&n===e[s],!0):t===e;var V=class{constructor(e,r,n,s){this._request=e,this._detail=r||{},this._sessionFactory=n,this._storageFactory=s,this.Request=L,this.Response=D,this.URL=te,this.port={listeners:[],post(o){let a=this.listeners.map(u=>u(o)).filter(u=>u instanceof Promise);if(process.length)return Promise.all(a)},listen(o){this.listeners.push(o)}}}get url(){return this._url||(this._url=new this.URL(this._request.url)),this._url}get request(){return this._request}get detail(){return this._detail}get session(){return this._session||(this._session=this.sessionFactory()),this._session}get storage(){return this._storage||(this._storage=this.storageFactory()),this._storage}sessionFactory(...e){return this._sessionFactory(...e)}storageFactory(...e){return this._storageFactory(...e)}redirect(e,r=302){return new this.Response(null,{status:r,headers:{Location:e}})}async with(e,r={}){let n;return e instanceof Request?(r instanceof Request&&([,r]=await L.rip(r)),n=ce(r)?e:new L(e,r)):(e=new this.URL(e,this.url.origin),[,r]=await L.rip(this._request),n=new L(e,{...r,referrer:this.request.url})),new V(n,this.detail,this._sessionFactory,this.storageFactory)}};var ke=class extends be{constructor(e,r){super(e,r),this.mockSessionStore={},self.addEventListener("install",s=>{this.cx.params.skip_waiting&&self.skipWaiting(),this.cx.params.cache_name&&(this.cx.params.cache_only_urls||[]).length&&s.waitUntil(self.caches.open(this.cx.params.cache_name).then(o=>{this.cx.logger&&this.cx.logger.log("[ServiceWorker] Pre-caching resources.");let a=(this.cx.params.cache_only_urls||[]).map(u=>u.trim()).filter(u=>u&&!ze(u,self.origin).isPattern());return o.addAll(a)}))}),self.addEventListener("activate",s=>{s.waitUntil(new Promise(async o=>{this.cx.params.skip_waiting&&await self.clients.claim(),this.cx.params.cache_name&&await self.caches.keys().then(a=>Promise.all(a.map(u=>{if(u!==this.cx.params.cache_name&&u!==this.cx.params.cache_name+"_json")return this.cx.logger&&this.cx.logger.log("[ServiceWorker] Removing old cache:",u),self.caches.delete(u)}))),o()}))}),v.set(this,"location",{}),v.set(this,"network",{}),v.observe(this.network,s=>{}),self.addEventListener("fetch",s=>{!s.request.url.startsWith("http")||s.respondWith((async o=>{let a=await self.clients.get(o.clientId);this.workport.setCurrentClient(a);let[u,f]=await L.rip(o.request);return f.cache==="force-cache"&&(f.cache="default"),this.go(u,f,{event:o})})(s))});let n=new we;v.set(this,"workport",n),(async()=>{if(!this.app.init)return;let s=this.generateRequest("/"),o=new V(s,{srcType:"initialization"},(a=null,u=!1)=>this.getSession(o,a,u));await this.app.init(o,(...a)=>this.remoteFetch(...a))})()}async go(e,r={},n={}){e=typeof e=="string"?new URL(e,self.location.origin):e,!(r instanceof Request)&&!r.referrer&&(r={referrer:this.location.href,...r});let s=this.generateRequest(e.href,r);n.event&&Object.defineProperty(n.event,"request",{value:s});let o=new V(s,n,(f=null,c=!1)=>this.getSession(o,f,c));o.port.listen(f=>{if(f.$type==="handler:hints"&&f.session)return Promise.resolve()});let a;return o.request.url.startsWith(self.origin)?a=await this.app.handle(o,(...f)=>this.remoteFetch(...f)):a=await this.remoteFetch(o.request),await this.handleResponse(o,a)}generateRequest(e,r={}){return new L(e,r)}getSession(e,r=null,n=!1){return{get:()=>this.mockSessionStore,set:s=>{this.mockSessionStore=s}}}remoteFetch(e,...r){arguments.length>1&&(e=this.generateRequest(e,...r));let n=(a,u)=>Be((a||[]).map(f=>f.trim()).filter(f=>f),f=>ze(f,self.origin).test(u)),o=(()=>{if(!this.cx.params.default_fetching_strategy||this.cx.params.default_fetching_strategy==="network-first"||n(this.cx.params.network_first_urls,e.url))return v.set(this.network,"strategy","network-first"),this.networkFetch(e,{cacheFallback:!0,cacheRefresh:!0});if(this.cx.params.default_fetching_strategy==="cache-first"||n(this.cx.params.cache_first_urls,e.url))return v.set(this.network,"strategy","cache-first"),this.cacheFetch(e,{networkFallback:!0,cacheRefresh:!0});if(this.cx.params.default_fetching_strategy==="network-only"||n(this.cx.params.network_only_urls,e.url))return v.set(this.network,"strategy","network-only"),this.networkFetch(e,{cacheFallback:!1,cacheRefresh:!1});if(this.cx.params.default_fetching_strategy==="cache-only"||n(this.cx.params.cache_only_urls,e.url))return v.set(this.network,"strategy","cache-only"),this.cacheFetch(e,{networkFallback:!1,cacheRefresh:!1})})(e);return o.catch(a=>v.set(this.network,"error",a.message)),o.then(a=>D.compat(a))}networkFetch(e,r={}){return r.cacheFallback?ft(e).then(n=>(r.cacheRefresh&&this.refreshCache(e,n),v.set(this.network,"remote",!0),n)).catch(()=>this.getRequestCache(e).then(n=>(v.set(this.network,"cache",!0),n.match(e)))):(v.set(this.network,"remote",!0),ft(e))}cacheFetch(e,r={}){return this.getRequestCache(e).then(n=>n.match(e).then(s=>!s&&r.networkFallback?this.networkFetch(e,{...r,cacheFallback:!1}):(s&&r.cacheRefresh&&this.networkFetch(e,{...r,justRefreshing:!0}),v.set(this.network,"cache",!0),s)))}refreshCache(e,r){if(e.method!=="GET"||!r||r.status!==200||r.type!=="basic"&&r.type!=="cors")return r;var n=r.clone();return this.getRequestCache(e).then(s=>{v.set(this.network,"cacheRefresh",!0),s.put(e,n)}),r}getRequestCache(e){let r=e.headers.get("Accept")==="application/json"?this.cx.params.cache_name+"_json":this.cx.params.cache_name;return self.caches.open(r)}handleResponse(e,r){return!r&&r!==0?r=new D(null,{status:404}):r instanceof D||(r=D.compat(r)),r}};async function Tt(t=null){let e=this||{},r=n=>new ye(n);return new ke(fe.create(e),t||r)}self.webqit={};var zr={},Wr={cache_name:"cache_v0",default_fetching_strategy:"network-first",network_first_urls:[],cache_first_urls:[],network_only_urls:[],cache_only_urls:[],skip_waiting:!0,support_push:!1,push_registration_url:"",push_deregistration_url:"",push_public_key:"",routing:{root:"/",subroots:[],targets:1}};webqit.app=await Tt.call({layout:zr,params:Wr});
})();
