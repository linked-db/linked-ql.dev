/** @webqit/webflo */(async () => {
var Tt=Object.defineProperty;var Nt=(t,e)=>()=>(t&&(e=t(t=0)),e);var Le=(t,e)=>{for(var r in e)Tt(t,r,{get:e[r],enumerable:!0})};var Ct={};Le(Ct,{URLPattern:()=>kt});function Wt(t,e){return(e?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(t)}function ht(t,e=!1){let r=[],n=0;for(;n<t.length;){let s=t[n],i=function(o){if(!e)throw new TypeError(o);r.push({type:"INVALID_CHAR",index:n,value:t[n++]})};if(s==="*"){r.push({type:"ASTERISK",index:n,value:t[n++]});continue}if(s==="+"||s==="?"){r.push({type:"MODIFIER",index:n,value:t[n++]});continue}if(s==="\\"){r.push({type:"ESCAPED_CHAR",index:n++,value:t[n++]});continue}if(s==="{"){r.push({type:"OPEN",index:n,value:t[n++]});continue}if(s==="}"){r.push({type:"CLOSE",index:n,value:t[n++]});continue}if(s===":"){let o="",f=n+1;for(;f<t.length;){let a=t.substr(f,1);if(f===n+1&&Mt.test(a)||f!==n+1&&zt.test(a)){o+=t[f++];continue}break}if(!o){i(`Missing parameter name at ${n}`);continue}r.push({type:"NAME",index:n,value:o}),n=f;continue}if(s==="("){let o=1,f="",a=n+1,u=!1;if(t[a]==="?"){i(`Pattern cannot start with "?" at ${a}`);continue}for(;a<t.length;){if(!Wt(t[a],!1)){i(`Invalid character '${t[a]}' at ${a}.`),u=!0;break}if(t[a]==="\\"){f+=t[a++]+t[a++];continue}if(t[a]===")"){if(o--,o===0){a++;break}}else if(t[a]==="("&&(o++,t[a+1]!=="?")){i(`Capturing groups are not allowed at ${a}`),u=!0;break}f+=t[a++]}if(u)continue;if(o){i(`Unbalanced pattern at ${n}`);continue}if(!f){i(`Missing pattern at ${n}`);continue}r.push({type:"PATTERN",index:n,value:f}),n=a;continue}r.push({type:"CHAR",index:n,value:t[n++]})}return r.push({type:"END",index:n,value:""}),r}function pt(t,e={}){let r=ht(t),{prefixes:n="./"}=e,s=`[^${te(e.delimiter||"/#?")}]+?`,i=[],o=0,f=0,a="",u=new Set,c=l=>{if(f<r.length&&r[f].type===l)return r[f++].value},d=()=>{let l=c("MODIFIER");return l||c("ASTERISK")},m=l=>{let g=c(l);if(g!==void 0)return g;let{type:x,index:w}=r[f];throw new TypeError(`Unexpected ${x} at ${w}, expected ${l}`)},h=()=>{let l="",g;for(;g=c("CHAR")||c("ESCAPED_CHAR");)l+=g;return l},P=l=>l,p=e.encodePart||P;for(;f<r.length;){let l=c("CHAR"),g=c("NAME"),x=c("PATTERN");if(!g&&!x&&c("ASTERISK")&&(x=".*"),g||x){let O=l||"";n.indexOf(O)===-1&&(a+=O,O=""),a&&(i.push(p(a)),a="");let v=g||o++;if(u.has(v))throw new TypeError(`Duplicate name '${v}'.`);u.add(v),i.push({name:v,prefix:p(O),suffix:"",pattern:x||s,modifier:d()||""});continue}let w=l||c("ESCAPED_CHAR");if(w){a+=w;continue}if(c("OPEN")){let O=h(),v=c("NAME")||"",$=c("PATTERN")||"";!v&&!$&&c("ASTERISK")&&($=".*");let Ft=h();m("CLOSE");let ft=d()||"";if(!v&&!$&&!ft){a+=O;continue}if(!v&&!$&&!O)continue;a&&(i.push(p(a)),a=""),i.push({name:v||($?o++:""),pattern:v&&!$?s:$,prefix:p(O),suffix:p(Ft),modifier:ft});continue}a&&(i.push(p(a)),a=""),m("END")}return i}function te(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function mt(t){return t&&t.sensitive?"u":"ui"}function Bt(t,e){if(!e)return t;let r=/\((?:\?<(.*?)>)?(?!\?)/g,n=0,s=r.exec(t.source);for(;s;)e.push({name:s[1]||n++,prefix:"",suffix:"",modifier:"",pattern:""}),s=r.exec(t.source);return t}function Vt(t,e,r){let n=t.map(s=>gt(s,e,r).source);return new RegExp(`(?:${n.join("|")})`,mt(r))}function Jt(t,e,r){return dt(pt(t,r),e,r)}function dt(t,e,r={}){let{strict:n=!1,start:s=!0,end:i=!0,encode:o=c=>c}=r,f=`[${te(r.endsWith||"")}]|$`,a=`[${te(r.delimiter||"/#?")}]`,u=s?"^":"";for(let c of t)if(typeof c=="string")u+=te(o(c));else{let d=te(o(c.prefix)),m=te(o(c.suffix));if(c.pattern)if(e&&e.push(c),d||m)if(c.modifier==="+"||c.modifier==="*"){let h=c.modifier==="*"?"?":"";u+=`(?:${d}((?:${c.pattern})(?:${m}${d}(?:${c.pattern}))*)${m})${h}`}else u+=`(?:${d}(${c.pattern})${m})${c.modifier}`;else c.modifier==="+"||c.modifier==="*"?u+=`((?:${c.pattern})${c.modifier})`:u+=`(${c.pattern})${c.modifier}`;else u+=`(?:${d}${m})${c.modifier}`}if(i)n||(u+=`${a}?`),u+=r.endsWith?`(?=${f})`:"$";else{let c=t[t.length-1],d=typeof c=="string"?a.indexOf(c[c.length-1])>-1:c===void 0;n||(u+=`(?:${a}(?=${f}))?`),d||(u+=`(?=${a}|${f})`)}return new RegExp(u,mt(r))}function gt(t,e,r){return t instanceof RegExp?Bt(t,e):Array.isArray(t)?Vt(t,e,r):Jt(t,e,r)}function Zt(t,e){return t.length?t[0]==="/"?!0:!e||t.length<2?!1:(t[0]=="\\"||t[0]=="{")&&t[1]=="/":!1}function yt(t,e){return t.startsWith(e)?t.substring(e.length,t.length):t}function Qt(t,e){return t.endsWith(e)?t.substr(0,t.length-e.length):t}function xt(t){return!t||t.length<2?!1:t[0]==="["||(t[0]==="\\"||t[0]==="{")&&t[1]==="["}function wt(t){if(!t)return!0;for(let e of _t)if(t.test(e))return!0;return!1}function Xt(t,e){if(t=yt(t,"#"),e||t==="")return t;let r=new URL("https://example.com");return r.hash=t,r.hash?r.hash.substring(1,r.hash.length):""}function Yt(t,e){if(t=yt(t,"?"),e||t==="")return t;let r=new URL("https://example.com");return r.search=t,r.search?r.search.substring(1,r.search.length):""}function er(t,e){return e||t===""?t:xt(t)?Ot(t):Pt(t)}function tr(t,e){if(e||t==="")return t;let r=new URL("https://example.com");return r.password=t,r.password}function rr(t,e){if(e||t==="")return t;let r=new URL("https://example.com");return r.username=t,r.username}function nr(t,e,r){if(r||t==="")return t;if(e&&!_t.includes(e))return new URL(`${e}:${t}`).pathname;let n=t[0]=="/";return t=new URL(n?t:"/-"+t,"https://example.com").pathname,n||(t=t.substring(2,t.length)),t}function sr(t,e,r){return bt(e)===t&&(t=""),r||t===""?t:St(t)}function ir(t,e){return t=Qt(t,":"),e||t===""?t:qe(t)}function bt(t){switch(t){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function qe(t){if(t==="")return t;if(/^[-+.A-Za-z0-9]*$/.test(t))return t.toLowerCase();throw new TypeError(`Invalid protocol '${t}'.`)}function or(t){if(t==="")return t;let e=new URL("https://example.com");return e.username=t,e.username}function ar(t){if(t==="")return t;let e=new URL("https://example.com");return e.password=t,e.password}function Pt(t){if(t==="")return t;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(t))throw new TypeError(`Invalid hostname '${t}'`);let e=new URL("https://example.com");return e.hostname=t,e.hostname}function Ot(t){if(t==="")return t;if(/[^0-9a-fA-F[\]:]/g.test(t))throw new TypeError(`Invalid IPv6 hostname '${t}'`);return t.toLowerCase()}function St(t){if(t===""||/^[0-9]*$/.test(t)&&parseInt(t)<=65535)return t;throw new TypeError(`Invalid port '${t}'.`)}function fr(t){if(t==="")return t;let e=new URL("https://example.com");return e.pathname=t[0]!=="/"?"/-"+t:t,t[0]!=="/"?e.pathname.substring(2,e.pathname.length):e.pathname}function ur(t){return t===""?t:new URL(`data:${t}`).pathname}function cr(t){if(t==="")return t;let e=new URL("https://example.com");return e.search=t,e.search.substring(1,e.search.length)}function lr(t){if(t==="")return t;let e=new URL("https://example.com");return e.hash=t,e.hash.substring(1,e.hash.length)}function lt(t,e){if(typeof t!="string")throw new TypeError("parameter 1 is not of type 'string'.");let r=new URL(t,e);return{protocol:r.protocol.substring(0,r.protocol.length-1),username:r.username,password:r.password,hostname:r.hostname,port:r.port,pathname:r.pathname,search:r.search!=""?r.search.substring(1,r.search.length):void 0,hash:r.hash!=""?r.hash.substring(1,r.hash.length):void 0}}function ue(t,e,r){let n;if(typeof e.baseURL=="string")try{n=new URL(e.baseURL),t.protocol=n.protocol?n.protocol.substring(0,n.protocol.length-1):"",t.username=n.username,t.password=n.password,t.hostname=n.hostname,t.port=n.port,t.pathname=n.pathname,t.search=n.search?n.search.substring(1,n.search.length):"",t.hash=n.hash?n.hash.substring(1,n.hash.length):""}catch{throw new TypeError(`invalid baseURL '${e.baseURL}'.`)}if(typeof e.protocol=="string"&&(t.protocol=ir(e.protocol,r)),typeof e.username=="string"&&(t.username=rr(e.username,r)),typeof e.password=="string"&&(t.password=tr(e.password,r)),typeof e.hostname=="string"&&(t.hostname=er(e.hostname,r)),typeof e.port=="string"&&(t.port=sr(e.port,t.protocol,r)),typeof e.pathname=="string"){if(t.pathname=e.pathname,n&&!Zt(t.pathname,r)){let s=n.pathname.lastIndexOf("/");s>=0&&(t.pathname=n.pathname.substring(0,s+1)+t.pathname)}t.pathname=nr(t.pathname,t.protocol,r)}return typeof e.search=="string"&&(t.search=Yt(e.search,r)),typeof e.hash=="string"&&(t.hash=Xt(e.hash,r)),t}function ce(t){return t.replace(/([+*?:{}()\\])/g,"\\$1")}function mr(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function dr(t,e){let r=".*",n=`[^${mr(e.delimiter||"/#?")}]+?`,s=/[$_\u200C\u200D\p{ID_Continue}]/u,i="";for(let o=0;o<t.length;++o){let f=t[o],a=o>0?t[o-1]:null,u=o<t.length-1?t[o+1]:null;if(typeof f=="string"){i+=ce(f);continue}if(f.pattern===""){if(f.modifier===""){i+=ce(f.prefix);continue}i+=`{${ce(f.prefix)}}${f.modifier}`;continue}let c=typeof f.name!="number",d=e.prefixes!==void 0?e.prefixes:"./",m=f.suffix!==""||f.prefix!==""&&(f.prefix.length!==1||!d.includes(f.prefix));if(!m&&c&&f.pattern===n&&f.modifier===""&&u&&!u.prefix&&!u.suffix)if(typeof u=="string"){let h=u.length>0?u[0]:"";m=s.test(h)}else m=typeof u.name=="number";if(!m&&f.prefix===""&&a&&typeof a=="string"&&a.length>0){let h=a[a.length-1];m=d.includes(h)}m&&(i+="{"),i+=ce(f.prefix),c&&(i+=`:${f.name}`),f.pattern===r?!c&&(!a||typeof a=="string"||a.modifier||m||f.prefix!=="")?i+="*":i+=`(${r})`:f.pattern===n?c||(i+=`(${n})`):i+=`(${f.pattern})`,f.pattern===n&&c&&f.suffix!==""&&s.test(f.suffix[0])&&(i+="\\"),i+=ce(f.suffix),m&&(i+="}"),i+=f.modifier}return i}var Mt,zt,H,Gt,Kt,_t,hr,pr,q,kt,Et=Nt(()=>{Mt=/[$_\p{ID_Start}]/u,zt=/[$_\u200C\u200D\p{ID_Continue}]/u;H={delimiter:"",prefixes:"",sensitive:!0,strict:!0},Gt={delimiter:".",prefixes:"",sensitive:!0,strict:!0},Kt={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};_t=["ftp","file","http","https","ws","wss"];hr=class{constructor(t){this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=0,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=t}get result(){return this.internalResult}parse(){for(this.tokenList=ht(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===0){this.rewind(),this.isHashPrefix()?this.changeState(9,1):this.isSearchPrefix()?(this.changeState(8,1),this.internalResult.hash=""):(this.changeState(7,0),this.internalResult.search="",this.internalResult.hash="");continue}else if(this.state===2){this.rewindAndSetState(5);continue}this.changeState(10,0);break}if(this.groupDepth>0)if(this.isGroupClose())this.groupDepth-=1;else continue;if(this.isGroupOpen()){this.groupDepth+=1;continue}switch(this.state){case 0:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(1));break;case 1:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();let t=7,e=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(t=2,e=3):this.shouldTreatAsStandardURL&&(t=2),this.changeState(t,e)}break;case 2:this.isIdentityTerminator()?this.rewindAndSetState(3):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(5);break;case 3:this.isPasswordPrefix()?this.changeState(4,1):this.isIdentityTerminator()&&this.changeState(5,1);break;case 4:this.isIdentityTerminator()&&this.changeState(5,1);break;case 5:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(6,1):this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 6:this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 7:this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 8:this.isHashPrefix()&&this.changeState(9,1);break;case 9:break;case 10:break}}}changeState(t,e){switch(this.state){case 0:break;case 1:this.internalResult.protocol=this.makeComponentString();break;case 2:break;case 3:this.internalResult.username=this.makeComponentString();break;case 4:this.internalResult.password=this.makeComponentString();break;case 5:this.internalResult.hostname=this.makeComponentString();break;case 6:this.internalResult.port=this.makeComponentString();break;case 7:this.internalResult.pathname=this.makeComponentString();break;case 8:this.internalResult.search=this.makeComponentString();break;case 9:this.internalResult.hash=this.makeComponentString();break;case 10:break}this.changeStateWithoutSettingComponent(t,e)}changeStateWithoutSettingComponent(t,e){this.state=t,this.componentStart=this.tokenIndex+e,this.tokenIndex+=e,this.tokenIncrement=0}rewind(){this.tokenIndex=this.componentStart,this.tokenIncrement=0}rewindAndSetState(t){this.rewind(),this.state=t}safeToken(t){return t<0&&(t=this.tokenList.length-t),t<this.tokenList.length?this.tokenList[t]:this.tokenList[this.tokenList.length-1]}isNonSpecialPatternChar(t,e){let r=this.safeToken(t);return r.value===e&&(r.type==="CHAR"||r.type==="ESCAPED_CHAR"||r.type==="INVALID_CHAR")}isProtocolSuffix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}nextIsAuthoritySlashes(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")}isIdentityTerminator(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")}isPasswordPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPortPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPathnameStart(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")}isSearchPrefix(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;let t=this.safeToken(this.tokenIndex-1);return t.type!=="NAME"&&t.type!=="PATTERN"&&t.type!=="CLOSE"&&t.type!=="ASTERISK"}isHashPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")}isGroupOpen(){return this.tokenList[this.tokenIndex].type=="OPEN"}isGroupClose(){return this.tokenList[this.tokenIndex].type=="CLOSE"}isIPv6Open(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")}isIPv6Close(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")}makeComponentString(){let t=this.tokenList[this.tokenIndex],e=this.safeToken(this.componentStart).index;return this.input.substring(e,t.index)}computeShouldTreatAsStandardURL(){let t={};Object.assign(t,H),t.encodePart=qe;let e=gt(this.makeComponentString(),void 0,t);this.shouldTreatAsStandardURL=wt(e)}},pr=["protocol","username","password","hostname","port","pathname","search","hash"],q="*";kt=class{constructor(t={},e){this.regexp={},this.keys={},this.component_pattern={};try{if(typeof t=="string"){let s=new hr(t);if(s.parse(),t=s.result,e)if(typeof e=="string")t.baseURL=e;else throw new TypeError("'baseURL' parameter is not of type 'string'.");else if(typeof t.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.")}else if(e)throw new TypeError("parameter 1 is not of type 'string'.");if(!t||typeof t!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");let r={pathname:q,protocol:q,username:q,password:q,hostname:q,port:q,search:q,hash:q};this.pattern=ue(r,t,!0),bt(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");let n;for(n of pr){if(!(n in this.pattern))continue;let s={},i=this.pattern[n];switch(this.keys[n]=[],n){case"protocol":Object.assign(s,H),s.encodePart=qe;break;case"username":Object.assign(s,H),s.encodePart=or;break;case"password":Object.assign(s,H),s.encodePart=ar;break;case"hostname":Object.assign(s,Gt),xt(i)?s.encodePart=Ot:s.encodePart=Pt;break;case"port":Object.assign(s,H),s.encodePart=St;break;case"pathname":wt(this.regexp.protocol)?(Object.assign(s,Kt),s.encodePart=fr):(Object.assign(s,H),s.encodePart=ur);break;case"search":Object.assign(s,H),s.encodePart=cr;break;case"hash":Object.assign(s,H),s.encodePart=lr;break}try{let o=pt(i,s);this.regexp[n]=dt(o,this.keys[n],s),this.component_pattern[n]=dr(o,s)}catch{throw new TypeError(`invalid ${n} pattern '${this.pattern[n]}'.`)}}}catch(r){throw new TypeError(`Failed to construct 'URLPattern': ${r.message}`)}}test(t={},e){let r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof t>"u")return!1;try{typeof t=="object"?r=ue(r,t,!1):r=ue(r,lt(t,e),!1)}catch{return!1}let n;for(n in this.pattern)if(!this.regexp[n].exec(r[n]))return!1;return!0}exec(t={},e){let r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof t>"u")return;try{typeof t=="object"?r=ue(r,t,!1):r=ue(r,lt(t,e),!1)}catch{return null}let n={};e?n.inputs=[t,e]:n.inputs=[t];let s;for(s in this.pattern){let i=this.regexp[s].exec(r[s]);if(!i)return null;let o={};for(let[f,a]of this.keys[s].entries())if(typeof a.name=="string"||typeof a.name=="number"){let u=i[f+1];o[a.name]=u}n[s]={input:r[s]||"",groups:o}}return n}get protocol(){return this.component_pattern.protocol}get username(){return this.component_pattern.username}get password(){return this.component_pattern.password}get hostname(){return this.component_pattern.hostname}get port(){return this.component_pattern.port}get pathname(){return this.component_pattern.pathname}get search(){return this.component_pattern.search}get hash(){return this.component_pattern.hash}};globalThis.URLPattern||(globalThis.URLPattern=kt)});var se=class{constructor(e,r=null){Object.defineProperty(this,"dict",{value:Object.create(e)});for(let n in this.dict)n in this||(this[n]=this.dict[n]);arguments.length>1&&Object.defineProperty(this.dict,"CWD",{get:()=>r})}get name(){return"webflo"}static create(...e){return new this(...e)}get CWD(){return this.dict.CWD||""}get meta(){return this.dict.meta||{}}get app(){return this.dict.app||{}}get config(){return this.dict.config||{}}get flags(){return this.dict.flags||{}}set flags(e){Object.defineProperty(this.dict,"flags",{value:e})}get layout(){return this.dict.layout||{}}set layout(e){Object.defineProperty(this.dict,"layout",{value:e})}get logger(){return this.dict.logger}set logger(e){Object.defineProperty(this.dict,"logger",{value:e})}};var ie=class extends se{};var oe=class extends ie{};function y(t){return!Array.isArray(t)&&typeof t=="object"&&t}function U(t){return typeof t}function _(t){return Array.isArray(t)}function $e(t,e,r=null){return _(e)?t.filter(n=>r?e.filter(s=>r(n,s)).length:e.indexOf(n)!==-1):[]}function ke(t,...e){if(globalThis.webqit||(globalThis.webqit={}),globalThis.webqit.refs||Object.defineProperty(globalThis.webqit,"refs",{value:new ae}),!arguments.length)return globalThis.webqit.refs;let r=globalThis.webqit.refs.get(t);r||(r=new ae,globalThis.webqit.refs.set(t,r));let n,s;for(;n=e.shift();)(s=r)&&!(r=r.get(n))&&(r=new ae,s.set(n,r));return r}var ae=class extends Map{constructor(...e){super(...e),this.observers=new Set}set(e,r){let n=super.set(e,r);return this.fire("set",e,r,e),n}delete(e){let r=super.delete(e);return this.fire("delete",e),r}has(e){return this.fire("has",e),super.has(e)}get(e){return this.fire("get",e),super.get(e)}keyNames(){return Array.from(super.keys())}observe(e,r,n){let s={type:e,key:r,callback:n};return this.observers.add(s),()=>this.observers.delete(s)}unobserve(e,r,n){if(Array.isArray(e)||Array.isArray(r))throw new Error('The "type" and "key" arguments can only be strings.');for(let s of this.observers)!(Se([e,"*"],s.type)&&Se([r,"*"],s.key)&&s.callback===n)||this.observers.delete(s)}fire(e,r,...n){for(let s of this.observers)!(Se([e,"*"],s.type)&&Se([r,"*"],s.key))||s.callback(...n)}},Se=(t,e)=>Array.isArray(e)?$e(t,e).length:t.includes(e);function Ce(t){return t===!0||t===!1}function B(t){return typeof t=="function"}function Fe(t){return B(t)&&/^class\s?/.test(Function.prototype.toString.call(t))}function Te(t){return t===null||t===""}function V(t){return arguments.length&&(t===void 0||typeof t>"u")}function b(t){return Array.isArray(t)||typeof t=="object"&&t||B(t)}function fe(t){return Te(t)||V(t)||t===!1||t===0||b(t)&&!Object.keys(t).length}function C(t){return B(t)||t&&{}.toString.call(t)==="[object function]"}function ee(t){return t instanceof Number||typeof t=="number"}function I(t){return ee(t)||t!==!0&&t!==!1&&t!==null&&t!==""&&!isNaN(t*1)}function Ne(t){return _(t)&&Object.getPrototypeOf(t)===Array.prototype}function De(t){return y(t)&&Object.getPrototypeOf(t)===Object.prototype}function R(t){return t instanceof String||typeof t=="string"&&t!==null}function Ue(t){return!R(t)&&!V(t.length)}typeof URLPattern>"u"&&await Promise.resolve().then(()=>(Et(),Ct));var N={parse(t,e="&"){t=t||"";let r={};return(t.startsWith("?")?t.substr(1):t).split(e).filter(n=>n).map(n=>n.split("=").map(s=>s.trim())).forEach(n=>this.set(r,n[0],decodeURIComponent(n[1]))),r},stringify(t,e="&"){let r=[];return Object.keys(t).forEach(n=>{this.reduceValue(t[n],n,(s,i,o=void 0)=>{if(o)return o;r.push(`${i}=${encodeURIComponent(s)}`)})}),r.join(e)},get(t,e){return this.reducePath(e,t,(r,n)=>{if(!(!n&&n!==0))return n[r]})},set(t,e,r){this.reducePath(e,t,function(n,s,i=void 0){let o=r;return i&&(o=i),n===""&&_(s)?s.push(o):s[n]=o,o})},reduceValue(t,e,r){if(b(t)){let n=Object.keys(t),s=r(t,e,n);if(_(s))return s.forEach(i=>{this.reduceValue(t[i],e?`${e}[${i}]`:i,r)})}r(t,e)},reducePath(t,e,r){if(R(t)&&t.endsWith("]")&&b(e)){let[n,...s]=t.split("[");I(n)&&(n=parseInt(n)),s=s.join("[").replace("]","");let i;if(n in e)i=e[n];else{let o=s===""||I(s.split("[")[0])?[]:{};i=r(n,e,o)}return this.reducePath(s,i,r)}return I(t)&&(t=parseInt(t)),r(t,e)}},Rt={join(){let t=[],e=0;for(let n=0,s=arguments.length;n<s;n++)t=t.concat(arguments[n].split("/"));let r=[];for(let n=0,s=t.length;n<s;n++){let i=t[n];!i||i==="."||(i===".."?r.length?r.pop():e++:r.push(i))}return t[0]===""&&r.unshift(""),"../".repeat(e)+r.join("/")||(r.length?"/":".")},dirname(t){return this.join(t,"..")}},He=(t,e=null)=>({pattern:new URLPattern(t,e),isPattern(){return Object.keys(this.pattern.keys||{}).some(r=>this.pattern.keys[r].length)},test(...r){return this.pattern.test(...r)},exec(...r){let n=this.pattern.exec(...r);if(!!n)return n.vars=Object.keys(this.pattern.keys).reduce(({named:s,unnamed:i},o)=>(this.pattern.keys[o].forEach(f=>{let a=n[o].groups[f.name];typeof f.name=="number"?i.push(a):s[f.name]=a}),{named:s,unnamed:i}),{named:{},unnamed:[]}),n.render=s=>s.replace(/\$(\$|[0-9A-Z]+)/gi,(i,o)=>o==="$"?"$":(I(o)?n.vars.unnamed[o-1]:n.vars.named[o])||""),n}});function M(t,e,r=!1){if(e=="")return t;var n=r?t.lastIndexOf(e):t.indexOf(e);return n===-1?"":t.substr(n+e.length)}function ze(t,e){return t.reduce((r,n,s)=>r||e(n,s),!1)}function le(t,e,r=!1){if(e=="")return t;var n=r?t.lastIndexOf(e):t.indexOf(e);return n===-1?t:t.substr(0,n)}function A(t,e=!0){return _(t)?t:!e&&y(t)?[t]:t!==!1&&t!==0&&fe(t)?[]:Ue(t)?Array.prototype.slice.call(t):y(t)?Object.values(t):[t]}var he=class{constructor(e,r=[]){this.cx=e,this.path=_(r)?r:(r+"").split("/").filter(n=>n)}async route(e,r,n,s,i=null){let o=this,f=this.cx.runtime,a=async function(u){let c={runtime:f};if(!u.trail||u.trail.length<u.destination.length){if(u=await o.readTick(u),c.pathname=`/${u.trail.join("/")}`,c.stepname=u.trail[u.trail.length-1],o.finalizeHandlerContext(c,u),u.exports){u.exports.hints&&await r.port.post({...u.exports.hints,$type:"handler:hints"});let d=A(u.method).map(h=>h==="default"?h:h.toUpperCase()),m=C(u.exports)&&d.includes("default")?u.exports:d.reduce((h,P)=>h||u.exports[P],null);if(m){let h=async(...p)=>{let l={...u,arg:p[0]};if(p.length>1){let g=p[1],x,w={...p[2]||{}};if(p[1]instanceof l.event.Request)x=p[1],g=x.url;else if(!R(g))throw new Error("Router redirect url must be a string!");let k=g.startsWith("/")?g:o.pathJoin(`/${u.trail.join("/")}`,g);if(k.startsWith("../"))throw new Error("Router redirect cannot traverse beyond the routing directory! ("+g+" >> "+k+")");w.method&&(l.method=w.method,_(w.method)&&(w.method=w.method[0])),x?l.event=await u.event.with(k,x,w):l.event=await u.event.with(k,w),l.source=u.destination.join("/"),l.destination=k.split("?").shift().split("/").map(O=>O.trim()).filter(O=>O),l.trail=p[1].startsWith("/")?[]:u.trail.reduce((O,v,$)=>O.length===$&&v===l.destination[$]?O.concat(v):O,[]),l.trailOnFile=u.trailOnFile.slice(0,l.trail.length)}return a(l)},P=u.destination.slice(u.trail.length);return h.pathname=P.join("/"),h.stepname=P[0],await m.call(c,u.event,u.arg,h,i)}return a(u)}else if((u.currentSegmentOnFile||{}).dirExists)return a(u)}if(s)return await s.call(c,u.event,u.arg,i)};return a({destination:this.path,event:r,method:e,arg:n})}};var pe=class extends he{async readTick(e){e={...e};var r=this.cx.layout,n=Object.keys(this.cx.layout);return e.trail?(e.currentSegment=e.destination[e.trail.length],e.currentSegmentOnFile=[e.currentSegment,"-"].reduce((s,i)=>{if(s.index)return s;var o=`/${e.trailOnFile.concat(i).join("/")}`;return r[o]?{seg:i,index:o}:n.filter(f=>f.startsWith(`${o}/`)).length?{seg:i,dirExists:!0}:s},{seg:null}),e.trail=e.trail.concat(e.currentSegment),e.trailOnFile=e.trailOnFile.concat(e.currentSegmentOnFile.seg),e.exports=r[e.currentSegmentOnFile.index]):(e.trail=[],e.trailOnFile=[],e.currentSegmentOnFile={index:"/"},e.exports=r["/"]),e}finalizeHandlerContext(e,r){return e.dirname=r.currentSegmentOnFile.index}pathJoin(...e){return Rt.join(...e)}};var me=class{constructor(e){this.cx=e}async init(e,r){return new this.Router(this.cx,"/").route(["init"],e,{},async s=>{},r)}};var de=class extends me{get Router(){return pe}async handle(e,r){let n=new this.Router(this.cx,e.url.pathname);return(async()=>n.route([e.request.method,"default"],e,{},async i=>(i!==e&&(i.request.headers.has("Accept")||i.request.headers.set("Accept","application/json")),r(i.request)),r))()}};var tt={};Le(tt,{apply:()=>Xe,batch:()=>Ir,construct:()=>Qe,deep:()=>Rr,defineProperties:()=>Lr,defineProperty:()=>Ke,deleteProperty:()=>Ze,get:()=>K,getOwnPropertyDescriptor:()=>Ve,getOwnPropertyDescriptors:()=>jr,getPrototypeOf:()=>Je,has:()=>ve,intercept:()=>Ar,isExtensible:()=>Ge,observe:()=>vr,ownKeys:()=>Re,preventExtensions:()=>et,set:()=>re,setPrototypeOf:()=>Ye});var J=class{constructor(e,r){this.registry=e,Object.assign(this,{...r,target:e.target}),this.params.signal&&this.params.signal.addEventListener("abort",()=>this.remove())}remove(){return this.removed=!0,this.registry.removeRegistration(this)}};var ge=class extends J{constructor(){super(...arguments),Object.defineProperty(this,"abortController",{value:new AbortController}),Object.defineProperty(this,"signal",{value:this.abortController.signal})}remove(){this.abortController.abort(),super.remove()}fire(e){let r=e,n=this.filter;if(n!==1/0&&(n=A(n))&&(r=e.filter(s=>n.includes(s.key))),this.params.diff&&(r=r.filter(s=>s.type!=="set"||s.value!==s.oldValue)),r.length)return this.filter===1/0||Array.isArray(this.filter)?this.handler(r,this):this.handler(r[0],this)}};var S=(...t)=>ke("observer-api",...t);var G=class{constructor(e){this.target=e,this.entries=[]}addRegistration(e){return this.entries.push(e),e}removeRegistration(e){this.entries=this.entries.filter(r=>r!==e)}static _getInstance(e,r,n=!0,s=this.__namespace){if(!b(r))throw new Error(`Subject must be of type object; "${U(r)}" given!`);let i=this;return s&&S("namespaces").has(e+"-"+s)&&(i=S("namespaces").get(e+"-"+s),e+="-"+s),!S(r,"registry").has(e)&&n&&S(r,"registry").set(e,new i(r)),S(r,"registry").get(e)}static _namespace(e,r,n=null){if(e+="-"+r,arguments.length===2)return S("namespaces").get(e);if(!(n.prototype instanceof this))throw new Error(`The implementation of the namespace ${this.name}.${r} must be a subclass of ${this.name}.`);S("namespaces").set(e,n),n.__namespace=r}};var z=class extends G{static getInstance(e,r=!0,n=null){return super._getInstance("listeners",...arguments)}static namespace(e,r=null){return super._namespace("listeners",...arguments)}constructor(e){super(e),this.batches=[]}addRegistration(e,r,n){return super.addRegistration(new ge(this,{filter:e,handler:r,params:n}))}emit(e){if(this.batches.length){this.batches[0].events.push(...e);return}this.entries.forEach(r=>r.fire(e))}batch(e){this.batches.unshift({entries:[...this.entries],events:[]});let r=e(),n=this.batches.shift();return n.events.length&&n.entries.forEach(s=>s.fire(n.events)),r}};var ye=class extends J{exec(e,r,n){return this.running||!this.traps[e.type]?r(...Array.prototype.slice.call(arguments,2)):(this.running=!0,this.traps[e.type](e,n,(...s)=>(this.running=!1,r(...s))))}};var D=class extends G{static getInstance(e,r=!0,n=null){return super._getInstance("traps",...arguments)}static namespace(e,r=null){return super._namespace("traps",...arguments)}addRegistration(e){return super.addRegistration(new ye(this,e))}emit(e,r=null){let n=this;return function s(i,...o){let f=n.entries[i];return f?f.exec(e,(...a)=>s(i+1,...a),...o):r?r(e,...o):o[0]}(0)}};var L=class{constructor(e,r){if(this.target=e,!r.type)throw new Error("Descriptor type must be given in definition!");Object.assign(this,r)}};var Be={};Le(Be,{accessorize:()=>kr,proxy:()=>Er,unaccessorize:()=>Cr,unproxy:()=>Ee});function kr(t,e,r={}){t=We(t);let n=S(t,"accessorizedProps");function s(a){let u,c=t;for(;!u&&(c=Object.getPrototypeOf(c));)u=Object.getOwnPropertyDescriptor(c,a);return u?{proto:c,descriptor:u}:{descriptor:{value:void 0}}}function i(a){if(n.has(a))return!0;let u=s(a);u.getValue=function(){return"get"in this.descriptor?this.descriptor.get():this.descriptor.value},u.setValue=function(h){return"set"in this.descriptor?this.descriptor.set(h):this.descriptor.value=h},u.intact=function(){let h=Object.getOwnPropertyDescriptor(t,a);return h.get===m.get&&h.set===m.set&&n.get(a)===this},u.restore=function(){return this.intact()?(this.proto!==t?delete t[a]:Object.defineProperty(t,a,this.descriptor),n.delete(a),!0):!1},n.set(a,u);let{enumerable:c=!0,configurable:d=!0}=u.descriptor,m={enumerable:c,configurable:d};["value","set"].some(h=>h in u.descriptor)&&(m.set=function(h){return re(this,a,h,r)}),["value","get"].some(h=>h in u.descriptor)&&(m.get=function(){return K(this,a,r)});try{return Object.defineProperty(t,a,m),!0}catch{return n.delete(a),!1}}let f=(Array.isArray(e)?e:e===void 0?Object.keys(t):[e]).map(i);return e===void 0||Array.isArray(e)?f:f[0]}function Cr(t,e,r={}){t=We(t);let n=S(t,"accessorizedProps");function s(f){return n.has(f)?n.get(f).restore():!0}let o=(Array.isArray(e)?e:e===void 0?Object.keys(t):[e]).map(s);return e===void 0||Array.isArray(e)?o:o[0]}function Er(t,e={}){t=We(t);let r=new Proxy(t,{apply:(n,s,i)=>Xe(n,s,i,e),construct:(n,s,i=null)=>Qe(n,s,i,e),defineProperty:(n,s,i)=>Ke(n,s,i,e),deleteProperty:(n,s)=>Ze(n,s,e),get:(n,s,i=null)=>{let o=K(n,s,{...e,receiver:i});return e.proxyAutoBinding!==!1&&C(o)&&!Fe(o)?o.bind(r):o},getOwnPropertyDescriptor:(n,s)=>Ve(n,s,e),getPrototypeOf:n=>Je(n,e),has:(n,s)=>ve(n,s,e),isExtensible:n=>Ge(n,e),ownKeys:n=>Re(n,e),preventExtensions:n=>et(n,e),set:(n,s,i,o=null)=>re(n,s,i,{...e,receiver:o}),setPrototypeOf:(n,s)=>Ye(n,s,e)});return S(r).set(r,t),r}function Ee(t){return S(t).get(t)||t}function We(t){if(!t||!b(t))throw new Error("Target must be of type object!");return Ee(t)}function Rr(t,e,r,n=i=>i,s={}){return function i(o,f,a){let u=f[a.level];return a.level<f.length-1?a={...a,preflight:!0}:a={...a,preflight:s.preflight},r(o,u,(c,...d)=>{let m=(p={})=>({...a,...p,level:a.level+1}),h=p=>{p instanceof L&&(p.path=[p.key],o instanceof L&&(p.path=o.path.concat(p.key),p.context=o))};if(Ae(u)&&Array.isArray(c))return c.forEach(h),a.level===f.length-1||!c.length&&a.midwayResults?n(c,...d):c.map(p=>i(p,f,m(...d)));h(c);let P=b(Z(c,!1));return a.level===f.length-1||!P&&a.midwayResults?n(c,...d):P&&i(c,f,m(...d))},a)}(t,e.slice(0),{...s,level:0})}function vr(t,e,r,n={}){if(t=Z(t),C(arguments[1])&&([,r,n={}]=arguments,e=1/0),!C(r))throw new Error(`Handler must be a function; "${U(r)}" given!`);let s=jt(t,e,r,n);return n.preflight?(n={...n,descripted:!0},delete n.live,K(t,e,s,n)):s()}function Ar(t,e,r={}){return t=Z(t),y(e)||([,,,r={}]=arguments,e={[arguments[1]]:arguments[2]}),D.getInstance(t,!0,r.namespace).addRegistration({traps:e,params:r})}function Ve(t,e,r=s=>s,n={}){return F(t,"getOwnPropertyDescriptor",{key:e},r,n)}function jr(t,e,r=s=>s,n={}){return F(t,"getOwnPropertyDescriptors",{key:e},r,n)}function Je(t,e=n=>n,r={}){return F(t,"getPrototypeOf",{},e,r)}function Ge(t,e=n=>n,r={}){return F(t,"isExtensible",{},e,r)}function Re(t,e=n=>n,r={}){return F(t,"ownKeys",{},e,r)}function ve(t,e,r=s=>s,n={}){return F(t,"has",{key:e},r,n)}function K(t,e,r=s=>s,n={}){let s;return t=Z(t),y(r)?[n,r]=[r,i=>i]:n.live&&(s=!0),$r(t,e,i=>{let o=[...i];return function f(a,u,c){if(!u.length)return c(a);let d=u.shift();function m(p,l=void 0){let g=k=>(p.value=k,f(a.concat(n.live||n.descripted?p:k),u,c));if(arguments.length>1)return g(l);let x=S(t,"accessorizedProps",!1),w=x&&x.get(p.key);return w&&w.intact()?g(w.getValue()):g(Reflect.get(t,p.key,...n.receiver?[n.receiver]:[]))}let h=new L(t,{type:"get",key:d,value:void 0,related:o}),P=D.getInstance(t,!1,n.namespace);return P?P.emit(h,m):m(h)}([],i.slice(0),f=>{let a=Ae(e)?f:f[0];return s?jt(t,e,r,n)(a):r(a)})})}function Ir(t,e,r={}){return z.getInstance(t,!0,r.namespace).batch(e)}function re(t,e,r,n=o=>o,s={},i=!1){t=Z(t);let o=[[e,r]];y(e)&&([,,n=a=>a,s={},i=!1]=arguments,o=Object.entries(e)),y(n)&&([i,s,n]=[typeof s=="boolean"?s:!1,n,a=>a]);let f=o.map(([a])=>a);return function a(u,c,d){if(!c.length)return d(u);let[m,h]=c.shift();function P(l,g=void 0){let x=O=>(l.status=O,a(u.concat(l),c,d));if(arguments.length>1)return x(l,g);let w=S(t,"accessorizedProps",!1),k=w&&w.get(l.key);return l.type==="defineProperty"?(k&&!k.restore()&&x(!1),Object.defineProperty(t,l.key,l.value),x(!0)):k&&k.intact()?x(k.setValue(l.value)):x(Reflect.set(t,l.key,l.value))}function p(l,g){if(s.diff&&h===g)return a(u,c,d);let x=new L(t,{type:i?"defineProperty":"set",key:m,value:h,isUpdate:l,oldValue:g,related:[...f],detail:s.detail}),w=D.getInstance(t,!1,s.namespace);return w?w.emit(x,P):P(x)}return ve(t,m,l=>l?K(t,m,g=>p(l,g),s):p(l),s)}([],o.slice(0),a=>{let u=z.getInstance(t,!1,s.namespace);return u&&u.emit(a),n(Ae(e)?a.map(c=>c.status):a[0]?.status)})}function Ke(t,e,r,n=i=>i,s={}){return re(t,e,r,n,s,!0)}function Lr(t,e,r=s=>s,n={}){return re(t,e,r,n,!0)}function Ze(t,e,r=s=>s,n={}){t=Z(t),y(r)&&([n,r]=[r,o=>o]);let s=A(e),i=[...s];return function o(f,a,u){if(!a.length)return u(f);let c=a.shift();function d(h,P=void 0){let p=x=>(h.status=x,o(f.concat(h),a,u));if(arguments.length>1)return p(h,P);let l=S(t,"accessorizedProps",!1),g=l&&l.get(h.key);return g&&!g.restore()&&p(!1),p(Reflect.deleteProperty(t,h.key))}function m(h){let P=new L(t,{type:"deleteProperty",key:c,oldValue:h,related:[...i],detail:n.detail}),p=D.getInstance(t,!1,n.namespace);return p?p.emit(P,d):d(P)}return K(t,c,m,n)}([],s.slice(0),o=>{let f=z.getInstance(t,!1,n.namespace);return f&&f.emit(o),r(Ae(e)?o.map(a=>a.status):o[0].status)})}function Qe(t,e,r=null,n=i=>i,s={}){return F(t,"construct",arguments.length>2?{argumentsList:e,newTarget:r}:{argumentsList:e},n,s)}function Xe(t,e,r,n=i=>i,s={}){return F(t,"apply",{thisArgument:e,argumentsList:r},n,s)}function Ye(t,e,r=s=>s,n={}){return F(t,"setPrototypeOf",{proto:e},r,n)}function et(t,e=n=>n,r={}){return F(t,"preventExtensions",{},e,r)}function jt(t,e,r,n={}){let s;n.signal||(s=new AbortController,n={...n,signal:s.signal});let i=z.getInstance(t,!0,n.namespace);return function o(f,a=null){a?.remove();let c={signal:i.addRegistration(e,o,n).signal};return arguments.length&&r(f,c),s}}function F(t,e,r={},n=i=>i,s={}){t=Z(t),y(n)&&([s,n]=[n,a=>a]);function i(a,u){return arguments.length>1?n(u):n(Reflect[e](t,...Object.values(r)))}let o=new L(t,{type:e,...r}),f=D.getInstance(t,!1,s.namespace);return f?f.emit(o,i):i(o)}function Ae(t){return t===1/0||Array.isArray(t)}function Z(t,e=!0){if((!t||!b(t))&&e)throw new Error(`Object must be of type object or array! "${U(t)}" given.`);return t instanceof L&&(t=t.value),t&&Ee(t)}function $r(t,e,r){return e===1/0?Re(t,r):r(A(e))}var Fr={...tt,...Be},E=Fr;var xe=class{constructor(){this.messaging={post:(e,r=this.client)=>{if(!r)throw new Error("No client for this operation.");return r.postMessage(e),this.post},listen:(e,r=this.client)=>((r||self).addEventListener("message",n=>{this.client=n.source;let s=e(n),i=n.ports[0];i&&(s instanceof Promise?s.then(o=>{i.postMessage(o)}):i.postMessage(s))}),this.post),request:(e,r=this.client)=>{if(!r)throw new Error("No client for this operation.");return new Promise(n=>{let s=new MessageChannel;r.postMessage(e,[s.port2]),s.port1.onmessage=i=>n(i.data)})},channel(e){this.channels.has(e)||this.channels.set(e,new BroadcastChannel(r));let r=this.channels.get(e);return{broadcast:n=>r.postMessage(n),listen:n=>r.addEventListener("message",n)}},channels:new Map},this.notifications={fire:(e,r={})=>new Promise((n,s)=>{if(!(self.Notification&&self.Notification.permission==="granted"))return s(self.Notification&&self.Notification.permission);i.addEventListener("error",s);let i=new self.Notification(e,r);i.addEventListener("click",n),i.addEventListener("close",n)}),handle:e=>(self.addEventListener("notificationclick",e),this.notifications)},this.push={listen:e=>(self.addEventListener("push",e),this.post)}}setCurrentClient(e){this.client=e}};var _e=class{constructor(e,r){if(this.cx=e,this.cx.runtime=this,this.app=C(r)?r(this.cx):r,!this.app||!this.app.handle)throw new Error('Application instance must define a ".handle()" method.')}};function je(t,e){return le(t,e,!0)}function ne(t){let e=t.headers instanceof Headers?[...t.headers.keys()].reduce((s,i)=>({...s,[i]:t.headers.get(i)}),{}):Object.keys(t.headers||{}).reduce((s,i)=>({...s,[i.toLowerCase()]:t.headers[i]}),{}),r=t.body,n=rt(t.body);if(["Blob","File"].includes(n))!e["content-type"]&&(e["content-type"]=r.type),!e["content-length"]&&(e["content-length"]=r.size);else if(["Uint8Array","Uint16Array","Uint32Array","ArrayBuffer"].includes(n))!e["content-length"]&&(e["content-length"]=r.byteLength);else if(n==="json"&&b(r)){if(!e["content-type"]){let[s,i]=Nr(r);i?(r=JSON.stringify(r,(o,f)=>f instanceof Error?{...f,message:f.message}:f),e["content-type"]="application/json",e["content-length"]=new Blob([r]).size):(r=s,n="FormData")}}else n==="json"&&!e["content-length"]&&(e["content-length"]=(r+"").length);return[r,e,n]}function Nr(t={},e=!0){let r=new FormData,n=!0;return N.reduceValue(t,"",(s,i,o=void 0)=>{if(o){let f=rt(s)==="json";return n=n&&f,f&&o}e&&[!0,!1,null].includes(s)&&(s=new Blob([s],{type:"application/json"})),r.append(i,s)}),[r,n]}async function It(t,e=!0){let r=!0,n;for(let[s,i]of t.entries()){n||(n=I(le(s,"["))?[]:{});let o=rt(i);if(e&&["Blob","File"].includes(o)&&i.type==="application/json"&&[4,5].includes(i.size)){let f=await i.text();["true","false","null"].includes(f)&&(o="json",i=JSON.parse(f))}r=r&&o==="json",N.set(n,s,i)}return[n,r]}function rt(t){if(R(t)||ee(t)||Ce(t))return"json";if(!b(t))return;let e=t[Symbol.toStringTag],r=["Uint8Array","Uint16Array","Uint32Array","ArrayBuffer","Blob","File","FormData","Stream","ReadableStream"].reduce((n,s)=>n||(e===s?s:null),null);if(r)return r;if(y(t)&&De(t)||_(t)&&Ne(t)||"toString"in t)return"json"}var we=class extends FormData{async json(e={}){return(await It(this,...arguments))[0]}static compat(e){if(e instanceof this)return e;if(e instanceof FormData)return Object.setPrototypeOf(e,new this)}};var Dr=(t,e)=>{let r=class extends t{constructor(n,s,i){s.headers&&(s={...s,headers:new e(s.headers)}),super(n,s),i.headers&&this.headers.json(i.headers);let o={};Object.defineProperty(this,"_attrs",{get:()=>o}),Object.defineProperty(this,"meta",{get:()=>i})}get attrs(){return this._attrs||{}}clone(){return new this.constructor(super.clone())}get headers(){return e.compat(super.headers),super.headers}get url(){return"url"in this.attrs?this.attrs.url:super.url}async arrayBuffer(){return this.meta.type==="ArrayBuffer"?this.meta.body:super.arrayBuffer()}async blob(){return["Blob","File"].includes(this.meta.type)?this.meta.body:super.blob()}async formData(){let n;return this.meta.type==="FormData"&&this.meta.body instanceof FormData?n=this.meta.body:n=await super.formData(),n&&(n=we.compat(n)),n}async json(){return this.meta.type==="json"&&b(this.meta.body)?this.meta.body:super.json()}async text(){return this.meta.type==="json"&&!b(this.meta.body)?this.meta.body:super.text()}jsonfy(n=!1){return(!this.meta.jsonfied||n)&&(this.meta.jsonfied=new Promise(async(s,i)=>{let o,f=this.headers.get("Content-Type")||"";try{f==="application/x-www-form-urlencoded"||f.startsWith("multipart/form-data")?o=await(await this.formData())?.json():f==="application/json"?o=await this.json():f==="text/plain"&&(o=await this.text()),s(o)}catch(a){i(a)}})),this.meta.jsonfied}};return r.Headers=e,r},Ie=Dr;var Q=class extends Headers{constructor(e={}){let r=e.cookies;delete e.cookies,e instanceof Headers?super(e):(super(),this.json(e)),this.cookies=r}set(e,r){return this.catchCookies(e,r),super.set(e,r)}append(e,r){return this.catchCookies(e,r,!0),super.append(e,r)}delete(e){return this.catchCookies(e),super.delete(e)}set cookies(e){if(e instanceof Map){this.cookies.clear();for(let[r,n]of e)this.cookies.set(r,n)}else e&&this.set(this.cookieHeaderName,e);return!0}get cookies(){return this._cookies||(this._cookies=new this.Cookies,Object.defineProperty(this._cookies,"headers",{value:this})),this._cookies}catchCookies(e,r,n=!1){if(!(!this.cookies||e.toLowerCase()!==this.cookieHeaderName.toLowerCase())){if(this.cookies.outLock=!0,arguments.length>1){n||this.cookies.clear();let s=this.cookies.parse(r);for(let i in s)this.cookies.set(i,s[i])}else this.cookies.clear();this.cookies.outLock=!1}}json(e={},r=!0){if(arguments.length){let o=nt(this),f=Object.keys(o).reduce((a,u)=>a.concat(typeof u!="symbol"&&"set"in o[u]?u:[]),[]);Object.keys(e).forEach(a=>{var u=f.reduce((c,d)=>c||(d===a||d.toLocaleLowerCase()===a?d:null),null);u?(r||this[u]===void 0)&&(this[u]=e[a]):(r||!this.has(a))&&this.set(a,e[a])});return}let n={};for(var[s,i]of this)n[s]=i;return n}set cacheControl(e){return this.set("Cache-Control",e)}get cacheControl(){return this.get("Cache-Control")}set contentLength(e){return this.set("Content-Length",e)}get contentLength(){return this.get("Content-Length")}set contentType(e){return this.set("Content-Type",e)}get contentType(){return this.get("Content-Type")}static compat(e){if(!(e instanceof this)&&!e.json){let r=nt(new this);Object.keys(r).forEach(n=>{typeof n=="symbol"||n in e||Object.defineProperty(e,n,r[n])})}return e}};function nt(t){if(t){let e=Object.getPrototypeOf(t);return e===Object.prototype?{}:{...nt(e),...Object.getOwnPropertyDescriptors(t)}}else return Object.create(null)}var X=class extends Map{constructor(...e){super(...e),Object.defineProperty(this,"inLock",{value:!1,writable:!0}),Object.defineProperty(this,"outLock",{value:!1,writable:!0})}set(e,r){if(this.inLock)return;this.has(e)&&this.delete(e),this.inLock=!0;let n=r,s=r,i;return R(r)&&(n=this.parseEntry(`=${r}`)[1]),i=super.set(e,n),this.outLock||(y(r)&&(s=this.stringifyEntry(r)),Lt(this.headers,`${e}=${s}`)),this.inLock=!1,i}delete(e){if(this.inLock)return;this.inLock=!0;let r=super.delete(e);this.headers.delete(this.headers.cookieHeaderName);for(let[n,s]of this)Lt(this.headers,`${n}=${this.stringifyEntry(s)}`);return this.inLock=!1,r}clear(){if(this.inLock)return;this.inLock=!0;let e=super.clear();return this.headers.delete(this.headers.cookieHeaderName),this.inLock=!1,e}json(e={}){if(arguments.length){this.clear();for(let r in e)this.set(r,e[r]);return}for(let[r,n]of this)e[r]=n;return e}toString(){return this.headers.get(this.headers.cookieHeaderName)}};function Lt(t,e){let r=[e],n=t.get(t.cookieHeaderName);n&&r.unshift(n),t.set(t.cookieHeaderName,r.join(t.cookieHeaderSeparator))}var be=class extends Q{get cookieHeaderName(){return"Cookie"}get cookieHeaderSeparator(){return";"}get Cookies(){return st}set accept(e){return this.set("Accept",e)}get accept(){let e=this.get("Accept"),r=e&&e.split(",").map(n=>(n=n.trim().split(";").map(s=>s.trim()),[n.shift(),parseFloat((n.pop()||"1").replace("q=",""))])).sort((n,s)=>n[1]>s[1]?-1:1)||[];return{match(n){return n=(n+"").split("/"),r.reduce((s,i)=>s||(i=i[0].split("/"))&&[0,1].every(o=>n[o]===i[o]||n[o]==="*"||i[o]==="*"),!1)},toString(){return e}}}set range(e){let r=[];return A(e).forEach((n,s)=>{let i=Array.isArray(n)?n.join("-"):n+"";s===0&&!i.includes("bytes=")&&(i=`bytes=${i}`),r.push(i)}),this.set("Range",r.join(", "))}get range(){let e=this.get("Range");return e?M(e,"bytes=").split(",").map(n=>{let s=n.trim().split("-");return s[0]=s[0]?parseInt(s[0],10):void 0,s[1]&&(s[1]=parseInt(s[1],10)),s.clamp=i=>{(s[1]>i-1||s[1]===void 0)&&(s[1]=i-1),s[0]===void 0&&(s[0]=s[1]?i-s[1]-1:0)},s}):void 0}set cors(e){return this.set("Access-Control-Allow-Origin",e===!0?"*":e===!1?"":e)}get cors(){return this.get("Access-Control-Allow-Origin")}},st=class extends X{parse(e){return N.parse(e,";")}parseEntry(e){return e.trim().split("=")}stringifyEntry(e){return e}};var j=class extends Ie(Request,be){constructor(e,r={},n={}){if(!(r instanceof Request)){if("body"in r){let[s,i,o]=ne(r);n={...n,type:o,body:r.body},r={...r,body:s,headers:i}}}super(e,r,n)}static compat(e){return e instanceof this?e:e instanceof Request?Object.setPrototypeOf(e,new this):new this(e)}static async rip(e){let r=["method","headers","mode","credentials","cache","redirect","referrer","integrity"].reduce((n,s)=>({[s]:e[s],...n}),{});return["GET","HEAD"].includes(e.method)||(r.body=await e.clone().arrayBuffer()),r.mode==="navigate"&&(r.mode="cors"),[e.url,r]}};var Pe=class extends Q{get cookieHeaderName(){return"Set-Cookie"}get cookieHeaderSeparator(){return","}get Cookies(){return it}set contentRange(e){if(Array.isArray(e)){if(e.length===2&&!e[0].includes("-")||e.length<2)throw new Error("A Content-Range array must be in the format: [ 'start-end', 'total' ]");return this.set("Content-Range",`bytes ${e.join("/")}`)}return this.set("Content-Range",e)}get contentRange(){let e=this.get("Content-Range");return e&&M(e,"bytes ").split("/")}set cors(e){return this.set("Access-Control-Allow-Origin",e===!0?"*":e===!1?"":e)}get cors(){return this.get("Access-Control-Allow-Origin")}set attachment(e){if(e=e===!0?"attachment":e===!1?"inline":e,!R(e))throw new Error(`The "download" response directive does not support the type: ${U(e)}`);return["attachment","inline"].includes(e)||(e=`attachment; filename="${e}"`),this.set("Content-Disposition",e)}get attachment(){var e=(this.get("Content-Disposition")||"").trim();return e=e==="attachment"?!0:e==="inline"?!1:M(je(e,'"'),'filename="'),e}get location(){return this.get("Location")}set location(e){return this.set("Location",e)}},it=class extends X{parse(e){let r={};return e&&e.split(",").forEach(n=>{let[s,i]=this.parseEntry(n);r[s]=i}),r}parseEntry(e){let[r,n]=e.split(";"),[s,i]=r.trim().split("="),o={value:i};return n&&(n||"").split(/\;/g).map(f=>f.trim().split("=")).forEach(f=>{o[f[0][0].toLowerCase()+f[0].substring(1).replace("-","")]=f.length===1?!0:f[1]}),[s,o]}stringifyEntry(e){if(y(e)){let r=[e.value];for(let n in e){if(n==="value")continue;let s=n[0].toUpperCase()+n.substring(1);s==="MaxAge"&&(s="Max-Age"),r.push(e[n]===!0?s:`${s}=${e[n]}`)}e=r.join(";")}return e}};var T=class extends Ie(Response,Pe){constructor(e=null,r={},n={}){if(e||e===0){let s,i,o=e;[e,s,i]=ne({body:e,headers:r.headers}),n={...r,type:i,body:o},r={...r,headers:s}}super(e,r,n)}static compat(e){return e instanceof this?e:e instanceof Response?Object.setPrototypeOf(e,new this):new this(e)}};var Ur=async(t,e={})=>{if(e.body){let[s,i]=ne(e);e={...e,body:s,headers:i}}let r=await fetch(t,e),n;if(e.decompress===!1&&(n=r.headers.get("Content-Encoding"))){let s=r.body.pipeThrough(new CompressionStream(n));r=new Response(s,r)}return r},ot=Ur;var Y=class extends URL{constructor(...e){super(...e);var r=N.parse(this.search);let n=s=>{var i=N.stringify(s);i=i?"?"+i:"",i!==this.search&&(this.search=i)};this.__query={value:r,proxy:new Proxy(r,{set(s,i,o){return s[i]=o,n(s),!0},deleteProperty(s,i){return delete s[i],n(s),!0}})}}set search(e){super.search=e;var r=N.parse(e);at(r,this.query)||(this.query=r)}get search(){return super.search}get query(){return this.__query.proxy}};Y.Observable=class extends Y{constructor(){super(...arguments);let{Observer:t}=webqit;t.accessorize(this,["protocol","username","password","host","hostname","port","origin","pathname","search","query","hash","href"])}};var at=(t,e)=>y(t)&&y(e)?at(Object.keys(t),Object.keys(e))&&at(Object.values(t),Object.values(e)):_(t)&&_(e)?t.length===e.length&&t.reduce((r,n,s)=>r&&n===e[s],!0):t===e;var W=class{constructor(e,r,n,s){this._request=e,this._detail=r||{},this._sessionFactory=n,this._storageFactory=s,this.Request=j,this.Response=T,this.URL=Y,this.port={listeners:[],post(i){let o=this.listeners.map(f=>f(i)).filter(f=>f instanceof Promise);if(process.length)return Promise.all(o)},listen(i){this.listeners.push(i)}}}get url(){return this._url||(this._url=new this.URL(this._request.url)),this._url}get request(){return this._request}get detail(){return this._detail}get session(){return this._session||(this._session=this.sessionFactory()),this._session}get storage(){return this._storage||(this._storage=this.storageFactory()),this._storage}sessionFactory(...e){return this._sessionFactory(...e)}storageFactory(...e){return this._storageFactory(...e)}redirect(e,r=302){return new this.Response(null,{status:r,headers:{Location:e}})}async with(e,r={}){let n;return e instanceof Request?(r instanceof Request&&([,r]=await j.rip(r)),n=fe(r)?e:new j(e,r)):(e=new this.URL(e,this.url.origin),[,r]=await j.rip(this._request),n=new j(e,{...r,referrer:this.request.url})),new W(n,this.detail,this._sessionFactory,this.storageFactory)}};var Oe=class extends _e{constructor(e,r){super(e,r),this.mockSessionStore={},self.addEventListener("install",s=>{this.cx.params.skip_waiting&&self.skipWaiting(),this.cx.params.cache_name&&(this.cx.params.cache_only_urls||[]).length&&s.waitUntil(self.caches.open(this.cx.params.cache_name).then(i=>{this.cx.logger&&this.cx.logger.log("[ServiceWorker] Pre-caching resources.");let o=(this.cx.params.cache_only_urls||[]).map(f=>f.trim()).filter(f=>f&&!He(f,self.origin).isPattern());return i.addAll(o)}))}),self.addEventListener("activate",s=>{s.waitUntil(new Promise(async i=>{this.cx.params.skip_waiting&&await self.clients.claim(),this.cx.params.cache_name&&await self.caches.keys().then(o=>Promise.all(o.map(f=>{if(f!==this.cx.params.cache_name&&f!==this.cx.params.cache_name+"_json")return this.cx.logger&&this.cx.logger.log("[ServiceWorker] Removing old cache:",f),self.caches.delete(f)}))),i()}))}),E.set(this,"location",{}),E.set(this,"network",{}),E.observe(this.network,s=>{}),self.addEventListener("fetch",s=>{!s.request.url.startsWith("http")||s.respondWith((async i=>{let o=await self.clients.get(i.clientId);this.workport.setCurrentClient(o);let[f,a]=await j.rip(i.request);return a.cache==="force-cache"&&(a.cache="default"),this.go(f,a,{event:i})})(s))});let n=new xe;E.set(this,"workport",n),(async()=>{if(!this.app.init)return;let s=this.generateRequest("/"),i=new W(s,{srcType:"initialization"},(o=null,f=!1)=>this.getSession(i,o,f));await this.app.init(i,(...o)=>this.remoteFetch(...o))})()}async go(e,r={},n={}){e=typeof e=="string"?new URL(e,self.location.origin):e,!(r instanceof Request)&&!r.referrer&&(r={referrer:this.location.href,...r});let s=this.generateRequest(e.href,r);n.event&&Object.defineProperty(n.event,"request",{value:s});let i=new W(s,n,(a=null,u=!1)=>this.getSession(i,a,u));i.port.listen(a=>{if(a.$type==="handler:hints"&&a.session)return Promise.resolve()});let o;return i.request.url.startsWith(self.origin)?o=await this.app.handle(i,(...a)=>this.remoteFetch(...a)):o=await this.remoteFetch(i.request),await this.handleResponse(i,o)}generateRequest(e,r={}){return new j(e,r)}getSession(e,r=null,n=!1){return{get:()=>this.mockSessionStore,set:s=>{this.mockSessionStore=s}}}remoteFetch(e,...r){arguments.length>1&&(e=this.generateRequest(e,...r));let n=(o,f)=>ze((o||[]).map(a=>a.trim()).filter(a=>a),a=>He(a,self.origin).test(f)),i=(()=>{if(!this.cx.params.default_fetching_strategy||this.cx.params.default_fetching_strategy==="network-first"||n(this.cx.params.network_first_urls,e.url))return E.set(this.network,"strategy","network-first"),this.networkFetch(e,{cacheFallback:!0,cacheRefresh:!0});if(this.cx.params.default_fetching_strategy==="cache-first"||n(this.cx.params.cache_first_urls,e.url))return E.set(this.network,"strategy","cache-first"),this.cacheFetch(e,{networkFallback:!0,cacheRefresh:!0});if(this.cx.params.default_fetching_strategy==="network-only"||n(this.cx.params.network_only_urls,e.url))return E.set(this.network,"strategy","network-only"),this.networkFetch(e,{cacheFallback:!1,cacheRefresh:!1});if(this.cx.params.default_fetching_strategy==="cache-only"||n(this.cx.params.cache_only_urls,e.url))return E.set(this.network,"strategy","cache-only"),this.cacheFetch(e,{networkFallback:!1,cacheRefresh:!1})})(e);return i.catch(o=>E.set(this.network,"error",o.message)),i.then(o=>T.compat(o))}networkFetch(e,r={}){return r.cacheFallback?ot(e).then(n=>(r.cacheRefresh&&this.refreshCache(e,n),E.set(this.network,"remote",!0),n)).catch(()=>this.getRequestCache(e).then(n=>(E.set(this.network,"cache",!0),n.match(e)))):(E.set(this.network,"remote",!0),ot(e))}cacheFetch(e,r={}){return this.getRequestCache(e).then(n=>n.match(e).then(s=>!s&&r.networkFallback?this.networkFetch(e,{...r,cacheFallback:!1}):(s&&r.cacheRefresh&&this.networkFetch(e,{...r,justRefreshing:!0}),E.set(this.network,"cache",!0),s)))}refreshCache(e,r){if(e.method!=="GET"||!r||r.status!==200||r.type!=="basic"&&r.type!=="cors")return r;var n=r.clone();return this.getRequestCache(e).then(s=>{E.set(this.network,"cacheRefresh",!0),s.put(e,n)}),r}getRequestCache(e){let r=e.headers.get("Accept")==="application/json"?this.cx.params.cache_name+"_json":this.cx.params.cache_name;return self.caches.open(r)}handleResponse(e,r){return!r&&r!==0?r=new T(null,{status:404}):r instanceof T||(r=T.compat(r)),r}};async function $t(t=null){let e=this||{},r=n=>new de(n);return new Oe(oe.create(e),t||r)}self.webqit={};var Hr={},Mr={cache_name:"cache_v0",default_fetching_strategy:"network-first",network_first_urls:[],cache_first_urls:[],network_only_urls:[],cache_only_urls:[],skip_waiting:!0,support_push:!1,push_registration_url:"",push_deregistration_url:"",push_public_key:"",routing:{root:"/",subroots:[],targets:1}};webqit.app=await $t.call({layout:Hr,params:Mr});
})();
